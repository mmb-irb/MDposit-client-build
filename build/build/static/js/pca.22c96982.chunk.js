"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[6797],{10939:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(65043),a=n(12110),s=n(17604);const i="style_container__M9GCG";var l=n(70579);const o={opacity:[0,1]};(0,s.A)()||(o.transform=["translateY(50px)","translateY(0)"]);const c={fill:"both",easing:"cubic-bezier(0, .99, .56, 1.1)",duration:500},d=(0,r.forwardRef)(((e,t)=>{let{overrideComponent:n,...s}=e;const d=(0,r.useRef)(null);(0,r.useLayoutEffect)((()=>{const e=d.current&&d.current.firstElementChild;if(!e||!e.animate)return;const t=Array.from(document.querySelectorAll("main section")).findIndex((t=>e===t)),n=e.animate(o,{...c,delay:150*t});return()=>n.cancel()}),[]);const u=n?"section":a.A;return(0,l.jsx)("div",{ref:d,className:i,children:(0,l.jsx)(u,{component:"section",...s,ref:t})})}))},34088:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(65043),a=n(43126),s=n(10939);const i="style_rnd__Txifm",l="style_floating-card__HHpby";var o=n(70579);const c=(0,r.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2594),n.e(9070),n.e(8280),n.e(6190),n.e(1235),n.e(9117)]).then(n.bind(n,92428))));let d=0;const u=e=>{const t=e.viewerRef||(0,r.useRef)(null),[n,u]=(0,r.useState)((()=>{const{innerWidth:e,innerHeight:t,scrollY:n}=window,r=document.querySelector("main").offsetTop,a=Math.max(Math.min(e/4,t/4),150),s=1.5*a;return{width:2*a,height:s,x:0,y:t-r-s-20+n}}));return(0,o.jsx)(a.p,{position:{x:n.x,y:n.y},size:{width:n.width,height:n.height},style:{zIndex:(d+=1,d)},className:i,"data-rnd":!0,bounds:"window",cancel:"canvas, [data-popover], #preventDragSize",onDragStart:()=>{u({...n})},onResizeStart:()=>{u({...n})},onDragStop:(e,t)=>{0===e.layerX&&0===e.layerY||n.x===t.x&&n.y===t.y||u({...n,x:t.x,y:t.y})},onResize:()=>t.current&&t.current.autoResize(),onResizeStop:(e,t,n,r,a)=>{u({width:n.style.width,height:n.style.height,...a})},children:(0,o.jsx)(s.A,{className:l,elevation:4,children:(0,o.jsx)(r.Suspense,{fallback:null,children:(0,o.jsx)(c,{className:l,ref:t,startsPlaying:!1,...e})})})})},p=e=>{let{newViewer:t,nailing:n=!0,onNail:a,onClose:s}=e;const[i,l]=(0,r.useState)([]),c=[...i],d=(0,r.useRef)([]);if(t){const e=()=>{let e=0;for(;e<999;){if(-1===d.current.indexOf(e))return e;e+=1}console.error("Maximum number of viewers reached")};t.id=e(),t.close=()=>{n&&l((e=>{const n=[...e],r=e.indexOf(t);return-1!==r&&n.splice(r,1),n})),s&&s(t),d.current.push(t.id)},n&&(t.nail=()=>{l((e=>[...e,t])),a&&a(t),d.current.push(t.id)}),c.push(t)}return c.map((e=>(0,o.jsx)(u,{...e},e.id)))}},41604:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ie});var r=n(65043),a=n(64600),s=n.n(a),i=n(26494),l=n(85865),o=n(10939),c=n(34088),d=n(40830),u=n(31133),p=n(3777),h=n(32222),x=n(3152),m=u.A.isFinite,g=Math.min;const f=function(e){var t=Math[e];return function(e,n){if(e=(0,h.A)(e),(n=null==n?0:g((0,p.A)(n),292))&&m(e)){var r=((0,x.A)(e)+"e").split("e"),a=t(r[0]+"e"+(+r[1]+n));return+((r=((0,x.A)(a)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round");var v=n(32577),y=n(71806),j=n(84882),A=n(28076),_=n(10039),w=n(73460),$=n(11906),b=n(92127),P=n(44642),S=n(17604);const E="style_delete__BYITu",R="style_graph-container__2Y--C",F="style_axis__z8ryu",N="style_visual__S4w3g",C="style_bars__p3cKG",k="style_has-projection__R+xxb",z="style_projected__M7dqT",M="style_target__Kzgs+",Y="style_explanation__kphn8",q="style_top-line__WYRxq",B="style_area__BwFoU",H="style_tooltip__ZrzAO";var L=n(70579);const D=20,I=40,T=20,U=30,W=e=>{let{eigenvalues:t,totalEigenvalue:n,projectionsData:a,projections:s=[],setProjections:i}=e;const l=(0,r.useRef)(null),o=(0,r.useRef)(null),c=(0,r.useRef)(d.A),u=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=(0,v.Ltv)(l.current).append("svg");e.append("defs").append("clipPath").attr("id","clip-reveal").append("rect").attr("x",0).attr("y",0).attr("height","100%").attr("width",0).transition().duration((0,S.A)()?0:2150).attr("width","100%");const r={xAxis:e.append("g").attr("class",F),yExplAxis:e.append("g").attr("class",F),yEigenAxis:e.append("g").attr("class",F),explanationArea:e.append("g").attr("class",Y),visualBars:e.append("g").attr("class",`${N} ${C}`),targetBars:e.append("g").attr("class",`${M} ${C}`)};return c.current=function(){let{processed:a=u.current}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clientWidth:s,clientHeight:c}=l.current;e.attr("width",s).attr("height",c);const d=(0,v.WH)().domain(a.map(((e,t)=>t))).range([U,s-I]).padding(.1);r.xAxis.call((e=>e.attr("transform",`translate(0, ${c-T})`).call((0,v.l78)(d).tickFormat((e=>e+1)))));const p=(0,v.m4Y)().domain([0,1]).range([c-T,D]).nice();r.yExplAxis.call((e=>e.attr("transform",`translate(${s-I}, 0)`).call((0,v.eH3)(p).ticks(6).tickFormat((e=>100*("number"===typeof e?e:0)+"%")))));const h=(0,v.n8j)().x(((e,t)=>d(t)+d.bandwidth()/2)).y(p),x=r.explanationArea.selectAll(`path.${q}`).data([a]);x.enter().append("path").attr("class",q).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(x).attr("d",(e=>h(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const m=(0,v.Wcw)().x(((e,t)=>d(t)+d.bandwidth()/2)).y0(c-T).y1((e=>p(e))),g=r.explanationArea.selectAll(`path.${B}`).data([a]);g.enter().append("path").attr("class",B).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(g).attr("d",(e=>m(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const f=(0,v.m4Y)().domain([0,t[0]]).range([c-T,D]).nice();r.yEigenAxis.call((e=>e.attr("transform",`translate(${U}, 0)`).call((0,v.V4s)(f).ticks(5))));const y=r.visualBars.selectAll("rect").data(a);if(y.enter().append("rect").attr("y",f(0)).attr("height",0).merge(y).attr("class",(e=>{let{hasProjection:t,projected:n}=e;return`${t?k:""} ${n?z:""}`.trim()||null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth()).transition().ease(v.g9.overshoot(5)).duration((0,S.A)()?0:500).delay((0,S.A)()?0:(e,t)=>50*t).attr("y",(e=>f(e.eigenvalue))).attr("height",(e=>c-T-f(e.eigenvalue))),!o.current)return;const j=r.targetBars.selectAll("rect").data(a);j.enter().append("rect").attr("y",0).attr("height","100%").on("click",((e,t)=>{let{hasProjection:n}=e;n&&i((e=>{const n=new Set(e);return n[n.has(t)?"delete":"add"](t),Array.from(n).sort(((e,t)=>e-t))}))})).on("mousemove",((e,t)=>{o.current.innerHTML=`\n            <div>\n              <p>Principal component ${t+1}</p>\n              <p>Eigenvalue: ${(Math.round(100*e.eigenvalue)/100).toFixed(2)}</p>\n              <p>\n                Explained variance: ${(Math.round(e.eigenvalue/n*1e3)/10).toFixed(1)}%\n              </p>\n              <p>\n                Cumulative explained variance: ${(Math.round(1e3*e.cumulativeExplained)/10).toFixed(1)}%\n              </p>\n              <p>Projection data is ${e.hasProjection?"":"not"} available</p>\n            </div>\n          `,o.current.style.opacity=1})).on("mouseout",(()=>o.current.style.opacity=0)).merge(j).attr("class",(e=>{let{hasProjection:t}=e;return t?k:null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth())},window.addEventListener("resize",c.current),()=>window.removeEventListener("resize",c.current)}),[t,i,n]),(0,r.useEffect)((()=>{let e=0;const r=[];for(const[i,l]of t.entries()){const t=a[i];e+=l;const o=e/n;if(r.push({cumulativeExplained:o,eigenvalue:l,projected:s.includes(i),hasProjection:!!t}),i>=14&&o>=.8)break}u.current=r,c.current({processed:r})}),[t,a,n,s]),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:R,ref:l}),(0,L.jsx)("div",{className:H,ref:o}),!!s.length&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(y.A,{children:[(0,L.jsx)(j.A,{children:(0,L.jsxs)(A.A,{children:[(0,L.jsx)(_.A,{children:"Principal component"}),(0,L.jsx)(_.A,{children:"Eigenvalue"}),(0,L.jsx)(_.A,{children:"Explained variance"})]})}),(0,L.jsx)(w.A,{children:s.map((e=>(0,L.jsxs)(A.A,{children:[(0,L.jsx)(_.A,{children:e+1}),(0,L.jsx)(_.A,{children:f(t[e],2)}),(0,L.jsxs)(_.A,{children:[f(t[e]/n*100,1)," %"]})]},e)))})]}),(0,L.jsxs)($.A,{variant:"contained",onClick:()=>i([]),className:E,children:[(0,L.jsx)(b.g,{icon:P.UB}),"\xa0",(0,L.jsx)("span",{children:"Clear selection"})]})]})]})};var O=n(17545),V=n(58338),G=n(29449),K=n(95747);const X=(e,t)=>{if(!e.length)return"No projection selected, please select one or multiple projections to\n    visualise its or their related data. Only the darker blue bars correspond to\n    projections for which data has been calculated.";let n;return n=1===e.length?e[0]+1:2===e.length?`${e[0]+1} and ${e[1]+1}`:e.reduce(((e,t,n,r)=>{let{length:a}=r;return`${e}${e?",":""}${n===a-1?" and":""} ${t+1}`}),""),`Selected principal component${e.length>1?"s":""} ${n}, accounting for ${f(100*t,1)}% of explained variance`},Z="style_card__6C+Fc",J="style_ngl-card__+pU8V",Q="style_placeholder__2w0--",ee="style_projection__v0o3I",te="style_viewer-with-controls__nFIv5",ne=(0,r.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2594),n.e(9070),n.e(8280),n.e(6190),n.e(1235),n.e(9117)]).then(n.bind(n,92428)))),re=(0,r.lazy)((()=>Promise.all([n.e(6264),n.e(7515)]).then(n.bind(n,8018)))),ae=(0,L.jsx)("div",{className:s()(Q,ee)}),se=(0,L.jsx)("div",{className:s()(Q,te)}),ie=()=>{const{accession:e,accessionAndMdNumber:t,metadata:n,files:a}=(0,r.useContext)(G.f),{loading:s,payload:d,error:u}=(0,V.A)(`${K.nP}/${t}/analyses/pca/`),p=d&&d.data,[h,x]=(0,r.useState)([]),[m,g]=(0,r.useState)(null),[f,v]=(0,r.useMemo)((()=>{if(g(null),!p)return[];const e=p.eigenvalues;if(!e.length)return[];const t=e.reduce(((e,t)=>e+t),0);return[h.reduce(((t,n)=>t+e[n]),0)/t,t]}),[p,h]),[y,j]=(0,r.useMemo)((()=>{if(!p||!a)return[void 0,void 0];let e;if(void 0!==h[0]){const n=("0"+(h[0]+1)).slice(-2);e=[`${K.nP}/${t}/files/pca_trajectory_${n}.bin`]}return[[{name:"PC projection",type:"spacefill"}],[{topologyURL:`${K.nP}/${t}/files/structure`,atomSelection:"@"+p.atoms.join(","),trajectoryURLs:e}]]}),[p,a,h,e]);return s?(0,L.jsx)(O.A,{}):u?u.toString():(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(o.A,{className:Z,children:(0,L.jsxs)(i.A,{children:[(0,L.jsx)(l.A,{variant:"h6",children:"PCA eigenvalues"}),(0,L.jsx)(W,{eigenvalues:p.eigenvalues,totalEigenvalue:v,projectionsData:p.projections,projections:h,setProjections:x})]})}),(0,L.jsx)(o.A,{className:Z,children:(0,L.jsxs)("div",{children:[(0,L.jsxs)(i.A,{children:[(0,L.jsx)(l.A,{variant:"h6",children:"PCA projections"}),(0,L.jsx)("p",{children:X(h,f)})]}),1===h.length&&(0,L.jsx)(r.Suspense,{fallback:se,children:(0,L.jsx)(i.A,{className:J,children:(0,L.jsx)(ne,{className:te,projection:h[0],framesSelect:!1,startingRepresentations:y,startingComponents:j,bounce:!0})})}),2===h.length&&(0,L.jsx)(r.Suspense,{fallback:ae,children:(0,L.jsx)(i.A,{children:(0,L.jsx)(re,{framestep:p.framestep,projectionsData:p.projections,projections:h,datumRange:p.eigenvalues.length,totalFrames:n.mdFrames,setRequestedFrame:g})})})]})}),(0,L.jsx)(c.A,{newViewer:Number.isFinite(m)?{requestedFrame:m}:null,onNail:e=>g((t=>e.requestedFrame===t?null:t)),onClose:e=>g((t=>e.requestedFrame===t?null:t))})]})}},10500:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}},28593:(e,t,n)=>{n.d(t,{A:()=>r});const r=Array.isArray},40830:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(){}},3777:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(99944);const a=function(e){var t=(0,r.A)(e),n=t%1;return t===t?n?t-n:t:0}},3152:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(54577),a=n(10500),s=n(28593),i=n(28666),l=r.A?r.A.prototype:void 0,o=l?l.toString:void 0;const c=function e(t){if("string"==typeof t)return t;if((0,s.A)(t))return(0,a.A)(t,e)+"";if((0,i.A)(t))return o?o.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const d=function(e){return null==e?"":c(e)}}}]);
//# sourceMappingURL=pca.22c96982.chunk.js.map