"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[3259,7732,9117],{23621:(e,s,a)=>{a.r(s),a.d(s,{default:()=>S});var t=a(65043),n=a(89257),l=a(85865),r=a(57631),o=a(10939),i=a(14696),c=a(17545),d=a(58338),u=a(29449),p=a(95747),f=a(27732),h=a(82746),m=a(48838),g=a(75291),x=a(70579);const y={triggerOnce:!0,rootMargin:"100px"},b=["grey","yellow","red"],A={atoms:"spacefill",residues:"spacefill",chains:"spacefill",selections:"spacefill"},S=()=>{const[e,s]=(0,n.Wx)(y),{accessionAndMdNumber:a,metadata:S,topology:v,populations:j}=(0,t.useContext)(u.f),k=v&&v.defaultRepresentations,C=(0,t.useRef)(null),_=(0,t.useRef)(null),{loading:R,payload:$,error:M}=(0,d.A)(`${p.nP}/${a}/analyses/sasa/`),[N,T]=(0,t.useState)([]),{components:I,representations:w,framesNumber:D,xAxisStep:E,xAxisLabel:L,isEnsemble:P,xTooltip:F,xWeights:W,data:H}=(0,t.useMemo)(()=>{if(!v||!S||!$||j&&j.loading)return{};const e=v.residueCount;if(e!==$.saspf.length)throw new Error(`Number of residues in the analysis (${$.saspf.length}) does not match number of residues in the topology (${e})`);const s={saspf:[],means:[],stdvs:[]};for(let a=0;a<e;a++){"ion"===v.getResidueByIndex(a).classification?(s.saspf[a]=null,s.means[a]=null,s.stdvs[a]=null):(s.saspf[a]=$.saspf[a],s.means[a]=$.means[a],s.stdvs[a]=$.stdvs[a])}let t;for(let a=0;a<e;a++)if(s.saspf[a]){if(void 0!==t){t=null;break}t=a}null!==t&&T([{color:"black",index:t}]);const n=s.means,l=Math.max(...n),o=Math.min(...n),i=(0,r.m4Y)().range(b).domain([o,(o+l)/2,l]),c=h.hD.addScheme(function(e){this.atomColor=e=>{const s=e.residueIndex;if("ion"===v.getResidueByIndex(s).classification)return 16777215;const a=n[s];if(null===a)return 16777215;const t=(0,r.yWT)(i(a)).formatHex();return parseInt(t.substring(1),16)}}),d=$.step,u=[{trajectoryURLs:[`${`${p.nP}/${a}/files/trajectory`}?frames=1:${S.mdFrames}:${d}`]}],f=[];k.forEach(e=>{const s={...e};s.color="custom",s.customScheme=c,s.type="spacefill",f.push(s)});const m=s.saspf.find(e=>null!==e).length,g=S.timeLength,x="ensemble"===S.TYPE;let y,A,C,_;if(x||!g?(y=d,A="Frames",C=e=>"frame "+e):(y=g/(m-1),A="Time (ns)",C=e=>+e.toFixed(2)+" ns"),j&&j.payload){_=[];for(let e=0;e<j.payload.length;e+=y)_.push(j.payload[e])}return{components:u,representations:f,framesNumber:m,xAxisStep:y,xAxisLabel:A,isEnsemble:x,xTooltip:C,xWeights:_,data:s}},[$,v,S,a,k,j,T]),{selectedData:B,selectedResidueIndices:Y}=(0,t.useMemo)(()=>{const e={},s=[];return N.forEach((a,t)=>{const n={data:H.saspf[a.index]};n.color=a.color,e[t]=n,s.push(a.index)}),{selectedData:e,selectedResidueIndices:s}},[H,N]),G=(0,t.useCallback)(e=>{C.current.togglePlaying(!1),C.current.currentFrame=e},[]),O=(0,t.useCallback)(e=>{if(!_.current)return;const s=Math.round(e*(D-1));_.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]},[D]),U=(0,t.useCallback)((e,s,a)=>{const t={color:a,index:s};T(e=>[...e,t])},[T]),V=(0,t.useCallback)((e,s)=>{T(e=>e.filter(e=>e.index!==s))},[T]),q=(0,t.useCallback)(()=>{T([])},[T]),z=(0,t.useCallback)((e,s)=>{const a=H.means[s],t=H.stdvs[s];return`Mean SAS: ${Math.round(100*a)/100}\nStandard deviation: ${Math.round(100*t)/100}`},[H]);return R||j&&j.loading?(0,x.jsx)(c.A,{}):M?M.toString():j&&j.error?j.error.toString():$?j&&!j.payload?"Something bad happened with populations":v&&S?(0,x.jsxs)(t.Suspense,{fallback:(0,x.jsx)(c.A,{}),children:[v.residueCount>1&&(0,x.jsx)(o.A,{children:(0,x.jsx)(m.A,{residueValues:H.means,legendTitle:"Average Relative SAS (\xc5\xb2)",onSelect:U,onDeselect:V,onClean:q,onTooltip:z})}),(0,x.jsx)(o.A,{className:f.default.graphcard,children:N.length>0?(0,x.jsx)(g.default,{yData:B,step:E,xAxisLabel:L,yAxisLabel:"Relative SAS (\xc5\xb2)",type:P?"dots":"line",xWeights:W,xTooltip:F,onSelect:G,className:f.default.graph,ref:_}):(0,x.jsx)("div",{className:f.default["graph-placeholder"],children:(0,x.jsx)(l.A,{variant:"h6",children:"No residue selected"})})}),(0,x.jsx)(o.A,{className:f.default.nglcard,ref:e,children:s?(0,x.jsx)(i.default,{className:f.default.container,startingComponents:I,startingRepresentations:w,selectedResidueIndices:Y,onProgress:O,ref:C,framesSelect:!1,highlightTypes:A}):(0,x.jsx)("div",{style:{height:"50vh"}})})]}):(0,x.jsx)(c.A,{}):"Something bad happened"}},27732:(e,s,a)=>{a.r(s),a.d(s,{default:()=>t});const t={graphcard:"style_graphcard__Cgh8H",graph:"style_graph__rikGP","graph-placeholder":"style_graph-placeholder__ef29F",nglcard:"style_nglcard__lD0br",container:"style_container__lvt9H"}}}]);
//# sourceMappingURL=3259.98747d27.chunk.js.map