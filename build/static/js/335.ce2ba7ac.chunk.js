(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[335],{10419:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(65043),o=n(29449),a=n(71261);const s=()=>{const{topology:e}=(0,r.useContext)(o.f);return(0,r.useMemo)(()=>{if(!e)return[];const t=[];return e.iterchains().forEach(n=>{const r=n.metadataChainName,o=r?"".concat(r," (Chain ").concat(n.name,")"):"Chain ".concat(n.name),s=n.residues,i=n=>{const r=s.filter(e=>e.classification===n);if(0===r.length)return;const i=r.filter(e=>e.isCg);if(i.length>0){const r=i.map(e=>e.index),{rangedSelection:a}=e.residueIndices2Ngl(r);t.push({name:"".concat(o," - ").concat(n," polymer (coarse grain)"),selection:a,type:"spacefill",color:"chainid"})}const c=r.filter(e=>!e.isCg).map(e=>e.index),l=[...(0,a.Y$)(c)],u=l.filter(e=>e.length<=3);if(u.length>0){const r=u.reduce((e,t)=>e.concat(t),[]),{rangedSelection:a}=e.residueIndices2Ngl(r);t.push({name:"".concat(o," - ").concat(n," polymer (short)"),selection:a,type:"licorice",color:"chainid"})}const d=l.filter(e=>e.length>3);if(d.length>0){const r=d.reduce((e,t)=>e.concat(t),[]),{rangedSelection:a}=e.residueIndices2Ngl(r);t.push({name:"".concat(o," - ").concat(n," polymer"),selection:a,type:"cartoon",color:"chainid"});new Set(["dna","rna","nucleic"]).has(n)&&t.push({name:"".concat(o," - ").concat(n," bases"),selection:a,type:"base",color:"resname"})}};i("protein"),i("dna"),i("rna"),i("nucleic");const c=s.filter(e=>"ligand"===e.classification);if(c.length>0){const n=new Set(c.map(e=>e.referenceId));for(const r of n){const n=c.filter(e=>e.referenceId===r).map(e=>e.index),{rangedSelection:a}=e.residueIndices2Ngl(n);t.push({name:"".concat(o," - ligand ").concat(r),selection:a,type:"ball+stick",color:"element"})}}const l=new Set(["fatty","steroid"]),u=s.filter(e=>l.has(e.classification));if(u.length>0){const n=u.map(e=>e.index),{rangedSelection:r}=e.residueIndices2Ngl(n);t.push({name:"".concat(o," - lipids"),selection:r,type:"licorice",color:"grey",opacity:.5})}const d=s.filter(e=>"ion"===e.classification);if(d.length>0){const n=d.map(e=>e.index),{rangedSelection:r}=e.residueIndices2Ngl(n);t.push({name:"".concat(o," - ions"),selection:r,type:"spacefill",color:"element"})}const m=new Set(["solvent","unknown"]),f=s.filter(e=>m.has(e.classification));if(f.length>0){const n=f.map(e=>e.index),{rangedSelection:r}=e.residueIndices2Ngl(n);t.push({name:"".concat(o," - other"),selection:r,type:"licorice",color:"purple",opacity:.3})}}),t},[e])}},13232:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});const r=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=e.getBoundingClientRect(),a=t.getBoundingClientRect();let s=n.x;if(Math.abs(o.left-s)>Math.abs(s-o.right)){s-=r+(a.right-a.left)}else s+=r;s-=o.left;let i=n.y;if(Math.abs(o.top-i)>Math.abs(i-o.bottom)){i-=r+(a.bottom-a.top)}else i+=r;return i-=o.top,{x:s,y:i}}},14696:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>St});var r=n(89379),o=n(80045),a=n(65043),s=n(64600),i=n.n(s),c=n(54109),l=n.n(c),u=n(12110),d=n(17392),m=n(68903),f=n(44208),p=n(99070),h=n(26494),g=n(10611),y=n(92127),x=n(44642),j=n(12639),b=n(71806),v=n(84882),w=n(28076),A=n(10039),E=n(73460),S=n(67784),C=n(2260),_=n(43845),R=n(61533);const L="style_popover-slider__Rg-SB",N="style_info__itwxP";var k=n(70579);const F=[{label:"Cartoon",value:"cartoon"},{label:"Licorice",value:"licorice"},{label:"Ball and stick",value:"ball+stick"},{label:"Surface",value:"surface"},{label:"Spacefill",value:"spacefill"},{label:"Tube",value:"tube"},{label:"Trace",value:"trace"},{label:"Backbone",value:"backbone"},{label:"Nucleic bases",value:"base"}],T=e=>{for(const t of F)if(t.value===e)return!0;return!1},P=[{label:"By chain id",value:"chainid"},{label:"By residue",value:"resname"},{label:"By element",value:"element"},{label:"B factor",value:"bfactor"},{label:"Electrostatic",value:"electrostatic"},{label:"Secondary structure",value:"sstruc"},{label:"Uniform",value:"uniform"}],M=["red","yellow","blue","green","orange","purple","white","grey","black"],I=(0,a.memo)(e=>{let{components:t,representations:n,setRepresentations:r}=e;return(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(b.A,{"aria-label":"simple table",size:"small",padding:"checkbox",stickyHeader:!0,children:[(0,k.jsx)(v.A,{children:(0,k.jsxs)(w.A,{children:[(0,k.jsx)(A.A,{children:"Name"}),(0,k.jsx)(A.A,{align:"right",children:"Show"}),(0,k.jsxs)(A.A,{style:{whiteSpace:"nowrap"},align:"right",children:["Selection ",(0,k.jsx)(R.A,{tooltip:(0,k.jsxs)(k.Fragment,{children:["Using"," ",(0,k.jsx)("a",{href:"https://nglviewer.org/ngl/api/manual/selection-language.html",target:"_blank",rel:"noopener noreferrer",children:"NGL selection language"}),"."]}),className:N})]}),(0,k.jsx)(A.A,{align:"right",children:"Drawing method"}),(0,k.jsx)(A.A,{align:"right",children:"Coloring method"}),(0,k.jsx)(A.A,{align:"right",children:"Opacity"})]})}),(0,k.jsx)(E.A,{children:n&&n.map((e,t)=>(0,k.jsxs)(w.A,{children:[(0,k.jsx)(A.A,{component:"th",scope:"row",children:e.name}),(0,k.jsx)(A.A,{align:"right",children:(0,k.jsx)(d.A,{title:"Show/Hide representation",onClick:()=>r(e=>(e[t].show=!e[t].show,[...e])),color:"primary",children:(0,k.jsx)(y.g,{icon:e.show?j.pS3:j.k6j})})}),(0,k.jsx)(A.A,{align:"right",children:(0,k.jsx)(S.A,{defaultValue:e.selection,variant:"outlined",onKeyPress:e=>{"Enter"===e.key&&r(n=>e.target&&e.target.value?(n[t].selection=e.target.value,[...n]):n)},disabled:!e.custom,size:"small",margin:"dense"})}),(0,k.jsx)(A.A,{align:"right",children:(0,k.jsxs)(C.A,{native:!0,value:e.type,onChange:e=>{let{target:{value:n}}=e;r(e=>(e[t].type=n,[...e]))},children:[!T(e.type)&&(0,k.jsx)("option",{value:e.type,children:e.type}),F.map((e,t)=>(0,k.jsx)("option",{value:e.value,children:e.label},t))]})}),(0,k.jsx)(A.A,{align:"right",children:(0,k.jsxs)(C.A,{native:!0,value:e.color,onChange:e=>{let{target:{value:n}}=e;r(e=>(e[t].color=n,[...e]))},children:["distorsion"===e.customScheme?(0,k.jsx)("option",{value:e.color,children:"Distorsion"}):e.customScheme?(0,k.jsx)("option",{value:"custom",children:"Custom"}):null,P.map((e,t)=>(0,k.jsx)("option",{value:e.value,children:e.label},t)),M.map((e,t)=>{return(0,k.jsx)("option",{value:e,children:(n=e,n[0].toUpperCase()+n.slice(1))},t);var n})]})}),(0,k.jsx)(A.A,{align:"right",children:(0,k.jsx)(p.Ay,{value:100*e.opacity,onChange:(e,n)=>{r(e=>(e[t].opacity=n/100,[...e]))},className:L})})]},e.reference||t))}),(0,k.jsx)(E.A,{children:(0,k.jsx)(w.A,{children:(0,k.jsx)(A.A,{align:"center",colSpan:6,children:(0,k.jsx)(_.A,{icon:(0,k.jsx)(y.g,{icon:j.OQW}),label:"Add representation",variant:"outlined",onClick:()=>r(e=>[...e,{name:"Custom",show:!0,selection:"None",type:"licorice",color:"chainid",opacity:1,component:t[0]&&t[0].name,custom:!0}])})})},"addCustom")})]})})});var z=n(39766);const B="".concat("mdposit","-"),O=(e,t)=>{const n=localStorage.getItem(B+e);return null===n?t:JSON.parse(n)},D=async(e,t)=>(await(0,z._)(1e3),((e,t)=>{localStorage.setItem(B+e,JSON.stringify(t))})(e,t));var U=n(95747),G=n(89257),q=n(50691),H=n(52153),V=n(35682),W=n(39517),K=n(43573),X=n(26939),Y=n(65001),J=n(29325),Q=n(78219),Z=n(23541),$=n(54776);const ee=Y.xE.builderFactory("custom-namespace")({name:"trajectory-from-custom-data",display:"Trajectory",from:J.O.Root,to:J.O.Molecule.Coordinates,params:{data:Z.t.Value(new Uint8Array,{isHidden:!0}),natoms:Z.t.Value(0,{isHidden:!0})}})({apply(e){let{params:t}=e;return Q.YZ.create("Parse atom coordinates",async e=>await async function(e,t){if(0===t)throw new Error("Number of atoms is 0");const n=12*t;if(e.byteLength%n!==0)throw new Error("Trajectory data ends abruptly");const r=e.byteLength/n,o=new Float32Array(e),a=[];let s=0;for(let c=0;c<r;c++){const e=new Float32Array(t),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<t;a++)e[a]=o[s],n[a]=o[s+1],r[a]=o[s+2],s+=3;a.push({x:e,y:n,z:r,elementCount:t,time:(0,$.gX)(c,"step"),xyzOrdering:{isIdentity:!0}})}const i=$.E$.create(a,(0,$.gX)(1,"step"),(0,$.gX)(0,"step"));return new J.O.Molecule.Coordinates(i,{label:"label"})}(t.data,t.natoms))}});var te=n(29449);const ne="style_container__d6R8E",re="style_light-theme__l3EaT",oe="style_loading-trajectory__ciokb",ae="style_loading-structure__ce+kY",se="style_tooltip__KXFgY",ie=(0,H.w)();ie.layout={initial:{isExpanded:!1,controlsDisplay:"reactive",showControls:!1}},ie.components={controls:{top:"none",bottom:"none",left:"none",remoteState:"none"}};const ce={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},le=(0,a.memo)((0,a.forwardRef)((e,t)=>{let{className:n,playing:r,spinning:o,smooth:s,onProgress:c,bounce:l=!1,selectedAtoms:u,selectedResidueIndices:d,selectedChains:m,selectedCustom:f,selectedDistances:p,selectedAngles:h,selectedRepresentation:g,snapRepresentations:y,noTrajectory:x,initialFocus:j,darkBackground:b,perspective:v,speed:w,drawingMethods:A,coloringMethods:E,opacities:S,components:C,showRepresentations:_,nglSelections:R,topologies:L,trajectories:N,anyLoadingTopology:F,anyLoadingTrajectory:T,highlightTypes:P=ce}=e;const M=(0,a.useMemo)(()=>C,[C]),{metadata:I,topology:B}=(0,a.useContext)(te.f),[O,D]=(0,a.useState)(j);(0,a.useEffect)(()=>{D(j)},[j]);const U=(0,a.useRef)(null),H=(0,a.useRef)(null),Y=(0,a.useRef)(null),J=(0,a.useRef)(null),[Q,Z]=(0,G.Wx)(),[$,le]=(0,a.useState)(null),[ue,de]=(0,a.useState)(null);(0,a.useEffect)(()=>((async()=>{const e=await(0,q.y)(U.current,ie);de(e)})(),()=>{ue&&(ue.dispose(),ue=null)}),[]);const[me,fe]=(0,a.useState)(null);(0,a.useEffect)(()=>{F||ue&&L.forEach(async e=>{const t=await ue.builders.data.rawData({data:e.file},{state:{isGhost:!0}}),n=await ue.builders.structure.parseTrajectory(t,"pdb"),r=await ue.builders.structure.createModel(n);fe(r.ref)})},[ue,F,L]),(0,a.useEffect)(()=>{if(!ue)return;if(x)return;(async()=>{if(!L||!N||0===N.length)return;if(!me)return;const e=N[0];let t,n=0;if(t=e.atoms,t!==e.atoms)throw new Error("Atoms number in the different trajectories do not match");n+=e.frames;const r=e.payload,o=12*t,a=Math.floor(r.byteLength/o)*o,s=r.slice(0,a);if(0===s.byteLength)return;const i=s.byteLength/o;if(!(i===n))return;const c=await ue.build().toRoot().apply(ee,{data:s,natoms:e.atoms}).commit(),l=ue.managers.structure.hierarchy.current.trajectories,u=await ue.build().toRoot().apply(V.TrajectoryFromModelAndCoordinates,{modelRef:me,coordinatesRef:c.ref},{dependsOn:[me,c.ref]}).commit(),d=await ue.builders.structure.createModel(u),m=await ue.builders.structure.createStructure(d),f=ue.build().to(m),p=(0,K.pQ)(ue,void 0,{type:"cartoon",typeParams:{quality:"lower",ignoreHydrogens:"all",ignoreHydrogensVariant:"all",ignoreLight:!0}});f.apply(X.f.Representation.StructureRepresentation3D,p),await f.commit(),l.length})()},[ue,me,L,N,M,x]),(0,a.useEffect)(()=>{ue&&(x||(r&&Z?ue.managers.animation.play(W.d,{duration:{name:"sequential",params:{maxFps:10}},mode:{name:"loop",params:{direction:"forward"}}}):ue.managers.animation.stop()))},[ue,r,Z,x,l]);const pe=(0,a.useCallback)(async()=>{if(!Y.current)return;const e=H.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,z.yy)(0),Y.current.handleResize()},[]);(0,a.useEffect)(()=>(window.addEventListener("resize",pe),()=>{window.removeEventListener("resize",pe)}),[pe]),(0,a.useImperativeHandle)(t,()=>({autoResize:pe,displayFocus(){const e=Y.current.viewerControls.getOrientation(),t="[".concat(e.elements.toString(),"]");console.log(t)},centerFocus(){D({comp:0,sele:"all"})},get currentFrame(){if(!ue||!N.length)return-1;try{return Y.current.compList[0].trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(ue&&N.length)try{const t=this.totalFrames;let n=e;n<0&&(n=0),n>=t&&(n=t-1),Y.current.compList[0].trajList[0].trajectory.setFrame(n)}catch(t){}},get totalFrames(){if(!ue||!N.length)return 1;try{return Y.current.compList[0].trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return Y.current.compList[0].trajList[0].expectedFrames}catch(e){return 1}}}),[ue,N,pe]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{ref:e=>{Q(e),U.current=e},className:i()(n,ne,{[ae]:F,[oe]:!x&&T,[re]:!b}),"data-loading":void 0}),(0,k.jsx)("div",{ref:J,className:se,children:$})]})})),ue=le;var de=n(45180),me=n(82746);const fe=(e,t,n)=>{const r=new Float32Array(e);try{const e=[];for(let o=0;o<n;o++){const n=new Float32Array(3*t);n.set(r.subarray(o*t*3,(o+1)*t*3)),e.push(n)}return e}catch(o){return null}},pe=(e,t,n,r,o)=>{const a=new Float32Array(n),s=a.length/3/o;if(s!==r)throw console.log("Number of coordinates: "+a.length),console.log("Number of frames: "+o),console.log("Expected number of atoms: "+s),console.log("Actual number of atoms: "+r),new Error("Trajectory atom number is wrong");try{const n=[];for(let s=0;s<o;s++){const o=new Float32Array(3*e);let i=0;for(let n=0;n<e;n++)-1!==t.indexOf(n)&&(o[3*n]=a[s*r*3+3*i],o[3*n+1]=a[s*r*3+3*i+1],o[3*n+2]=a[s*r*3+3*i+2],i++);n.push(o)}return n}catch(i){return null}},he=(e,t,n,r)=>{const o=new Float32Array(t);if(o.length/3/r!==n)throw new Error("Trajectory atom number is wrong");let a="",s=0,i=0;for(let l=0;l<e.atomCount&&!(0>=n);l++)"C"!==e.getAtomProxy(l).atomname&&"CA"!==e.getAtomProxy(l).atomname&&"N"!==e.getAtomProxy(l).atomname||(s+=1),"H"!==e.getAtomProxy(l).element&&(i+=1);n===s?a="backbone":n===i?a="heavy":console.error("Number of atoms does not match any defined atoms selection\n      Number of atoms: ".concat(n,"\n      Expected backbone atoms: ").concat(s,"\n      Expected heavy atoms: ").concat(i));try{const t=[];for(let s=0;s<r;s++){const r=new Float32Array(3*e.atomCount);let i=0;if("backbone"===a)for(let t=0;t<e.atomCount&&!(i>=n);t++)"C"!==e.getAtomProxy(t).atomname&&"CA"!==e.getAtomProxy(t).atomname&&"N"!==e.getAtomProxy(t).atomname||(r[3*t]=o[s*n*3+3*i],r[3*t+1]=o[s*n*3+3*i+1],r[3*t+2]=o[s*n*3+3*i+2],i++);if("heavy"===a)for(let t=0;t<e.atomCount&&!(i>=n);t++)"H"!==e.getAtomProxy(t).element&&(r[3*t]=o[s*n*3+3*i],r[3*t+1]=o[s*n*3+3*i+1],r[3*t+2]=o[s*n*3+3*i+2],i++);t.push(r)}return t}catch(c){return null}};var ge=n(13232),ye=n(71261);const xe="style_container__7Ceta",je="style_light-theme__H4DPh",be="style_loading-trajectory__2DP4d",ve="style_loading-structure__E1dyl",we="style_tooltip__eJTpx";var Ae=n(93010);const Ee=750,Se="polymer and not hydrogen ",Ce=e=>1e3+-9.5*(e-0),_e={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},Re=(0,a.memo)((0,a.forwardRef)((e,t)=>{let{className:n,playing:o,spinning:s,smooth:c,onProgress:l,bounce:u=!1,selectedAtoms:d,selectedResidueIndices:m,selectedChains:f,selectedCustom:p,selectedDistances:h,selectedAngles:g,selectedRepresentation:y,snapRepresentations:x,noTrajectory:j,initialFocus:b,darkBackground:v,perspective:w,speed:A,xSelection:E,rotateX:S,xAxisStep:C,components:_,representations:R,topologies:L,trajectories:N,anyLoadingTopology:F,anyLoadingTrajectory:T,highlightTypes:P=_e}=e;const{metadata:M,topology:I}=(0,a.useContext)(te.f),B=(0,a.useMemo)(()=>{if(!M)return;const e=M.ORIENTATION;if(!e)return;const t=[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]];return(new me.kn).set(...t)},[M]),[O,D]=(0,a.useState)(null),[U,q]=(0,a.useState)(null),[H,V]=(0,a.useState)(b);(0,a.useEffect)(()=>{V(b)},[b]);const W=(0,a.useRef)(null),K=(0,a.useRef)(null),X=(0,a.useRef)(null),Y=(0,a.useRef)(!0),[J,Q]=(0,G.Wx)(),[Z,$]=(0,a.useState)(null),[ee,ne]=(0,a.useState)([]),re=(0,a.useRef)(new Set);(0,a.useEffect)(()=>{L.forEach(e=>{if(!e.file)return;if(e.url in re.current)return;re.current.add(e.url);const t=new Blob([e.file],{type:"text/plain"});(0,me.un)(t,{defaultRepresentation:!1,ext:"pdb"}).then(t=>{const n=(0,r.A)({},e);n.file=t,ne(e=>[...e,n])}).catch(e=>{console.error(e)})}),ne(e=>[...e])},[L]);const[oe,ae]=(0,a.useState)(0),se=(0,a.useCallback)(e=>{ae(t=>t+e)},[ae]);(0,a.useEffect)(()=>{const e=new me.BI(W.current);return(0,z.Gt)().then(()=>{e&&e.handleResize()}),e.tasks.signals.countChanged.add(se),K.current=e,()=>{K.current.dispose(),K.current=null}},[]);const ie=(0,a.useMemo)(()=>O?N.length||j?oe>0?"Rendering...":void 0:"No trajectory available":"Loading structure",[O,N,j,oe]);(0,a.useEffect)(()=>{const e=Date.now();let t=1e3;return Y.current&&(t=0,Y.current=!1),(async()=>{for(;;){if(await(0,z.Gt)(),!K.current)return;let n=Date.now()-e;if(n>t)break;v&&(n=t-n);const r="#".concat(Math.round(255*n/t).toString("16").padStart(2,"0").repeat(3));K.current.viewer.setBackground(r)}await(0,z.Gt)(),K.current&&K.current.viewer.setBackground(v?"black":"white")})(),()=>t=0},[v]),(0,a.useEffect)(()=>{K.current&&K.current.viewer&&K.current.viewer.setCamera&&K.current.viewer.setCamera(w?"perspective":"orthographic")},[w]),(0,a.useEffect)(()=>{if(!l||j||!U)return;const e=U.expectedFrames,t=t=>{const n=(0,de.A)(t/(e-1),0,1);l(n)};return U.signals.frameChanged.add(t),()=>{U.signals.frameChanged.remove(t)}},[U,j,l]);const ce=(0,a.useCallback)(async()=>{if(!K.current)return;const e=W.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,z.yy)(0),K.current.handleResize()},[]);(0,a.useEffect)(()=>(window.addEventListener("resize",ce),()=>{window.removeEventListener("resize",ce)}),[ce]),(0,a.useEffect)(()=>{_&&R&&I&&_.forEach((e,t)=>{let n=K.current.compList.find(t=>t.myName==e.name);if(!n){const t=e.topologyURL||null,r=ee.find(e=>e.url===t);if(!r)return;if(r.error)throw new Error("Topology from '".concat(t,"' returned error ").concat(r.error));if(!r.file)throw new Error("Topology data from '".concat(t,"' is missing"));r.file.atomStore.occupancy=new Array(r.file.atomStore.occupancy.length).fill(1);const o=I.atomBonds;if(o){const e=r.file.bondStore;e.length=0,e.count=0,e.atomIndex1=new Int32Array,e.atomIndex2=new Int32Array,e.bondOrder=new Int32Array,o.forEach((t,n)=>{const o=r.file.getAtomProxy(n);t.forEach(t=>{const n=r.file.getAtomProxy(t);e.addBond(o,n,1)})})}const a=(0,Ae.A)(r.file);if(n=K.current.addComponentFromObject(a),n.myName=e.name,!n)return;n.onlyTopology=e.onlyTopology,D(n)}const o=R.filter(t=>t.component===e.name),a=[];o.forEach((e,o)=>{const s=o+"-"+e.name;a.push(s);const i=e.show,c=e.selection,l=e.type,u=e.color,d=i?e.opacity:0,m=e.customScheme,f=e.name===y?me.hD.addSelectionScheme([["yellow","all"]],"custom label"):m&&"custom"===u?m:(e=>{var t=(new Option).style;return t.color=e,t.color===e})(u)?me.hD.addSelectionScheme([[u,"all"]],"custom label"):u,p="surface"===l?[-200,200]:void 0,h="surface"===l?"av":void 0,g=!("surface"===l&&d<1),x=(0,r.A)({sele:c,name:s,opacity:d,colorScheme:f,colorDomain:p,surfaceType:h,side:"front",depthWrite:g},e.other),j=n.reprList.find(e=>e.name===s);if(j){const e=j.repr.type,t=j.repr.selection.string;e!==l||t!==c||"trace"===e?(n.removeRepresentation(j),n.addRepresentation(l,x)):j.setParameters(x)}else n.addRepresentation(l,x);if(e.label){const t=e.label+"-"+s,r=n.annotationList.find(e=>e.name===t);if(i)if(r)r.element.label=e.label;else{var b=document.createElement("div");b.innerText=e.label,b.style.color="#76FF03",b.style.backgroundColor="#607D8B",b.style.padding="8px";const r=n.reprList[o].repr.structureView.center;n.addAnnotation(r,b).name=t}else r&&n.removeAnnotation(r)}e.name===y&&V({comp:t,sele:e.selection})});[...n.reprList].forEach(e=>{const t=e.name;if("*"!==t.charAt(0)){for(const e of a)if(t===e)return;n.removeRepresentation(e)}}),V(e=>e||{comp:0,sele:"all"})})},[_,R,ee,y,D,I]),(0,a.useEffect)(()=>{if(!I)return;if(!O||!d)return;const e="*highlightedAtoms",t=O.reprList.find(t=>t.name===e);t&&O.removeRepresentation(t);const n="*highlightedAtomResidues",r=O.reprList.find(e=>e.name===n);r&&O.removeRepresentation(r);const o=Array.from(d);if(!o.length)return;const a="@".concat(o.map(e=>e).join(","));O.addRepresentation(P.atoms,{sele:a,opacity:.5,scale:1.5,name:e});const s=Array.from(new Set(o.map(e=>"@"+I.getAtomByIndex(e).residue.atomIndices.join(",")))).join(" or ");O.addRepresentation(P.residues,{sele:s,name:n}),V({comp:0,sele:s})},[O,I,d,v,P]),(0,a.useEffect)(()=>{if(!I||!O||!m)return;const e="*highlightedResidues",t=O.reprList.find(t=>t.name===e);if(t&&O.removeRepresentation(t),0===m.length)return;const n=m.map(e=>I.getResidueByIndex(e).nglSelection),r=Array.from(new Set(n)).join(" or ");O.addRepresentation(P.residues,{sele:r,name:e}),V({comp:0,sele:r})},[O,m,I,P]),(0,a.useEffect)(()=>{if(!O||!f)return;const e="*highlightedChains",t=O.reprList.find(t=>t.name===e);t&&O.removeRepresentation(t);const n=f.map(e=>":"+e);if(!n.length)return;const r=Array.from(new Set(n)).join(" or ");O.addRepresentation(P.chains,{sele:r,name:e}),V({comp:0,sele:r})},[O,f,P]),(0,a.useEffect)(()=>{if(!O||!x)return;const e=O.reprList;return x.forEach(e=>{O.addRepresentation(e.type,{sele:e.selection,name:e.name,color:e.color,opacity:e.opacity})}),()=>{x.forEach(t=>{const n=e.find(e=>e.name===t.name);n&&O.removeRepresentation(n)})}},[O,x]),(0,a.useEffect)(()=>{if(!O||!p)return;const e="*highlightedCustom",t=O.reprList.find(t=>t.name===e);if(t&&O.removeRepresentation(t),!p.length)return;const n=Array.from(new Set(p)).join(" or ");O.addRepresentation(P.selections,{sele:n,name:e}),V({comp:0,sele:n})},[O,p,P]),(0,a.useEffect)(()=>{if(!O||!h)return;const e="*distance",t=O.reprList.find(t=>t.name===e);t&&O.removeRepresentation(t),O.addRepresentation("distance",{atomPair:h,color:"skyblue",labelUnit:"angstrom",name:e,labelColor:v?16777215:1})},[O,h,v]),(0,a.useEffect)(()=>{if(!O||!E)return;const e="*density",t=K.current.compList.find(t=>t.name===e);t?K.current.removeComponent(t):K.current.viewer.rotationGroup.rotateY(-1.6);var n=new me.yp("shape",{radialSegments:10});const r=O.object.center,o=O.object.boundingBox;n.addBox([r.x,r.y,E*C-C/2],[0,0,0],o.max.x-o.min.x,[0,o.max.y-o.min.y,0],[0,0,.01]),n.addBox([r.x,r.y,E*C+C/2],[0,0,0],o.max.x-o.min.x,[0,o.max.y-o.min.y,0],[0,0,-.01]);K.current.addComponentFromObject(n,{name:e}).addRepresentation("buffer",{opacity:.1,roughness:1})},[O,E]),(0,a.useEffect)(()=>{O&&S&&K.current.viewer.rotationGroup.rotateX(-1.57)},[O,S]),(0,a.useEffect)(()=>{if(!O||!g)return;const e="*angles",t=O.reprList.find(t=>t.name===e);t&&O.removeRepresentation(t),O.addRepresentation("angle",{atomTriple:g,name:e,labelColor:v?16777215:1})},[O,g,v]),(0,a.useEffect)(()=>{0!==ee.length&&0!==N.length&&_&&_.forEach((e,t)=>{const n=e.topologyURL||null,r=ee.find(e=>e.url===n);if(!r)return;const a=K.current.compList.find(t=>t.myName==e.name);if(!a)return;if(e.onlyTopology)return;const s=[];let i,c="",l="",u=0;for(const o of e.framedURLs){const e=N.find(e=>e.url===o);if(!e)return;if(i||(i=e.atoms),i!==e.atoms)throw new Error("Atoms number in the different trajectories do not match");u+=e.frames;const t=e.payload,n=12*i,r=Math.floor(t.byteLength/n)*n,a=t.slice(0,r);s.push(a),c+=o,l+="/"+e.progress}const d=a.combinedURL===c;if(d||a.trajList.forEach(a.removeTrajectory.bind(a)),d&&a.combinedProgress===l)return;let m;if(a.combinedURL=c,a.combinedProgress=l,0===s.length)return;if(m=1===s.length?s[0]:s.reduce((e,t)=>(0,ye.nK)(e,t)),0===m.byteLength)return;const f=12*i,p=m.byteLength/f,h=p-1,g=p===u,y=e.trajectoryAtomIndices,x=a.trajList;if(x.length>0){if(x.length>1)throw new Error("Multiple trajectories in one component");const e=x[0],n=e.trajectory;if(((e,t,n,r,o,a)=>{if(!(e&&t&&n))return;const s=e.frames.length;if(s>=o)return;const i=s*r*12,c=n.slice(i),l=o-s;let u;if(u=r===t.atomCount?fe(c,r,l):a?pe(t.atomCount,a,c,r,l):he(t,c,r,l),!u)throw new Error("Topology and trajectory data may not match");e.frames=e.frames.concat(u)})(n,r.file,m,i,p,y),n._frameCount=p,0===t){e.expectedFrames=u;const t=n.player,r=Ce(A);if(t.setParameters({end:h,interpolateStep:100/u,mode:g?"loop":"once",timeout:r}),!j&&o&&!t.isRunning){n._currentFrame<h&&t.play()}}}else{const e=((e,t,n,r,o)=>{if(!e||!t)return;let a;if(a=n===e.atomCount?fe(t,n,r):o?pe(e.atomCount,o,t,n,r):he(e,t,n,r),!a)throw new Error("Topology and trajectory data may not match");const s=new me.Hc("Dynamically generated trajectory","");return s.coordinates=a,s})(r.file,m,i,p,y);if(!e)return;const n=a.addTrajectory(e),o=n.trajectory;if(0===t){n.expectedFrames=u;const e=Ce(A);o.player.setParameters({interpolateStep:100/u,mode:g?"loop":"once",timeout:e}),q(n)}o.setFrame(0)}})},[ee,N,_,j,q,o,A]),(0,a.useEffect)(()=>{if(!U)return;const e=U.trajectory,t=()=>{const t=e._currentFrame;e.setFrame(t)};return e.player.signals.haltedRunning.add(t),()=>{e.player.signals.haltedRunning.remove(t)}},[U]),(0,a.useEffect)(()=>{if(!U)return;const{player:e}=U.trajectory;return e.setParameters({interpolateStep:100/U.trajectory.frameCount,direction:u?"bounce":"forward"}),j?e.pause():e[o&&Q?"play":"pause"](),()=>e.pause()},[U,o,Q,j,u]),(0,a.useEffect)(()=>{if(!O)return;const e=O.trajList[0];if(!e)return;const t=Ce(A);e.trajectory.player.setParameters({timeout:t})},[O,A]),(0,a.useEffect)(()=>{K.current&&K.current.spinAnimation&&s===K.current.spinAnimation.paused&&K.current.toggleSpin()},[s]),(0,a.useEffect)(()=>{U&&(U.trajectory.player.parameters.interpolateType=c?"linear":"")},[U,c]),(0,a.useEffect)(()=>{if(O&&N.length)return ce(),ce.cancel},[O,N,ce]),(0,a.useEffect)(()=>{if(!O||!I)return;const e=e=>{let{detail:t}=e;if(!t||"click"!==t.eventtype&&"reset"!==t.eventtype)return;let n="";for(const a of document.querySelectorAll("protvista-manager")){const e=a.attributeValues.get("highlight"),t=a.attributes.chain.value;if(!e)continue;const[r,o]=e.split(":"),s=I.getResidueByParameters(t,+r),i=I.getResidueByParameters(t,+o);if(s.chainName!==i.chainName)throw new Error("Range from multiple chains is not supported");n+=" or :".concat(s.chainName," and ").concat(s.number,"-").concat(i.number)}n=n.substr(4);const r=O&&O.reprList.find(e=>"structure"===e.name);if(r&&O.removeRepresentation(r),!n)return O.addRepresentation("cartoon",{sele:Se,name:"structure",opacity:1}),void(B&&K.current.animationControls.orient(B,Ee));const o=me.hD.addSelectionScheme([["yellow",n],["white","*"]],"custom label");O.addRepresentation("cartoon",{sele:Se,name:"structure",opacity:1,color:o}),O.autoView(n,Ee)};return window.addEventListener("change",e),()=>window.removeEventListener("change",e)},[O,I,B]),(0,a.useEffect)(()=>{if(!I)return;const e=X.current;W.current.appendChild(e),K.current.mouseControls.remove("hoverPick");const t=e=>{const t=I.getResidueByIndex(e.residueIndex),n=t.chain.metadataChainName,r=t.referenceId;return(0,k.jsxs)(k.Fragment,{children:["Atom ".concat(e.index," (").concat(e.atomname,")\n                Chain ").concat(t.chainName," ").concat(n?"("+n+")":"","\n                Residue ").concat(t.number," (").concat(e.resname,")"),(()=>{if(r)return"noref"===r?(0,k.jsx)("div",{style:{color:"orange"},children:"No referable"}):"notfound"===r?(0,k.jsx)("div",{style:{color:"salmon"},children:"Reference not found"}):(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{style:{color:"lightGreen"},children:t.referenceName}),"protein"===t.referenceType&&(0,k.jsx)("div",{children:"- Residue ".concat(t.referenceNumber)})]})})()]})};let n;const r=()=>{clearTimeout(n),e.style.display="none"};return K.current.signals.hovered.add(function(o){o?(r(),n=setTimeout(()=>{let n;const r=o.bond,a=o.atom;if(r){const e=r.atom1,o=r.atom2;n=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{children:"Bond ".concat(e.index," - ").concat(o.index)}),(0,k.jsx)("hr",{style:{color:"lightGrey"}}),t(e),(0,k.jsx)("hr",{style:{color:"lightGrey"}}),t(o)]})}else a&&(n=t(a));$(n),e.style.display="block";const{x:s,y:i}=(0,ge.L)(W.current,e,o.mouse.position,3);e.style.top=i+"px",e.style.left=s+"px"},400)):r()}),W.current.addEventListener("mouseleave",r,!1),()=>{e.remove(),W.current.removeEventListener("mouseleave",r)}},[I,$]);const le=(0,a.useRef)(!0);(0,a.useEffect)(()=>{if(!H)return;const e=H.comp?K.current.compList.find(e=>e.myName===H.comp):O;if(!e)return;let t=Ee;le.current&&(t=0,B&&K.current.animationControls.orient(B,0),le.current=!1),e.autoView(H.sele,t)},[O,H,B]),(0,a.useImperativeHandle)(t,()=>({autoResize:ce,displayFocus(){const e=K.current.viewerControls.getOrientation(),t="[".concat(e.elements.toString(),"]");console.log(t)},centerFocus(){V({comp:0,sele:"all"}),B&&K.current.animationControls.orient(B,Ee)},get currentFrame(){if(!O||!N.length)return-1;try{return O.trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(O&&N.length)try{const t=this.totalFrames;let n=e;n<0&&(n=0),n>=t&&(n=t-1),O.trajList[0].trajectory.setFrame(n)}catch(t){}},get totalFrames(){if(!O||!N.length)return 1;try{return O.trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return O.trajList[0].expectedFrames}catch(e){return 1}}}),[O,N,ce]);return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)("div",{ref:e=>{e&&(J(e),W.current=e)},className:i()(n,xe,{[ve]:!O,[be]:!j&&T,[je]:!v}),"data-loading":ie,children:(0,k.jsx)("div",{ref:X,className:we,children:Z})})})}));Re.displayName="NGLViewer";const Le=Re;var Ne=n(10419),ke=n(92954),Fe=n(74199),Te=n(42594),Pe=n.n(Te),Me=n(22363),Ie=n.n(Me),ze=n(74080);const Be=(0,Fe.A)(/\?frames=(\d+):(\d+)(:(\d+))?/,{start:1,end:2,step:4}),Oe=(e,t,n)=>{const{accessionAndMdNumber:r,fileDescriptors:o,structureData:s}=(0,a.useContext)(te.f),[i,c]=(0,a.useState)([]),[l,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&c(t=>{const n=[];return e.forEach(e=>{const r=e.topologyURL||null,o=e.atomSelection||null;[...t,...n].find(e=>e.url===r)||(null===r?n.push({url:null,loading:!1,error:null}):(n.push({url:r,selection:o,loading:!0,requested:!1,error:null}),u(!0)))}),[...t,...n]})},[e,c]);const[d,m]=(0,a.useState)([]),f=(0,a.useRef)([]);(0,a.useEffect)(()=>{i.forEach(e=>{if(e.file)return;if(e.error)return;if(e.requested)return;const t=e.url;if(null===t)m(e=>[...e,{url:null,file:s}]);else{e.requested=!0;const n=JSON.stringify({selection:e.selection}),r="https"===t.substring(0,5)?Pe():Ie(),o=(0,ze.parse)(t),a=o.path.endsWith("/structure");o.method=a?"POST":"GET",o.headers={"Content-Type":"application/json","Content-Length":n.length};const s=r.request(o,n=>{let r="";n.on("data",e=>{r+=e}).on("end",()=>{m(e=>[...e,{url:t,file:r}]),e.loading=!1;const n=i.some(e=>e.loading);u(n)})});"POST"===o.method&&s.write(n),s.end(),f.current.push(s)}})},[i,s]);const[p,h]=(0,a.useState)([]),[g,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!e)return;const{loading:n,payload:a,error:s}=o;if(!n){if(s)throw s;if(!a)throw new Error("Something bad happened with file descriptors");h(n=>{const o=[],s="".concat(U.nP,"/").concat(r,"/files/trajectory");return e.forEach((e,r)=>{if(e.onlyTopology)return;const i=0===r,c=e.frame;let l=e.trajectoryURLs||[s];e.frameCount=0,l.forEach((r,s)=>{const l=(e=>{const t=Be.exec(e);if(!t)return null;const n=+t.groups.start,r=Math.max(+t.groups.end,n),o=+(t.groups.step||1);return{start:n,end:r,step:o,frames:Math.floor((r-n)/o)+1}})(r);let u=r.split("/").slice(-1)[0];l&&(u=u.split("?frames=")[0]),"trajectory"===u&&(u="trajectory.bin");const d=a.find(e=>e.filename===u);if(!d)throw new Error('Trajectory "'.concat(u,'" is missing'));const m=d.metadata,f=m.frames;let p=t;if(t>f&&(p=f),Number.isFinite(c)?p=1:l&&(p=l.frames),!i&&p>1)throw new Error("Only the main component is allowed to load multiple frames");let h,g=r;if(l){const e=Math.min(f,l.end);h=Math.ceil(e/l.step)}else{const{range:e,frames:t}=((e,t,n)=>{if(n)return{range:(n+1).toString(),frames:1};if(!e)throw new Error("Missing number of frames in the trajectory");if(!t)throw new Error("Missing number of requested frames");const r=Math.floor(e/t),o=Math.ceil(e/r);return{range:"".concat(1,":",e,":").concat(r),frames:o}})(f,p,c);h=t,e&&(g=r+"?frames=".concat(e))}e.framedURLs||(e.framedURLs=[]),e.framedURLs[s]=g,e.frameCount+=p;n.find(e=>e.url===g)||(o.push({url:g,frames:h,atoms:m.atoms,loading:!0,requested:!1}),y(!0))})}),o.length>0?[...n,...o]:n})}},[r,e,o,t]);const[x,j]=(0,a.useState)([]);return(0,a.useEffect)(()=>{p.forEach(e=>{if(e&&e.requested)return;e.requested=!0,e.loading=!0,e.progress=0;const t=JSON.stringify({}),n="https"===e.url.substring(0,5)?Pe():Ie(),r=(0,ze.parse)(e.url),o=r.pathname.split("/"),a="trajectory"===o[o.length-1];r.method=a?"POST":"GET",r.headers={"Content-Type":"application/json","Content-Length":t.length};const s=n.request(r,t=>{const n=t.headers["content-length"];j(t=>[...t,{url:e.url,frames:e.frames,atoms:e.atoms,payload:new ArrayBuffer(0),progress:0}]);let r=0;t.on("data",t=>{r+=t.byteLength,e.progress=r/n,j(n=>{const r=n.find(t=>t.url===e.url);return r.payload=(0,ye.nK)(r.payload,t),r.progress=e.progress,[...n]})}).on("end",()=>{e.loading=!1;const t=p.some(e=>e.loading);y(t)})});"POST"===r.method&&s.write(t),s.end(),f.current.push(s)})},[p]),(0,a.useEffect)(()=>{const e=f.current;return()=>{e.forEach(e=>{e.abort()})}},[]),(0,a.useEffect)(()=>{if(!e)return;const t=e[0]&&e[0].framedURLs;if(!t)return;const r=[];if(t.forEach(e=>{const t=x.find(t=>t.url===e);t&&r.push(t)}),0===r.length)return;const o=r.map(e=>e.frames).reduce((e,t)=>e+t,0),a=r.map(e=>e.progress*e.frames).reduce((e,t)=>e+t,0)/o;n(a)},[e,x,n]),{topologies:d,trajectories:x,anyLoadingTopology:l,anyLoadingTrajectory:g}},De=Symbol("low"),Ue=Symbol("medium"),Ge=Symbol("high"),qe=()=>{if(!navigator||!navigator.connection)return Ue;const{effectiveType:e,saveData:t}=navigator.connection;if(!0===t)return De;if(!e)return Ue;switch(e){case"slow-2g":case"2g":return De;case"3g":return Ue;default:return Ge}};var He=n(17604);const Ve="style_background-toggle__aAj32",We="style_dark__e5mDQ",Ke="style_adapter__+rjEA",Xe="style_ngl-with-settings__k93CW",Ye="style_ngl-without-settings__qTooi",Je="style_settings-left__Wvi5a",Qe="style_settings-controls__kLLNo",Ze="style_ngl-alone__5TmnB",$e="style_stacked-icons__OoF+a",et="style_extra-top-margin__vaEmm",tt="style_settings-right__NDIcU",nt="style_hidden__D+3lX",rt="style_fullscreen-toggle__f4Bk2",ot="style_is-fullscreen__RtQvN",at="style_settings__87jIw",st="style_fullscreen-target__VO3Yh",it="style_progress__LNzos",ct="style_controls__0ugFi",lt="style_flip-container__dGHQ+",ut="style_flip-card-container__wgyMe",dt="style_flipped__DhDpU",mt="style_flip-card__g+agx",ft="style_front__g9FOf",pt="style_back__UfiiZ",ht="style_progressContainer__kQ85K",gt="style_timeInfo__wEsXY",yt=["startingComponents","startingRepresentations","componentsState","representationsState","className","startsPlaying","close","nail","requestedFrame","framesSelect","preventTrajectory","onProgress"],xt=!(0,He.A)()&&window.innerWidth>750,jt=(()=>{switch(qe()){case Ge:return 50;case Ue:return 25;default:return 10}})(),bt=[{value:1,label:"1"},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],vt={name:"Unnamed component",topologyURL:"auto",trajectoryURLs:"auto",atomSelection:null,frame:null,onlyTopology:!1},wt={name:"Unnamed representation",selection:"all",show:!0,type:"cartoon",color:"chainid",opacity:1,component:"auto"},At=(e,t)=>{let n=!1;for(const[r,o]of Object.entries(t))void 0===e[r]&&(e[r]=o,n=!0);return n},Et=(0,a.forwardRef)((e,t)=>{let{startingComponents:n,startingRepresentations:s,componentsState:c,representationsState:b,className:v,startsPlaying:w=xt,close:A,nail:E,requestedFrame:S,framesSelect:C=!0,preventTrajectory:_=!1,onProgress:R}=e,L=(0,o.A)(e,yt);if(n&&c)throw new Error("startingComponents and componentsState are not compatilbe inputs. Choose one.");if(s&&b)throw new Error("startingRepresentations and representationsState are not compatilbe inputs. Choose one.");const[N,F]=(0,a.useState)(Le),{metadata:T,accessionAndMdNumber:P,topology:M}=(0,a.useContext)(te.f),[z,B]=(0,a.useState)({frame:0,time:0}),G=(0,a.useMemo)(()=>{const e=T.mdFrames,t=[...bt];for(let n=t.length-1;n>=0&&t[n].value>e;n--)t.pop();return t.length===bt.length||t[t.length-1].value!==e&&t.push({value:e,label:e.toString()}),t},[T.mdFrames]),q=(0,a.useMemo)(()=>n?n.map(e=>(0,ye.JH)(e)):null,[n]),[H,V]=c||(0,a.useState)(q),W=(0,a.useCallback)(e=>{if(!P)return!1;const t=(0,r.A)({},vt);return t.topologyURL="".concat(U.nP,"/").concat(P,"/files/structure"),t.trajectoryURLs=["".concat(U.nP,"/").concat(P,"/files/trajectory")],At(e,t)},[P]);(0,a.useEffect)(()=>{if(!W)return;if(!H){const e=[{name:"Main"}];return e.forEach(e=>{W(e)}),V(e)}const e=H.map(e=>e.name),t=new Set(e);if(e.length!==t.size)throw new Error("We have multiple components with the same name: ".concat(e.join(", ")));H.map(e=>W(e,vt)).some(e=>!0===e)&&V([...H])},[H,W]),(0,a.useEffect)(()=>{H&&void 0!==S&&H[0].frame!==S&&(H[0].frame=S,V([...H]))},[H,S]);const K=(0,a.useMemo)(()=>s?s.map(e=>(0,ye.JH)(e)):null,[s]),[X,Y]=b||(0,a.useState)(K),J=(0,Ne.A)(),Q=(0,a.useCallback)(e=>{if(!H)return!1;const t=(0,r.A)({},wt);return t.component=H[0].name,At(e,t)},[H]);(0,a.useEffect)(()=>{if(!J||0===J.length)return;if(!X){if(b)return;const e=[...J];return e.forEach(e=>Q(e)),Y(e)}X.map(e=>Q(e)).some(e=>!0===e)&&Y([...X])},[X,J,Q]);const Z=(0,a.useRef)(null),$=(0,a.useRef)(null),[ee,ne]=(0,ke.A)(!1),[re,oe]=(0,ke.A)(w),[ae,se]=(0,ke.A)(!1),[ie,ce]=(0,a.useState)(!0),[le,de]=(0,ke.A)((0,a.useMemo)(()=>O("dark-background",!1),[])),[me,fe]=(0,ke.A)((0,a.useMemo)(()=>O("perspective",!1),[])),[pe,he]=(0,a.useState)(0),[ge,xe]=(0,a.useState)(0),[je,be]=(0,a.useState)(l().isFullscreen),[ve,we]=(0,a.useState)(Math.min(jt,T.mdFrames)),[Ae,Ee]=(0,a.useState)((0,a.useMemo)(()=>O("speed",50),[])),[Se,Ce]=(0,a.useState)(!1),_e=(0,a.useCallback)(e=>{if(R&&R(e),he(e),$.current){const t=$.current.currentFrame,n=T.FRAMESTEP?(T.timeLength*e).toFixed(2):0;B({frame:t,time:n})}},[he,R,T.FRAMESTEP]);(0,a.useEffect)(()=>{const e=window.history.pushState,t=window.history.replaceState;return window.history.pushState=function(){e.apply(this,arguments),re&&oe(!1)},window.history.replaceState=function(){t.apply(this,arguments),re&&oe(!1)},()=>{window.history.pushState=e,window.history.replaceState=t}},[re,oe]);const Re=(0,a.useCallback)(e=>{xe(e)},[xe]),Fe=(0,a.useCallback)(e=>{let{buttons:t,clientX:n,currentTarget:r,type:o}=e;if(!$.current)return;if("mousemove"===o&&1!==t)return;const{x:a,width:s}=r.getBoundingClientRect();oe(!1),$.current.currentFrame=Math.floor((n-a)/s*$.current.totalExpectedFrames)},[oe]),Te=(0,a.useCallback)(e=>{$.current&&(oe(!1),$.current.currentFrame+=e)},[oe]),Pe=(0,a.useCallback)(()=>Te(-1),[Te]),Me=(0,a.useCallback)(()=>Te(1),[Te]),Ie=(0,a.useCallback)(()=>be(l().isFullscreen),[]);(0,a.useEffect)(()=>(l().on("change",Ie),()=>l().off("change",Ie)),[Ie]);const ze=(0,a.useCallback)(()=>{Z.current&&l().toggle(Z.current)},[]);(0,a.useEffect)(()=>{const e=e=>{"Escape"===e.key&&(Ce(!1),$.current.autoResize())," "===e.key&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),oe(e=>!e))};return document.addEventListener("keydown",e,!1),()=>document.removeEventListener("keydown",e,!1)},[]);const Be=(0,a.useMemo)(()=>{if(!M||!M.pbcResidues)return;const e=M.pbcResidues.size>0;return e&&ce(!1),e},[M]);(0,a.useImperativeHandle)(t,()=>({autoResize:$.current.autoResize,centerFocus:$.current.centerFocus,get currentFrame(){return $.current.currentFrame},set currentFrame(e){$.current.currentFrame=e},togglePlaying:oe,setFinalComponents:V,setFinalRepresentations:Y}),[oe,V,Y]);const De=H&&H[0],Ue=_||De&&(De.onlyTopology||Number.isFinite(De.frame)),{topologies:Ge,trajectories:qe,anyLoadingTopology:He,anyLoadingTrajectory:Et}=Oe(H,ve,Re);return(0,k.jsx)(u.A,{className:i()(st,{[ot]:je}),ref:Z,children:(0,k.jsxs)("div",{className:i()(Ke,v),children:[(0,k.jsxs)(u.A,{className:Se?Xe:Ye,style:{border:"none",boxShadow:"none"},id:"preventDragSize",children:[(0,k.jsxs)(u.A,{className:Se?i()(Je,v):i()(Ze,v),style:{border:"none",boxShadow:"none"},children:[(0,k.jsx)(N,(0,r.A)({playing:re,spinning:ae,smooth:ie,onProgress:_e,ref:$,noTrajectory:Ue,darkBackground:le,perspective:me,speed:Ae,components:H,representations:X,topologies:Ge,trajectories:qe,anyLoadingTopology:He,anyLoadingTrajectory:Et},L)),Se&&(0,k.jsxs)("div",{className:Qe,children:[(0,k.jsxs)("div",{className:$e,children:[(0,k.jsx)(d.A,{title:"Toggle spin",onClick:se,size:"large",children:(0,k.jsx)(y.g,{icon:j.OtC})}),(0,k.jsx)(d.A,{title:"Center focus",onClick:e=>{if(!$.current)return;e.shiftKey||e.ctrlKey||e.metaKey?$.current.displayFocus():$.current.centerFocus()},size:"large",children:(0,k.jsx)(y.g,{icon:x.RV})}),Ue||(0,k.jsx)("div",{className:$e,title:Be&&"Smooth interpolation is not allowed since there are residues under Periodic Boundary Conditions. The smoothing may result in misleading artifacts for those atoms jumping across boundaries.",children:(0,k.jsx)(d.A,{title:"Toggle smooth interpolation ".concat(ie?"off":"on"),onClick:()=>ce(e=>!e),disabled:Be,size:"large",children:(0,k.jsx)(y.g,{icon:ie?x.yv:j.n2W})})}),(0,k.jsx)(d.A,{title:"Invert background color",onClick:()=>{de(),D("dark-background",!le)},size:"large",children:(0,k.jsx)("div",{className:i()(Ve,{[We]:le}),children:(0,k.jsx)(y.g,{icon:j.Rpi})})}),(0,k.jsx)(d.A,{title:"Switch to ".concat(me?"ortographic":"perspective"," view"),onClick:()=>{fe(),D("perspective",!me)},size:"large",children:(0,k.jsx)(y.g,{icon:me?x.Nf:j.br3})}),(0,k.jsx)(d.A,{title:"Switch viwer to ".concat(N===Le?"MolStar":"NGL"),onClick:()=>{F(e=>{if(e===Le)return ue;if(e===ue)return Le;throw new Error("Unrecognized current viewer")})},size:"large",children:(0,k.jsx)(y.g,{icon:N===Le?j.RPy:j.QOt})})]}),Ue||(0,k.jsxs)("div",{children:["Speed:",(0,k.jsxs)(m.Ay,{container:!0,spacing:2,className:et,children:[(0,k.jsx)(m.Ay,{item:!0,children:(0,k.jsx)(f.A,{children:(0,k.jsx)(y.g,{icon:j.zsV})})}),(0,k.jsx)(m.Ay,{item:!0,xs:!0,children:(0,k.jsx)(p.Ay,{title:"Change player speed",value:Ae,"aria-labelledby":"continuous-slider",onChange:(e,t)=>{Ee(t),D("speed",t)}})}),(0,k.jsx)(m.Ay,{item:!0,children:(0,k.jsx)(f.A,{children:(0,k.jsx)(y.g,{icon:j.Cz6})})})]})]}),Ue||(0,k.jsxs)("div",{children:["Frames:",C?(0,k.jsx)(p.Ay,{title:"Select frame number",value:ve,onChange:(e,t)=>we(t),"aria-labelledby":"discrete-slider-restrict",step:null,valueLabelDisplay:"auto",marks:G,max:G[G.length-1].value}):" "+$.current.totalExpectedFrames]})]})]}),Se&&(0,k.jsx)("div",{className:tt,children:(0,k.jsx)(I,{components:H,representations:X,setRepresentations:Y})})]}),(0,k.jsxs)(h.A,{style:{padding:0},children:[Ue?(0,k.jsx)("div",{}):(0,k.jsxs)("div",{className:ht,children:[(0,k.jsx)("div",{className:i()(it,{[We]:le}),onClick:Fe,onMouseMove:Fe,children:(0,k.jsx)(g.A,{variant:"buffer",color:"primary",value:100*pe,valueBuffer:100*ge,style:{height:"1ch"},className:"prevent-drag"})}),T.FRAMESTEP&&(0,k.jsxs)("div",{className:i()(gt,{[We]:le}),children:["Time: ",z.time," / ",(0,ye.wC)(T.timeLength)," ns"]})]}),(0,k.jsxs)("div",{className:ct,children:[(0,k.jsxs)("div",{children:[(0,k.jsx)(d.A,{title:"Close viewer",className:i()({[nt]:!A}),disabled:!A,onClick:A,size:"large",children:(0,k.jsx)(y.g,{icon:j.GRI})}),(0,k.jsx)(d.A,{title:ee?"Nailed viewer":"Nail viewer",className:i()({[nt]:!E}),disabled:!E||ee,onClick:()=>{E(),ne()},size:"large",children:(0,k.jsx)("div",{className:lt,children:(0,k.jsxs)("div",{className:i()(ut,{[dt]:ee}),children:[(0,k.jsx)(y.g,{className:i()(mt,ft),icon:j.KKb}),(0,k.jsx)(y.g,{className:i()(mt,pt),icon:j.DW4})]})})})]}),(0,k.jsx)("div",{children:Ue||(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(d.A,{title:"Previous frame",onClick:Pe,size:"large",children:(0,k.jsx)(y.g,{icon:j.L4I})}),(0,k.jsx)(d.A,{title:re?"Pause":"Play",onClick:oe,size:"large",children:(0,k.jsx)("div",{className:lt,children:(0,k.jsxs)("div",{className:i()(ut,{[dt]:re}),children:[(0,k.jsx)(y.g,{className:i()(mt,ft),icon:j.ijD}),(0,k.jsx)(y.g,{className:i()(mt,pt),icon:j.G1Y})]})})}),(0,k.jsx)(d.A,{title:"Next frame",onClick:Me,size:"large",children:(0,k.jsx)(y.g,{icon:j.BxI})})]})}),(0,k.jsxs)("div",{children:[(0,k.jsx)(d.A,{title:"".concat(je?"Exit":"Go"," fullscreen"),onClick:ze,className:i()(rt,{[nt]:!l().isEnabled,[ot]:je,[at]:Se}),disabled:!l().isEnabled,size:"large",children:(0,k.jsx)(y.g,{icon:je?j.gr3:j.oZK})}),(0,k.jsx)(d.A,{title:"Settings",onClick:()=>{Ce(e=>!e),$.current.autoResize()},size:"large",children:(0,k.jsx)(y.g,{icon:j.dB})})]})]})]})]})})});Et.displayName="ViewerWithControls";const St=Et},15340:()=>{},42634:()=>{},79838:()=>{}}]);
//# sourceMappingURL=335.ce2ba7ac.chunk.js.map