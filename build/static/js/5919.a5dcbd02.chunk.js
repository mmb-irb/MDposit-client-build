"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[3960,5919,9117],{50953:(e,s,t)=>{t.r(s),t.d(s,{default:()=>S});var a=t(65043),n=t(89257),r=t(85865),l=t(57631),o=t(10939),d=t(14696),c=t(17545),i=t(58338),u=t(29449),p=t(95747),h=t(63960),m=t(82746),g=t(48838),x=t(75291),f=t(70579);const y={triggerOnce:!0,rootMargin:"100px"},b=["grey","yellow","red"],A=e=>Math.round(100*e)/100,S=()=>{const[e,s]=(0,n.Wx)(y),{accessionAndMdNumber:t,metadata:S,topology:M,populations:j}=(0,a.useContext)(u.f),C=M&&M.defaultRepresentations,_=(0,a.useRef)(null),k=(0,a.useRef)(null),{loading:R,payload:v,error:$}=(0,i.A)(`${p.nP}/${t}/analyses/rmsd-perres/`),[D,T]=(0,a.useState)([]),{components:w,representations:N,analysisFrameCount:E,xAxisStep:F,xAxisLabel:L,isEnsemble:I,xTooltip:P,data:W,xWeights:G}=(0,a.useMemo)(()=>{if(!M||!S||!v||j&&j.loading)return{};const e=v.rmsdpr,s=[],a=[];e.forEach(e=>{if(null===e)s.push(null),a.push(null);else{const[t,n]=(e=>{const s=e.length,t=e.reduce((e,s)=>e+s)/s,a=Math.sqrt(e.map(e=>Math.pow(e-t,2)).reduce((e,s)=>e+s)/s);return[A(t),A(a)]})(e);s.push(t),a.push(n)}});const n={rmsdpr:e,means:s,stdvs:a},r=Math.max(...s),o=Math.min(...s),d=(0,l.m4Y)().range(b).domain([o,(o+r)/2,r]),c=m.hD.addScheme(function(e){this.atomColor=e=>{const t=e.residueIndex,a=s[t];if(null===a)return 16777215;const n=(0,l.yWT)(d(a)).formatHex();return parseInt(n.substring(1),16)}}),i=S.mdFrames,u=v.step,h=[{trajectoryURLs:[`${`${p.nP}/${t}/trajectory`}?frames=1:${i}:${u}`]}],g=[];C.forEach(e=>{const s={...e};s.color="custom",s.customScheme=c,g.push(s)});const x=e[0].length,f=S.timeLength,y="ensemble"===S.TYPE;let _,k,R,$;if(y||!f?(_=u,k="Frames",R=e=>"frame "+e):(_=f/(x-1),k="Time (ns)",R=e=>+e.toFixed(2)+" ns"),j&&j.payload){$=[];for(let e=0;e<j.payload.length;e+=_)$.push(j.payload[e])}return{components:h,representations:g,analysisFrameCount:x,xAxisStep:_,xAxisLabel:k,isEnsemble:y,xTooltip:R,data:n,xWeights:$}},[v,M,S,t,C,j]),{selectedData:V,selectedResidueIndices:Y}=(0,a.useMemo)(()=>{const e={},s=[];return D.forEach((t,a)=>{const n={data:W.rmsdpr[t.index]};n.color=t.color,e[a]=n,s.push(t.index)}),{selectedData:e,selectedResidueIndices:s}},[W,D]),q=(0,a.useCallback)(e=>{_.current.togglePlaying(!1),_.current.currentFrame=e},[]),B=(0,a.useCallback)(e=>{if(!k.current)return;const s=Math.round(e*(E-1));k.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]},[E]),H=(0,a.useCallback)((e,s,t)=>{const a={color:t,index:s};T(e=>[...e,a])},[T]),J=(0,a.useCallback)((e,s)=>{T(e=>e.filter(e=>e.index!==s))},[T]),K=(0,a.useCallback)(()=>{T([])},[T]),O=(0,a.useCallback)((e,s)=>{const t=W.means[s],a=W.stdvs[s];return`Mean RMSD: ${Math.round(100*t)/100}\nStandard deviation: ${Math.round(100*a)/100}`},[W]);return R||j&&j.loading?(0,f.jsx)(c.A,{}):$?$.toString():j&&j.error?j.error.toString():v?j&&!j.payload?"Something bad happened with populations":M?(0,f.jsxs)(a.Suspense,{fallback:(0,f.jsx)(c.A,{}),children:[(0,f.jsx)(o.A,{children:(0,f.jsx)(g.A,{residueValues:W.means,legendTitle:"Average RMSD (\xc5)",onSelect:H,onDeselect:J,onClean:K,onTooltip:O})}),(0,f.jsx)(o.A,{className:h.default.graphcard,children:D.length>0?(0,f.jsx)(x.default,{yData:V,step:F,xAxisLabel:L,type:I?"dots":"line",xWeights:G,xTooltip:P,yAxisLabel:"RMSD (\xc5)",onSelect:q,className:h.default.graph,ref:k}):(0,f.jsx)("div",{className:h.default["graph-placeholder"],children:(0,f.jsx)(r.A,{variant:"h6",children:"No residue selected"})})}),(0,f.jsx)(o.A,{className:h.default.nglcard,ref:e,children:s?(0,f.jsx)(d.default,{className:h.default.container,startingComponents:w,startingRepresentations:N,selectedResidueIndices:Y,onProgress:B,ref:_,framesSelect:!1}):(0,f.jsx)("div",{style:{height:"50vh"}})})]}):(0,f.jsx)(c.A,{}):"Something bad happened with the analysis data"}},63960:(e,s,t)=>{t.r(s),t.d(s,{default:()=>a});const a={graphcard:"style_graphcard__VoJ6R",graph:"style_graph__GoAAc","graph-placeholder":"style_graph-placeholder__bh3Kw",nglcard:"style_nglcard__Zr+kp",container:"style_container__lBCpG"}}}]);
//# sourceMappingURL=5919.a5dcbd02.chunk.js.map