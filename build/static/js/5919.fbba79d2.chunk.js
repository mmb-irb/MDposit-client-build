"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[3960,5919,9117],{50953:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var s=a(89379),n=a(65043),r=a(89257),l=a(85865),o=a(57631),c=a(10939),d=a(14696),i=a(17545),u=a(58338),p=a(29449),h=a(95747),m=a(63960),g=a(82746),x=a(48838),f=a(75291),y=a(70579);const b={triggerOnce:!0,rootMargin:"100px"},A=["grey","yellow","red"],S=e=>Math.round(100*e)/100,M=()=>{const[e,t]=(0,r.Wx)(b),{accessionAndMdNumber:a,metadata:M,topology:j,populations:C}=(0,n.useContext)(p.f),_=j&&j.defaultRepresentations,k=(0,n.useRef)(null),R=(0,n.useRef)(null),{loading:v,payload:D,error:T}=(0,u.A)("".concat(h.nP,"/").concat(a,"/analyses/rmsd-perres/")),[w,N]=(0,n.useState)([]),{components:E,representations:F,analysisFrameCount:L,xAxisStep:I,xAxisLabel:P,isEnsemble:W,xTooltip:G,data:V,xWeights:Y}=(0,n.useMemo)(()=>{if(!j||!M||!D||C&&C.loading)return{};const e=D.rmsdpr,t=[],n=[];e.forEach(e=>{if(null===e)t.push(null),n.push(null);else{const[a,s]=(e=>{const t=e.length,a=e.reduce((e,t)=>e+t)/t,s=Math.sqrt(e.map(e=>Math.pow(e-a,2)).reduce((e,t)=>e+t)/t);return[S(a),S(s)]})(e);t.push(a),n.push(s)}});const r={rmsdpr:e,means:t,stdvs:n},l=Math.max(...t),c=Math.min(...t),d=(0,o.m4Y)().range(A).domain([c,(c+l)/2,l]),i=g.hD.addScheme(function(e){this.atomColor=e=>{const a=e.residueIndex,s=t[a];if(null===s)return 16777215;const n=(0,o.yWT)(d(s)).formatHex();return parseInt(n.substring(1),16)}}),u=M.mdFrames,p=D.step,m="".concat(h.nP,"/").concat(a,"/trajectory"),x=[{trajectoryURLs:["".concat(m,"?frames=1:").concat(u,":").concat(p)]}],f=[];_.forEach(e=>{const t=(0,s.A)({},e);t.color="custom",t.customScheme=i,f.push(t)});const y=e[0].length,b=M.timeLength,k="ensemble"===M.TYPE;let R,v,T,w;if(k||!b?(R=p,v="Frames",T=e=>"frame "+e):(R=b/(y-1),v="Time (ns)",T=e=>+e.toFixed(2)+" ns"),C&&C.payload){w=[];for(let e=0;e<C.payload.length;e+=R)w.push(C.payload[e])}return{components:x,representations:f,analysisFrameCount:y,xAxisStep:R,xAxisLabel:v,isEnsemble:k,xTooltip:T,data:r,xWeights:w}},[D,j,M,a,_,C]),{selectedData:q,selectedResidueIndices:B}=(0,n.useMemo)(()=>{const e={},t=[];return w.forEach((a,s)=>{const n={data:V.rmsdpr[a.index]};n.color=a.color,e[s]=n,t.push(a.index)}),{selectedData:e,selectedResidueIndices:t}},[V,w]),H=(0,n.useCallback)(e=>{k.current.togglePlaying(!1),k.current.currentFrame=e},[]),J=(0,n.useCallback)(e=>{if(!R.current)return;const t=Math.round(e*(L-1));R.current.marks=[{x:t,attr:{fill:"#c8c8c8"}}]},[L]),K=(0,n.useCallback)((e,t,a)=>{const s={color:a,index:t};N(e=>[...e,s])},[N]),O=(0,n.useCallback)((e,t)=>{N(e=>e.filter(e=>e.index!==t))},[N]),U=(0,n.useCallback)(()=>{N([])},[N]),Z=(0,n.useCallback)((e,t)=>{const a=V.means[t],s=V.stdvs[t],n=Math.round(100*a)/100,r=Math.round(100*s)/100;return"Mean RMSD: ".concat(n,"\nStandard deviation: ").concat(r)},[V]);return v||C&&C.loading?(0,y.jsx)(i.A,{}):T?T.toString():C&&C.error?C.error.toString():D?C&&!C.payload?"Something bad happened with populations":j?(0,y.jsxs)(n.Suspense,{fallback:(0,y.jsx)(i.A,{}),children:[(0,y.jsx)(c.A,{children:(0,y.jsx)(x.A,{residueValues:V.means,legendTitle:"Average RMSD (\xc5)",onSelect:K,onDeselect:O,onClean:U,onTooltip:Z})}),(0,y.jsx)(c.A,{className:m.default.graphcard,children:w.length>0?(0,y.jsx)(f.default,{yData:q,step:I,xAxisLabel:P,type:W?"dots":"line",xWeights:Y,xTooltip:G,yAxisLabel:"RMSD (\xc5)",onSelect:H,className:m.default.graph,ref:R}):(0,y.jsx)("div",{className:m.default["graph-placeholder"],children:(0,y.jsx)(l.A,{variant:"h6",children:"No residue selected"})})}),(0,y.jsx)(c.A,{className:m.default.nglcard,ref:e,children:t?(0,y.jsx)(d.default,{className:m.default.container,startingComponents:E,startingRepresentations:F,selectedResidueIndices:B,onProgress:J,ref:k,framesSelect:!1}):(0,y.jsx)("div",{style:{height:"50vh"}})})]}):(0,y.jsx)(i.A,{}):"Something bad happened with the analysis data"}},63960:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});const s={graphcard:"style_graphcard__VoJ6R",graph:"style_graph__GoAAc","graph-placeholder":"style_graph-placeholder__bh3Kw",nglcard:"style_nglcard__Zr+kp",container:"style_container__lBCpG"}}}]);
//# sourceMappingURL=5919.fbba79d2.chunk.js.map