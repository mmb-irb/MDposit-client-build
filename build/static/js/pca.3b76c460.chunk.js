"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[6797],{10939:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(65043),r=n(12110),s=n(17604);const c="style_container__M9GCG";var i=n(70579);const o={opacity:[0,1]};(0,s.A)()||(o.transform=["translateY(50px)","translateY(0)"]);const l={fill:"both",easing:"cubic-bezier(0, .99, .56, 1.1)",duration:500},d=(0,a.forwardRef)(((e,t)=>{let{overrideComponent:n,...s}=e;const d=(0,a.useRef)(null);(0,a.useLayoutEffect)((()=>{const e=d.current&&d.current.firstElementChild;if(!e||!e.animate)return;const t=Array.from(document.querySelectorAll("main section")).findIndex((t=>e===t)),n=e.animate(o,{...l,delay:150*t});return()=>n.cancel()}),[]);const u=n?"section":r.A;return(0,i.jsx)("div",{ref:d,className:c,children:(0,i.jsx)(u,{component:"section",...s,ref:t})})}))},34088:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(65043),r=n(43126),s=n(10939);const c="style_rnd__Txifm",i="style_floating-card__HHpby";var o=n(70579);const l=(0,a.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2594),n.e(9070),n.e(8280),n.e(6190),n.e(1235),n.e(9117)]).then(n.bind(n,92428))));let d=0;const u=e=>{const t=e.viewerRef||(0,a.useRef)(null),[n,u]=(0,a.useState)((()=>{const{innerWidth:e,innerHeight:t,scrollY:n}=window,a=document.querySelector("main").offsetTop,r=Math.max(Math.min(e/4,t/4),150),s=1.5*r;return{width:2*r,height:s,x:0,y:t-a-s-20+n}}));return(0,o.jsx)(r.p,{position:{x:n.x,y:n.y},size:{width:n.width,height:n.height},style:{zIndex:(d+=1,d)},className:c,"data-rnd":!0,bounds:"window",cancel:"canvas, [data-popover], #preventDragSize",onDragStart:()=>{u({...n})},onResizeStart:()=>{u({...n})},onDragStop:(e,t)=>{0===e.layerX&&0===e.layerY||n.x===t.x&&n.y===t.y||u({...n,x:t.x,y:t.y})},onResize:()=>t.current&&t.current.autoResize(),onResizeStop:(e,t,n,a,r)=>{u({width:n.style.width,height:n.style.height,...r})},children:(0,o.jsx)(s.A,{className:i,elevation:4,children:(0,o.jsx)(a.Suspense,{fallback:null,children:(0,o.jsx)(l,{className:i,ref:t,startsPlaying:!1,...e})})})})},p=e=>{let{newViewer:t,nailing:n=!0,onNail:r,onClose:s}=e;const[c,i]=(0,a.useState)([]),l=[...c],d=(0,a.useRef)([]);if(t){const e=()=>{let e=0;for(;e<999;){if(-1===d.current.indexOf(e))return e;e+=1}console.error("Maximum number of viewers reached")};t.id=e(),t.close=()=>{n&&i((e=>{const n=[...e],a=e.indexOf(t);return-1!==a&&n.splice(a,1),n})),s&&s(t),d.current.push(t.id)},n&&(t.nail=()=>{i((e=>[...e,t])),r&&r(t),d.current.push(t.id)}),l.push(t)}return l.map((e=>(0,o.jsx)(u,{...e},e.id)))}},41604:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var a=n(65043),r=n(64600),s=n.n(r),c=n(26494),i=n(85865),o=n(10939),l=n(34088),d=n(40830),u=n(31133),p=n(3777),h=n(32222),x=n(3152),m=u.A.isFinite,g=Math.min;const f=function(e){var t=Math[e];return function(e,n){if(e=(0,h.A)(e),(n=null==n?0:g((0,p.A)(n),292))&&m(e)){var a=((0,x.A)(e)+"e").split("e"),r=t(a[0]+"e"+(+a[1]+n));return+((a=((0,x.A)(r)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var v=n(32577),y=n(71806),j=n(84882),A=n(28076),_=n(10039),w=n(73460),b=n(11906),P=n(92127),S=n(44642),E=n(17604);const R="style_delete__BYITu",F="style_graph-container__2Y--C",N="style_axis__z8ryu",C="style_visual__S4w3g",k="style_bars__p3cKG",z="style_has-projection__R+xxb",M="style_projected__M7dqT",Y="style_target__Kzgs+",q="style_explanation__kphn8",B="style_top-line__WYRxq",H="style_area__BwFoU",L="style_tooltip__ZrzAO";var D=n(70579);const I=20,T=40,U=20,W=30,O=e=>{let{eigenvalues:t,totalEigenvalue:n,projectionsData:r,projections:s=[],setProjections:c}=e;const i=(0,a.useRef)(null),o=(0,a.useRef)(null),l=(0,a.useRef)(d.A),u=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const e=(0,v.Ltv)(i.current).append("svg");e.append("defs").append("clipPath").attr("id","clip-reveal").append("rect").attr("x",0).attr("y",0).attr("height","100%").attr("width",0).transition().duration((0,E.A)()?0:2150).attr("width","100%");const a={xAxis:e.append("g").attr("class",N),yExplAxis:e.append("g").attr("class",N),yEigenAxis:e.append("g").attr("class",N),explanationArea:e.append("g").attr("class",q),visualBars:e.append("g").attr("class","".concat(C," ").concat(k)),targetBars:e.append("g").attr("class","".concat(Y," ").concat(k))};return l.current=function(){let{processed:r=u.current}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clientWidth:s,clientHeight:l}=i.current;e.attr("width",s).attr("height",l);const d=(0,v.WH)().domain(r.map(((e,t)=>t))).range([W,s-T]).padding(.1);a.xAxis.call((e=>e.attr("transform","translate(0, ".concat(l-U,")")).call((0,v.l78)(d).tickFormat((e=>e+1)))));const p=(0,v.m4Y)().domain([0,1]).range([l-U,I]).nice();a.yExplAxis.call((e=>e.attr("transform","translate(".concat(s-T,", 0)")).call((0,v.eH3)(p).ticks(6).tickFormat((e=>"".concat(100*("number"===typeof e?e:0),"%"))))));const h=(0,v.n8j)().x(((e,t)=>d(t)+d.bandwidth()/2)).y(p),x=a.explanationArea.selectAll("path.".concat(B)).data([r]);x.enter().append("path").attr("class",B).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(x).attr("d",(e=>h(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const m=(0,v.Wcw)().x(((e,t)=>d(t)+d.bandwidth()/2)).y0(l-U).y1((e=>p(e))),g=a.explanationArea.selectAll("path.".concat(H)).data([r]);g.enter().append("path").attr("class",H).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(g).attr("d",(e=>m(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const f=(0,v.m4Y)().domain([0,t[0]]).range([l-U,I]).nice();a.yEigenAxis.call((e=>e.attr("transform","translate(".concat(W,", 0)")).call((0,v.V4s)(f).ticks(5))));const y=a.visualBars.selectAll("rect").data(r);if(y.enter().append("rect").attr("y",f(0)).attr("height",0).merge(y).attr("class",(e=>{let{hasProjection:t,projected:n}=e;return"".concat(t?z:""," ").concat(n?M:"").trim()||null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth()).transition().ease(v.g9.overshoot(5)).duration((0,E.A)()?0:500).delay((0,E.A)()?0:(e,t)=>50*t).attr("y",(e=>f(e.eigenvalue))).attr("height",(e=>l-U-f(e.eigenvalue))),!o.current)return;const j=a.targetBars.selectAll("rect").data(r);j.enter().append("rect").attr("y",0).attr("height","100%").on("click",((e,t)=>{let{hasProjection:n}=e;n&&c((e=>{const n=new Set(e);return n[n.has(t)?"delete":"add"](t),Array.from(n).sort(((e,t)=>e-t))}))})).on("mousemove",((e,t)=>{o.current.innerHTML="\n            <div>\n              <p>Principal component ".concat(t+1,"</p>\n              <p>Eigenvalue: ").concat((Math.round(100*e.eigenvalue)/100).toFixed(2),"</p>\n              <p>\n                Explained variance: ").concat((Math.round(e.eigenvalue/n*1e3)/10).toFixed(1),"%\n              </p>\n              <p>\n                Cumulative explained variance: ").concat((Math.round(1e3*e.cumulativeExplained)/10).toFixed(1),"%\n              </p>\n              <p>Projection data is ").concat(e.hasProjection?"":"not"," available</p>\n            </div>\n          "),o.current.style.opacity=1})).on("mouseout",(()=>o.current.style.opacity=0)).merge(j).attr("class",(e=>{let{hasProjection:t}=e;return t?z:null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth())},window.addEventListener("resize",l.current),()=>window.removeEventListener("resize",l.current)}),[t,c,n]),(0,a.useEffect)((()=>{let e=0;const a=[];for(const[c,i]of t.entries()){const t=r[c];e+=i;const o=e/n;if(a.push({cumulativeExplained:o,eigenvalue:i,projected:s.includes(c),hasProjection:!!t}),c>=14&&o>=.8)break}u.current=a,l.current({processed:a})}),[t,r,n,s]),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{className:F,ref:i}),(0,D.jsx)("div",{className:L,ref:o}),!!s.length&&(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(y.A,{children:[(0,D.jsx)(j.A,{children:(0,D.jsxs)(A.A,{children:[(0,D.jsx)(_.A,{children:"Principal component"}),(0,D.jsx)(_.A,{children:"Eigenvalue"}),(0,D.jsx)(_.A,{children:"Explained variance"})]})}),(0,D.jsx)(w.A,{children:s.map((e=>(0,D.jsxs)(A.A,{children:[(0,D.jsx)(_.A,{children:e+1}),(0,D.jsx)(_.A,{children:f(t[e],2)}),(0,D.jsxs)(_.A,{children:[f(t[e]/n*100,1)," %"]})]},e)))})]}),(0,D.jsxs)(b.A,{variant:"contained",onClick:()=>c([]),className:R,children:[(0,D.jsx)(P.g,{icon:S.UB}),"\xa0",(0,D.jsx)("span",{children:"Clear selection"})]})]})]})};var V=n(17545),G=n(58338),K=n(29449),X=n(95747);const Z=(e,t)=>{if(!e.length)return"No projection selected, please select one or multiple projections to\n    visualise its or their related data. Only the darker blue bars correspond to\n    projections for which data has been calculated.";let n;return n=1===e.length?e[0]+1:2===e.length?"".concat(e[0]+1," and ").concat(e[1]+1):e.reduce(((e,t,n,a)=>{let{length:r}=a;return"".concat(e).concat(e?",":"").concat(n===r-1?" and":""," ").concat(t+1)}),""),"Selected principal component".concat(e.length>1?"s":""," ").concat(n,", accounting for ").concat(f(100*t,1),"% of explained variance")},J="style_card__6C+Fc",Q="style_ngl-card__+pU8V",$="style_placeholder__2w0--",ee="style_projection__v0o3I",te="style_viewer-with-controls__nFIv5",ne=(0,a.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2594),n.e(9070),n.e(8280),n.e(6190),n.e(1235),n.e(9117)]).then(n.bind(n,92428)))),ae=(0,a.lazy)((()=>Promise.all([n.e(6264),n.e(7515)]).then(n.bind(n,8018)))),re=(0,D.jsx)("div",{className:s()($,ee)}),se=(0,D.jsx)("div",{className:s()($,te)}),ce=()=>{const{accession:e,accessionAndMdNumber:t,metadata:n,files:r}=(0,a.useContext)(K.f),{loading:s,payload:d,error:u}=(0,G.A)("".concat(X.nP,"/").concat(t,"/analyses/pca/")),p=d&&d.data,[h,x]=(0,a.useState)([]),[m,g]=(0,a.useState)(null),[f,v]=(0,a.useMemo)((()=>{if(g(null),!p)return[];const e=p.eigenvalues;if(!e.length)return[];const t=e.reduce(((e,t)=>e+t),0);return[h.reduce(((t,n)=>t+e[n]),0)/t,t]}),[p,h]),[y,j]=(0,a.useMemo)((()=>{if(!p||!r)return[void 0,void 0];let e;if(void 0!==h[0]){const n=("0"+(h[0]+1)).slice(-2);e=["".concat(X.nP,"/").concat(t,"/files/pca_trajectory_").concat(n,".bin")]}return[[{name:"PC projection",type:"spacefill"}],[{topologyURL:"".concat(X.nP,"/").concat(t,"/files/structure"),atomSelection:"@"+p.atoms.join(","),trajectoryURLs:e}]]}),[p,r,h,e]);return s?(0,D.jsx)(V.A,{}):u?u.toString():(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(o.A,{className:J,children:(0,D.jsxs)(c.A,{children:[(0,D.jsx)(i.A,{variant:"h6",children:"PCA eigenvalues"}),(0,D.jsx)(O,{eigenvalues:p.eigenvalues,totalEigenvalue:v,projectionsData:p.projections,projections:h,setProjections:x})]})}),(0,D.jsx)(o.A,{className:J,children:(0,D.jsxs)("div",{children:[(0,D.jsxs)(c.A,{children:[(0,D.jsx)(i.A,{variant:"h6",children:"PCA projections"}),(0,D.jsx)("p",{children:Z(h,f)})]}),1===h.length&&(0,D.jsx)(a.Suspense,{fallback:se,children:(0,D.jsx)(c.A,{className:Q,children:(0,D.jsx)(ne,{className:te,projection:h[0],framesSelect:!1,startingRepresentations:y,startingComponents:j,bounce:!0})})}),2===h.length&&(0,D.jsx)(a.Suspense,{fallback:re,children:(0,D.jsx)(c.A,{children:(0,D.jsx)(ae,{framestep:p.framestep,projectionsData:p.projections,projections:h,datumRange:p.eigenvalues.length,totalFrames:n.mdFrames,setRequestedFrame:g})})})]})}),(0,D.jsx)(l.A,{newViewer:Number.isFinite(m)?{requestedFrame:m}:null,onNail:e=>g((t=>e.requestedFrame===t?null:t)),onClose:e=>g((t=>e.requestedFrame===t?null:t))})]})}},10500:(e,t,n)=>{n.d(t,{A:()=>a});const a=function(e,t){for(var n=-1,a=null==e?0:e.length,r=Array(a);++n<a;)r[n]=t(e[n],n,e);return r}},28593:(e,t,n)=>{n.d(t,{A:()=>a});const a=Array.isArray},40830:(e,t,n)=>{n.d(t,{A:()=>a});const a=function(){}},3777:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(99944);const r=function(e){var t=(0,a.A)(e),n=t%1;return t===t?n?t-n:t:0}},3152:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(54577),r=n(10500),s=n(28593),c=n(28666),i=a.A?a.A.prototype:void 0,o=i?i.toString:void 0;const l=function e(t){if("string"==typeof t)return t;if((0,s.A)(t))return(0,r.A)(t,e)+"";if((0,c.A)(t))return o?o.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const d=function(e){return null==e?"":l(e)}}}]);
//# sourceMappingURL=pca.3b76c460.chunk.js.map