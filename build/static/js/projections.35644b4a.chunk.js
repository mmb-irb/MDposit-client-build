"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[7515],{8018:(t,e,n)=>{n.r(e),n.d(e,{default:()=>E});var a=n(89379),r=n(65043),c=n(40830),l=n(88058),i=n(45180),s=n(75040),o=n(80705),d=n(57631),u=n(60093),x=n(39766),h=n(64600),p=n.n(h),m=n(92954);const g=window.devicePixelRatio||1,f=d._9v.amplitude(1).period(.5);let y;var v=n(17604),w=n(17392),S=n(92127),M=n(12639);const _={"graph-container":"style_graph-container__oCOoS",axis:"style_axis__H0KE8","legend-text":"style_legend-text__Zvd0H",legend:"style_legend__kYAHJ",switch:"style_switch__vPk4i",switched:"style_switched__DLS7l","color-scale":"style_color-scale__mIyZh",cursor:"style_cursor__uJXdm",tooltip:"style_tooltip__S2WeP"};var A=n(70579);const R=window.devicePixelRatio||1,b=10,j=10,C=25,k=25,L=500,[P,Y]=[375,625],X=(0,d.exT)(d.GAA),E=t=>{let{framestep:e,projectionsData:n,projections:h,datumRange:E,totalFrames:I,setRequestedFrame:T}=t;const F=(0,r.useRef)(null),N=(0,r.useRef)(null),W=(0,r.useRef)(c.A),B=(0,r.useRef)(null),D=(0,r.useRef)(null),G=(0,r.useRef)(null),H=(0,r.useRef)({find(){}}),[J,z]=(0,m.A)(!1),q=(0,r.useMemo)(()=>n&&n[0].length||0,[n]);return(0,r.useEffect)(()=>{const t=(0,d.Ltv)(F.current).append("canvas"),n=(0,d.Ltv)(F.current).append("svg"),a=t.node().getContext("2d",{alpha:!1,desynchronized:!0}),r=(0,d.V$7)(),c={xScale:(0,d.m4Y)(),yScale:(0,d.m4Y)(),xAxis:n.append("g").attr("class",_.axis),yAxis:n.append("g").attr("class",_.axis),xAxisLegend:n.append("text").attr("class",p()(_.axis,_["legend-text"])),yAxisLegend:n.append("text").attr("class",p()(_.axis,_["legend-text"])),dataPoints:n.append("g").attr("class",_["data-points"]),hover:n.append("circle").attr("fill","transparent"),legendCanvas:(0,d.Ltv)(N.current).select("canvas"),legendCursor:(0,d.Ltv)(N.current).select(".".concat(_.cursor)),brush:r,brushElement:n.append("g").attr("class","brush")};c.drawLegend=(0,l.A)((t=>(e,n,a,r,c)=>{const l=t.createImageData(e.length,1),i=new Uint32Array(l.data.buffer);e.forEach((t,e)=>{let{x:l,y:s,fill:{r:o,g:d,b:u}}=t,x=255;if(n){const t=n(l);if(t<0||t>r)x=100;else{const t=a(s);(t<0||t>c)&&(x=100)}}i[e]=16777216*x+65536*u+256*d+o}),t.putImageData(l,0,0)})(c.legendCanvas.node().getContext("2d",{alpha:!0})),L+Y);const o=function(){let{onlyTooltip:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.current.style.display="none",c.hover.attr("fill","transparent"),t||(c.legendCursor.style("left",""),c.legendCursor.style("opacity",0))},u=function(){let{datumIndex:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T(n=>{if(t<0||t>=q)return n;if(!I)return console.error("No number of frames in metadata. Are we missing the main trajectory?"),null;const a=t*e;return a===n?null:a})};return W.current=async function(){let{processed:e=D.current,brushing:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)return;if(await(0,x.Gt)(),!F.current.firstChild)return;const{clientWidth:l,clientHeight:h}=F.current;n.attr("width",l).attr("height",h),t.attr("width")!=="".concat(l*R)&&t.attr("width",l*R),t.attr("height")!=="".concat(h*R)&&t.attr("height",h*R),t.style("width","".concat(l,"px")).style("height","".concat(h,"px")),c.brushElement.call(c.brush);const p=!B.current;c.xScale.range([k,l-j]),r||c.xScale.domain(e.xMinMax),c.yScale.range([h-C,b]),r||c.yScale.domain(e.yMinMax);c.xAxis.transition().duration(!p&&!(0,v.A)()&&L+Y).call(t=>t.attr("transform","translate(0, ".concat((0,i.A)(c.yScale(0),0,h-32),")")).call((0,d.l78)(c.xScale).ticks(Math.round(l/75)).tickFormat(t=>0===t?null:t))),c.xAxisLegend.text("\u2190 principal component ".concat(e.projections[0]+1," \u2192")).transition().duration(!p&&!(0,v.A)()&&L+Y).attr("transform","translate(".concat(l/2,", ").concat(h-5,")"));c.yAxis.transition().duration(!p&&!(0,v.A)()&&L+Y).call(t=>t.attr("transform","translate(".concat((0,i.A)(c.xScale(0),30,l-1),", 0)")).call((0,d.V4s)(c.yScale).ticks(Math.round(h/75)).tickFormat(t=>0===t?null:t))),c.yAxisLegend.text("\u2190 principal component ".concat(e.projections[1]+1," \u2192")).transition().duration(!p&&!(0,v.A)()&&L+Y).attr("transform","translate(5, ".concat(h/2,") rotate(90)")),c.brush.on("end",()=>{const{selection:t}=d.f0J;t&&(c.xScale.domain([t[0][0],t[1][0]].map(c.xScale.invert,c.xScale)),c.yScale.domain([t[1][1],t[0][1]].map(c.yScale.invert,c.yScale)),c.brushElement.call(c.brush.move,null),W.current({brushing:!0}))});const m=Math.log(Math.max((e.xMinMax[1]-e.xMinMax[0])/(c.xScale.domain()[1]-c.xScale.domain()[0]),(e.yMinMax[1]-e.yMinMax[0])/(c.yScale.domain()[1]-c.yScale.domain()[0])))+1,w=R*Math.min(l,h)*m/250;c.hover.attr("r",w+5);let S=0;const M=p?0:B.current.currentRadius;B.current=e.data.map((t,e,n)=>{let{x:a,y:r,fill:l}=t,{length:i}=n;const o=c.xScale(a)*R,u=c.yScale(r)*R,x=e*L*(p?2:1)/i,h=(0,v.A)()?0:(0,s.A)(P,Y)*(p?2:1),m=x+h;return S<m&&(S=m),{currentX:null,currentY:null,currentRadius:null,interpolateX:(0,d.GWP)(p?c.xScale(0)*R:B.current[e].currentX||B.current[e].x,o),interpolateY:(0,d.GWP)(p?c.yScale(0)*R:B.current[e].currentY||B.current[e].y,u),delay:x,duration:h,x:o,y:u,fill:l}}),B.current.interpolateRadius=(0,d.GWP)(M,w),(t=>{let{context:e,dataPoints:n,width:a,height:r,maxTime:c,isFirstTime:l}=t;new Promise(t=>{y&&y.stop(),y=(0,d.O1W)(i=>{const s=i>=c;s?(y.stop(),e.fillStyle="white",e.fillRect(0,0,a*g,r*g)):(e.fillStyle="rgba(255, 255, 255, 0.25)",e.fillRect(0,0,a*g,r*g));for(const t of n){const c=Math.max(0,(l?f:d.oRn)(Math.min((i-t.delay)/t.duration,1)));t.currentX=t.interpolateX(c),t.currentX<0||t.currentX>a||(t.currentY=t.interpolateY(c),n.currentRadius=n.interpolateRadius(c),t.currentY<0||t.currentY>r||(e.fillStyle=t.fill.hex,e.beginPath(),e.arc(t.currentX,t.currentY,n.currentRadius,0,2*Math.PI),e.fill()))}s&&t()})})})({context:a,dataPoints:B.current,width:l*R,height:h*R,maxTime:S,isFirstTime:p});const _=function(){let{datumIndex:t,datum:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Number.isInteger(t)||!n)return;c.legendCursor.style("left","calc(".concat(100*t/e.data.length,"% - 4px)")),c.legendCursor.style("opacity",1);const a=c.xScale(n.x);if(a<0||a>l)return o({onlyTooltip:!0});const r=c.yScale(n.y);if(r<0||r>h)return o({onlyTooltip:!0});const{scrollX:i,scrollY:s}=window,{left:d,top:u}=F.current.getBoundingClientRect();G.current.innerHTML="\n          <div>\n            <p>Frame ".concat(t*e.framestep+1," (click to open viewer)</p>\n            <p>Principal component ").concat(e.projections[0]+1,": ").concat(n.x,"</p>\n            <p>Principal component ").concat(e.projections[1]+1,": ").concat(n.y,"</p>\n          </div>\n        "),G.current.style.display="inline-block";const x=G.current.getBoundingClientRect();G.current.style.transform="translate(".concat(a+d+i-x.width/2,"px, ").concat(r+u+s-x.height-15,"px)"),c.hover.attr("cx",a).attr("cy",r).attr("fill",n.fill.hex)},A=t=>()=>{const{scrollX:n,scrollY:a}=window,{left:r,top:l}=F.current.getBoundingClientRect(),{pageX:i,pageY:s}=d.f0J,u=i-r-n,x=s-l-a,h=H.current.find(c.xScale.invert(u),c.yScale.invert(x)),p=e.data[h];if(p){const e=c.xScale(p.x),n=c.yScale(p.y);if(Math.sqrt(Math.abs(e-u)**2+Math.abs(n-x)**2)<=20)return t({datumIndex:h,datum:p})}o(),t()};n.on("mousemove",A(_)).on("mouseout",o).on("click",A(u));const X=t=>()=>{const n=c.legendCanvas.node();if(!n||!("getBoundingClientRect"in n))return;const{left:a,width:r}=n.getBoundingClientRect(),{pageX:l}=d.f0J,i=(l-a)/r,s=Math.floor(i*e.data.length);t({datumIndex:s,datum:e.data[s]})};c.drawLegend(e.data,c.xScale,c.yScale,l,h),c.legendCanvas.on("mousemove",X(_)).on("mouseout",o).on("click",X(u))},window.addEventListener("resize",W.current),()=>{c.drawLegend&&c.drawLegend.cancel(),window.removeEventListener("resize",W.current)}},[h,T,E,I]),(0,r.useEffect)(()=>{const[t,r]=J?[0,1]:[1,0],c=X.domain([0,q]),l=n[h[t]],i=n[h[r]],s=(0,o.A)(l,i),p={data:s.map((t,e)=>{let[n,r]=t;const l=c(e);return{x:n,y:r,fill:(0,a.A)({hex:l},(0,d.Qhc)(l))}}),xMinMax:[Math.min(...l),Math.max(...l)],yMinMax:[Math.min(...i),Math.max(...i)],framestep:e,projections:[h[t],h[r]]};D.current=p,W.current({processed:p}),(async()=>{await(0,x.yy)(L+Y),await(0,x._)(100),H.current=u.A.from(s)})()},[n,q,h,e,J]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{className:_["graph-container"],onDoubleClick:W.current,ref:F}),(0,A.jsxs)("div",{className:_.legend,children:[(0,A.jsx)(w.A,{title:"Switch axes",className:p()(_.switch,{[_.switched]:J}),onClick:z,size:"large",children:(0,A.jsx)(S.g,{icon:M.fKj})}),(0,A.jsx)("p",{children:"position in simulation:"}),(0,A.jsxs)("div",{className:_["color-scale"],children:[(0,A.jsx)("div",{children:"start"}),(0,A.jsxs)("div",{ref:N,children:[(0,A.jsx)("canvas",{height:"1",width:q}),(0,A.jsx)("div",{className:_.cursor})]}),(0,A.jsx)("div",{children:"end"})]})]}),(0,A.jsx)("div",{className:_.tooltip,ref:G})]})}}}]);
//# sourceMappingURL=projections.35644b4a.chunk.js.map