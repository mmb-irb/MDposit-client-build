"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[7515],{8018:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r=n(65043),a=n(40830),l=n(88058),i=n(45180),s=n(75040),c=n(80705),o=n(32577),d=n(60093),u=n(39766),x=n(64600),h=n.n(x),p=n(92954);const m=window.devicePixelRatio||1,g=o._9v.amplitude(1).period(.5);let f;var y=n(17604),v=n(17392),w=n(92127),S=n(12639);const M={"graph-container":"style_graph-container__oCOoS",axis:"style_axis__H0KE8","legend-text":"style_legend-text__Zvd0H",legend:"style_legend__kYAHJ",switch:"style_switch__vPk4i",switched:"style_switched__DLS7l","color-scale":"style_color-scale__mIyZh",cursor:"style_cursor__uJXdm",tooltip:"style_tooltip__S2WeP"};var _=n(70579);const A=window.devicePixelRatio||1,R=10,b=10,j=25,C=25,$=500,[k,L]=[375,625],P=(0,o.exT)(o.GAA),Y=e=>{let{framestep:t,projectionsData:n,projections:x,datumRange:Y,totalFrames:X,setRequestedFrame:E}=e;const I=(0,r.useRef)(null),T=(0,r.useRef)(null),F=(0,r.useRef)(a.A),N=(0,r.useRef)(null),W=(0,r.useRef)(null),B=(0,r.useRef)(null),D=(0,r.useRef)({find(){}}),[G,H]=(0,p.A)(!1),J=(0,r.useMemo)((()=>n&&n[0].length||0),[n]);return(0,r.useEffect)((()=>{const e=(0,o.Ltv)(I.current).append("canvas"),n=(0,o.Ltv)(I.current).append("svg"),r=e.node().getContext("2d",{alpha:!1,desynchronized:!0}),a=(0,o.V$7)(),c={xScale:(0,o.m4Y)(),yScale:(0,o.m4Y)(),xAxis:n.append("g").attr("class",M.axis),yAxis:n.append("g").attr("class",M.axis),xAxisLegend:n.append("text").attr("class",h()(M.axis,M["legend-text"])),yAxisLegend:n.append("text").attr("class",h()(M.axis,M["legend-text"])),dataPoints:n.append("g").attr("class",M["data-points"]),hover:n.append("circle").attr("fill","transparent"),legendCanvas:(0,o.Ltv)(T.current).select("canvas"),legendCursor:(0,o.Ltv)(T.current).select(`.${M.cursor}`),brush:a,brushElement:n.append("g").attr("class","brush")};c.drawLegend=(0,l.A)((e=>(t,n,r,a,l)=>{const i=e.createImageData(t.length,1),s=new Uint32Array(i.data.buffer);t.forEach(((e,t)=>{let{x:i,y:c,fill:{r:o,g:d,b:u}}=e,x=255;if(n){const e=n(i);if(e<0||e>a)x=100;else{const e=r(c);(e<0||e>l)&&(x=100)}}s[t]=16777216*x+65536*u+256*d+o})),e.putImageData(i,0,0)})(c.legendCanvas.node().getContext("2d",{alpha:!0})),$+L);const d=function(){let{onlyTooltip:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B.current.style.display="none",c.hover.attr("fill","transparent"),e||(c.legendCursor.style("left",""),c.legendCursor.style("opacity",0))},x=function(){let{datumIndex:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E((n=>{if(e<0||e>=J)return n;if(!X)return console.error("No number of frames in metadata. Are we missing the main trajectory?"),null;const r=e*t;return r===n?null:r}))};return F.current=async function(){let{processed:t=W.current,brushing:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t)return;if(await(0,u.Gt)(),!I.current.firstChild)return;const{clientWidth:l,clientHeight:h}=I.current;n.attr("width",l).attr("height",h),e.attr("width")!==""+l*A&&e.attr("width",l*A),e.attr("height")!==""+h*A&&e.attr("height",h*A),e.style("width",`${l}px`).style("height",`${h}px`),c.brushElement.call(c.brush);const p=!N.current;c.xScale.range([C,l-b]),a||c.xScale.domain(t.xMinMax),c.yScale.range([h-j,R]),a||c.yScale.domain(t.yMinMax);c.xAxis.transition().duration(!p&&!(0,y.A)()&&$+L).call((e=>e.attr("transform",`translate(0, ${(0,i.A)(c.yScale(0),0,h-32)})`).call((0,o.l78)(c.xScale).ticks(Math.round(l/75)).tickFormat((e=>0===e?null:e))))),c.xAxisLegend.text(`\u2190 principal component ${t.projections[0]+1} \u2192`).transition().duration(!p&&!(0,y.A)()&&$+L).attr("transform",`translate(${l/2}, ${h-5})`);c.yAxis.transition().duration(!p&&!(0,y.A)()&&$+L).call((e=>e.attr("transform",`translate(${(0,i.A)(c.xScale(0),30,l-1)}, 0)`).call((0,o.V4s)(c.yScale).ticks(Math.round(h/75)).tickFormat((e=>0===e?null:e))))),c.yAxisLegend.text(`\u2190 principal component ${t.projections[1]+1} \u2192`).transition().duration(!p&&!(0,y.A)()&&$+L).attr("transform",`translate(5, ${h/2}) rotate(90)`),c.brush.on("end",(()=>{const{selection:e}=o.f0J;e&&(c.xScale.domain([e[0][0],e[1][0]].map(c.xScale.invert,c.xScale)),c.yScale.domain([e[1][1],e[0][1]].map(c.yScale.invert,c.yScale)),c.brushElement.call(c.brush.move,null),F.current({brushing:!0}))}));const v=Math.log(Math.max((t.xMinMax[1]-t.xMinMax[0])/(c.xScale.domain()[1]-c.xScale.domain()[0]),(t.yMinMax[1]-t.yMinMax[0])/(c.yScale.domain()[1]-c.yScale.domain()[0])))+1,w=A*Math.min(l,h)*v/250;c.hover.attr("r",w+5);let S=0;const M=p?0:N.current.currentRadius;N.current=t.data.map(((e,t,n)=>{let{x:r,y:a,fill:l}=e,{length:i}=n;const d=c.xScale(r)*A,u=c.yScale(a)*A,x=t*$*(p?2:1)/i,h=(0,y.A)()?0:(0,s.A)(k,L)*(p?2:1),m=x+h;return S<m&&(S=m),{currentX:null,currentY:null,currentRadius:null,interpolateX:(0,o.GWP)(p?c.xScale(0)*A:N.current[t].currentX||N.current[t].x,d),interpolateY:(0,o.GWP)(p?c.yScale(0)*A:N.current[t].currentY||N.current[t].y,u),delay:x,duration:h,x:d,y:u,fill:l}})),N.current.interpolateRadius=(0,o.GWP)(M,w),(e=>{let{context:t,dataPoints:n,width:r,height:a,maxTime:l,isFirstTime:i}=e;new Promise((e=>{f&&f.stop(),f=(0,o.O1W)((s=>{const c=s>=l;c?(f.stop(),t.fillStyle="white",t.fillRect(0,0,r*m,a*m)):(t.fillStyle="rgba(255, 255, 255, 0.25)",t.fillRect(0,0,r*m,a*m));for(const e of n){const l=Math.max(0,(i?g:o.oRn)(Math.min((s-e.delay)/e.duration,1)));e.currentX=e.interpolateX(l),e.currentX<0||e.currentX>r||(e.currentY=e.interpolateY(l),n.currentRadius=n.interpolateRadius(l),e.currentY<0||e.currentY>a||(t.fillStyle=e.fill.hex,t.beginPath(),t.arc(e.currentX,e.currentY,n.currentRadius,0,2*Math.PI),t.fill()))}c&&e()}))}))})({context:r,dataPoints:N.current,width:l*A,height:h*A,maxTime:S,isFirstTime:p});const _=function(){let{datumIndex:e,datum:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Number.isInteger(e)||!n)return;c.legendCursor.style("left",`calc(${100*e/t.data.length}% - 4px)`),c.legendCursor.style("opacity",1);const r=c.xScale(n.x);if(r<0||r>l)return d({onlyTooltip:!0});const a=c.yScale(n.y);if(a<0||a>h)return d({onlyTooltip:!0});const{scrollX:i,scrollY:s}=window,{left:o,top:u}=I.current.getBoundingClientRect();B.current.innerHTML=`\n          <div>\n            <p>Frame ${e*t.framestep+1} (click to open viewer)</p>\n            <p>Principal component ${t.projections[0]+1}: ${n.x}</p>\n            <p>Principal component ${t.projections[1]+1}: ${n.y}</p>\n          </div>\n        `,B.current.style.display="inline-block";const x=B.current.getBoundingClientRect();B.current.style.transform=`translate(${r+o+i-x.width/2}px, ${a+u+s-x.height-15}px)`,c.hover.attr("cx",r).attr("cy",a).attr("fill",n.fill.hex)},P=e=>()=>{const{scrollX:n,scrollY:r}=window,{left:a,top:l}=I.current.getBoundingClientRect(),{pageX:i,pageY:s}=o.f0J,u=i-a-n,x=s-l-r,h=D.current.find(c.xScale.invert(u),c.yScale.invert(x)),p=t.data[h];if(p){const t=c.xScale(p.x),n=c.yScale(p.y);if(Math.sqrt(Math.abs(t-u)**2+Math.abs(n-x)**2)<=20)return e({datumIndex:h,datum:p})}d(),e()};n.on("mousemove",P(_)).on("mouseout",d).on("click",P(x));const Y=e=>()=>{const n=c.legendCanvas.node();if(!n||!("getBoundingClientRect"in n))return;const{left:r,width:a}=n.getBoundingClientRect(),{pageX:l}=o.f0J,i=(l-r)/a,s=Math.floor(i*t.data.length);e({datumIndex:s,datum:t.data[s]})};c.drawLegend(t.data,c.xScale,c.yScale,l,h),c.legendCanvas.on("mousemove",Y(_)).on("mouseout",d).on("click",Y(x))},window.addEventListener("resize",F.current),()=>{c.drawLegend&&c.drawLegend.cancel(),window.removeEventListener("resize",F.current)}}),[x,E,Y,X]),(0,r.useEffect)((()=>{const[e,r]=G?[0,1]:[1,0],a=P.domain([0,J]),l=n[x[e]],i=n[x[r]],s=(0,c.A)(l,i),h={data:s.map(((e,t)=>{let[n,r]=e;const l=a(t);return{x:n,y:r,fill:{hex:l,...(0,o.Qhc)(l)}}})),xMinMax:[Math.min(...l),Math.max(...l)],yMinMax:[Math.min(...i),Math.max(...i)],framestep:t,projections:[x[e],x[r]]};W.current=h,F.current({processed:h}),(async()=>{await(0,u.yy)($+L),await(0,u._)(100),D.current=d.A.from(s)})()}),[n,J,x,t,G]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:M["graph-container"],onDoubleClick:F.current,ref:I}),(0,_.jsxs)("div",{className:M.legend,children:[(0,_.jsx)(v.A,{title:"Switch axes",className:h()(M.switch,{[M.switched]:G}),onClick:H,size:"large",children:(0,_.jsx)(w.g,{icon:S.fKj})}),(0,_.jsx)("p",{children:"position in simulation:"}),(0,_.jsxs)("div",{className:M["color-scale"],children:[(0,_.jsx)("div",{children:"start"}),(0,_.jsxs)("div",{ref:T,children:[(0,_.jsx)("canvas",{height:"1",width:J}),(0,_.jsx)("div",{className:M.cursor})]}),(0,_.jsx)("div",{children:"end"})]})]}),(0,_.jsx)("div",{className:M.tooltip,ref:B})]})}}}]);
//# sourceMappingURL=projections.8bc82de1.chunk.js.map