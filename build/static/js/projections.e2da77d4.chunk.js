"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[7515],{8018:(t,e,n)=>{n.r(e),n.d(e,{default:()=>X});var a=n(65043),r=n(40830),c=n(88058),l=n(45180),i=n(75040),s=n(80705),o=n(32577),d=n(60093),u=n(39766),h=n(64600),x=n.n(h),p=n(92954);const m=window.devicePixelRatio||1,g=o._9v.amplitude(1).period(.5);let f;var y=n(17604),v=n(17392),w=n(92127),S=n(12639);const M={"graph-container":"style_graph-container__oCOoS",axis:"style_axis__H0KE8","legend-text":"style_legend-text__Zvd0H",legend:"style_legend__kYAHJ",switch:"style_switch__vPk4i",switched:"style_switched__DLS7l","color-scale":"style_color-scale__mIyZh",cursor:"style_cursor__uJXdm",tooltip:"style_tooltip__S2WeP"};var _=n(70579);const A=window.devicePixelRatio||1,R=10,b=10,j=25,C=25,k=500,[L,P]=[375,625],Y=(0,o.exT)(o.GAA),X=t=>{let{framestep:e,projectionsData:n,projections:h,datumRange:X,totalFrames:E,setRequestedFrame:I}=t;const T=(0,a.useRef)(null),F=(0,a.useRef)(null),N=(0,a.useRef)(r.A),W=(0,a.useRef)(null),B=(0,a.useRef)(null),D=(0,a.useRef)(null),G=(0,a.useRef)({find(){}}),[H,J]=(0,p.A)(!1);(0,a.useEffect)((()=>{const t=(0,o.Ltv)(T.current).append("canvas"),e=(0,o.Ltv)(T.current).append("svg"),n=t.node().getContext("2d",{alpha:!1,desynchronized:!0}),a=(0,o.V$7)(),r={xScale:(0,o.m4Y)(),yScale:(0,o.m4Y)(),xAxis:e.append("g").attr("class",M.axis),yAxis:e.append("g").attr("class",M.axis),xAxisLegend:e.append("text").attr("class",x()(M.axis,M["legend-text"])),yAxisLegend:e.append("text").attr("class",x()(M.axis,M["legend-text"])),dataPoints:e.append("g").attr("class",M["data-points"]),hover:e.append("circle").attr("fill","transparent"),legendCanvas:(0,o.Ltv)(F.current).select("canvas"),legendCursor:(0,o.Ltv)(F.current).select(".".concat(M.cursor)),brush:a,brushElement:e.append("g").attr("class","brush")};r.drawLegend=(0,c.A)((t=>(e,n,a,r,c)=>{const l=t.createImageData(e.length,1),i=new Uint32Array(l.data.buffer);e.forEach(((t,e)=>{let{x:l,y:s,fill:{r:o,g:d,b:u}}=t,h=255;if(n){const t=n(l);if(t<0||t>r)h=100;else{const t=a(s);(t<0||t>c)&&(h=100)}}i[e]=16777216*h+65536*u+256*d+o})),t.putImageData(l,0,0)})(r.legendCanvas.node().getContext("2d",{alpha:!0})),k+P);const s=function(){let{onlyTooltip:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.current.style.display="none",r.hover.attr("fill","transparent"),t||(r.legendCursor.style("left",""),r.legendCursor.style("opacity",0))},d=function(){let{datumIndex:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return I((e=>{if(!E)return console.error("No number of frames in metadata. Are we missing the main trajectory?"),null;const n=Math.floor(t*(E/X));return n===e?null:n}))};return N.current=async function(){let{processed:a=B.current,brushing:c}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!a)return;if(await(0,u.Gt)(),!T.current.firstChild)return;const{clientWidth:h,clientHeight:x}=T.current;e.attr("width",h).attr("height",x),t.attr("width")!=="".concat(h*A)&&t.attr("width",h*A),t.attr("height")!=="".concat(x*A)&&t.attr("height",x*A),t.style("width","".concat(h,"px")).style("height","".concat(x,"px")),r.brushElement.call(r.brush);const p=!W.current;r.xScale.range([C,h-b]),c||r.xScale.domain(a.xMinMax),r.yScale.range([x-j,R]),c||r.yScale.domain(a.yMinMax);r.xAxis.transition().duration(!p&&!(0,y.A)()&&k+P).call((t=>t.attr("transform","translate(0, ".concat((0,l.A)(r.yScale(0),0,x-32),")")).call((0,o.l78)(r.xScale).ticks(Math.round(h/75)).tickFormat((t=>0===t?null:t))))),r.xAxisLegend.text("\u2190 principal component ".concat(a.projections[0]+1," \u2192")).transition().duration(!p&&!(0,y.A)()&&k+P).attr("transform","translate(".concat(h/2,", ").concat(x-5,")"));r.yAxis.transition().duration(!p&&!(0,y.A)()&&k+P).call((t=>t.attr("transform","translate(".concat((0,l.A)(r.xScale(0),30,h-1),", 0)")).call((0,o.V4s)(r.yScale).ticks(Math.round(x/75)).tickFormat((t=>0===t?null:t))))),r.yAxisLegend.text("\u2190 principal component ".concat(a.projections[1]+1," \u2192")).transition().duration(!p&&!(0,y.A)()&&k+P).attr("transform","translate(5, ".concat(x/2,") rotate(90)")),r.brush.on("end",(()=>{const{selection:t}=o.f0J;t&&(r.xScale.domain([t[0][0],t[1][0]].map(r.xScale.invert,r.xScale)),r.yScale.domain([t[1][1],t[0][1]].map(r.yScale.invert,r.yScale)),r.brushElement.call(r.brush.move,null),N.current({brushing:!0}))}));const v=Math.log(Math.max((a.xMinMax[1]-a.xMinMax[0])/(r.xScale.domain()[1]-r.xScale.domain()[0]),(a.yMinMax[1]-a.yMinMax[0])/(r.yScale.domain()[1]-r.yScale.domain()[0])))+1,w=A*Math.min(h,x)*v/250;r.hover.attr("r",w+5);let S=0;const M=p?0:W.current.currentRadius;W.current=a.data.map(((t,e,n)=>{let{x:a,y:c,fill:l}=t,{length:s}=n;const d=r.xScale(a)*A,u=r.yScale(c)*A,h=e*k*(p?2:1)/s,x=(0,y.A)()?0:(0,i.A)(L,P)*(p?2:1),m=h+x;return S<m&&(S=m),{currentX:null,currentY:null,currentRadius:null,interpolateX:(0,o.GWP)(p?r.xScale(0)*A:W.current[e].currentX||W.current[e].x,d),interpolateY:(0,o.GWP)(p?r.yScale(0)*A:W.current[e].currentY||W.current[e].y,u),delay:h,duration:x,x:d,y:u,fill:l}})),W.current.interpolateRadius=(0,o.GWP)(M,w),(t=>{let{context:e,dataPoints:n,width:a,height:r,maxTime:c,isFirstTime:l}=t;new Promise((t=>{f&&f.stop(),f=(0,o.O1W)((i=>{const s=i>=c;s?(f.stop(),e.fillStyle="white",e.fillRect(0,0,a*m,r*m)):(e.fillStyle="rgba(255, 255, 255, 0.25)",e.fillRect(0,0,a*m,r*m));for(const t of n){const c=Math.max(0,(l?g:o.oRn)(Math.min((i-t.delay)/t.duration,1)));t.currentX=t.interpolateX(c),t.currentX<0||t.currentX>a||(t.currentY=t.interpolateY(c),n.currentRadius=n.interpolateRadius(c),t.currentY<0||t.currentY>r||(e.fillStyle=t.fill.hex,e.beginPath(),e.arc(t.currentX,t.currentY,n.currentRadius,0,2*Math.PI),e.fill()))}s&&t()}))}))})({context:n,dataPoints:W.current,width:h*A,height:x*A,maxTime:S,isFirstTime:p});const _=function(){let{datumIndex:t,datum:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Number.isInteger(t)||!e)return;r.legendCursor.style("left","calc(".concat(100*t/a.data.length,"% - 4px)")),r.legendCursor.style("opacity",1);const n=r.xScale(e.x);if(n<0||n>h)return s({onlyTooltip:!0});const c=r.yScale(e.y);if(c<0||c>x)return s({onlyTooltip:!0});const{scrollX:l,scrollY:i}=window,{left:o,top:d}=T.current.getBoundingClientRect();D.current.innerHTML="\n          <div>\n            <p>Frame ".concat(t*a.framestep+1," (click to open viewer)</p>\n            <p>Principal component ").concat(a.projections[0]+1,": ").concat(e.x,"</p>\n            <p>Principal component ").concat(a.projections[1]+1,": ").concat(e.y,"</p>\n          </div>\n        "),D.current.style.display="inline-block";const u=D.current.getBoundingClientRect();D.current.style.transform="translate(".concat(n+o+l-u.width/2,"px, ").concat(c+d+i-u.height-15,"px)"),r.hover.attr("cx",n).attr("cy",c).attr("fill",e.fill.hex)},Y=t=>()=>{const{scrollX:e,scrollY:n}=window,{left:c,top:l}=T.current.getBoundingClientRect(),{pageX:i,pageY:d}=o.f0J,u=i-c-e,h=d-l-n,x=G.current.find(r.xScale.invert(u),r.yScale.invert(h)),p=a.data[x];if(p){const e=r.xScale(p.x),n=r.yScale(p.y);if(Math.sqrt(Math.abs(e-u)**2+Math.abs(n-h)**2)<=20)return t({datumIndex:x,datum:p})}s(),t()};e.on("mousemove",Y(_)).on("mouseout",s).on("click",Y(d));const X=t=>()=>{const e=r.legendCanvas.node();if(!e||!("getBoundingClientRect"in e))return;const{left:n,width:c}=e.getBoundingClientRect(),{pageX:l}=o.f0J,i=(l-n)/c,s=Math.floor(i*a.data.length);t({datumIndex:s,datum:a.data[s]})};r.drawLegend(a.data,r.xScale,r.yScale,h,x),r.legendCanvas.on("mousemove",X(_)).on("mouseout",s).on("click",X(d))},window.addEventListener("resize",N.current),()=>{r.drawLegend&&r.drawLegend.cancel(),window.removeEventListener("resize",N.current)}}),[h,I,X,E]),(0,a.useEffect)((()=>{const[t,a]=H?[0,1]:[1,0],r=n&&n[0].length||0,c=Y.domain([0,r]),l=n[h[t]],i=n[h[a]],x=(0,s.A)(l,i),p={data:x.map(((t,e)=>{let[n,a]=t;const r=c(e);return{x:n,y:a,fill:{hex:r,...(0,o.Qhc)(r)}}})),xMinMax:[Math.min(...l),Math.max(...l)],yMinMax:[Math.min(...i),Math.max(...i)],framestep:e,projections:[h[t],h[a]]};B.current=p,N.current({processed:p}),(async()=>{await(0,u.yy)(k+P),await(0,u._)(100),G.current=d.A.from(x)})()}),[n,h,e,H]);const z=n&&n[0].length||0;return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:M["graph-container"],onDoubleClick:N.current,ref:T}),(0,_.jsxs)("div",{className:M.legend,children:[(0,_.jsx)(v.A,{title:"Switch axes",className:x()(M.switch,{[M.switched]:H}),onClick:J,size:"large",children:(0,_.jsx)(w.g,{icon:S.fKj})}),(0,_.jsx)("p",{children:"position in simulation:"}),(0,_.jsxs)("div",{className:M["color-scale"],children:[(0,_.jsx)("div",{children:"start"}),(0,_.jsxs)("div",{ref:F,children:[(0,_.jsx)("canvas",{height:"1",width:z}),(0,_.jsx)("div",{className:M.cursor})]}),(0,_.jsx)("div",{children:"end"})]})]}),(0,_.jsx)("div",{className:M.tooltip,ref:D})]})}}}]);
//# sourceMappingURL=projections.e2da77d4.chunk.js.map