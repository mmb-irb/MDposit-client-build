"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[1499,9117],{24539:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var a=t(65043),n=t(89257),r=t(85865),o=t(32577),l=t(10939),c=t(92428),i=t(10419),d=t(17545),u=t(58338),p=t(29449),h=t(95747);const m="style_graphcard__VoJ6R",x="style_graph__GoAAc",g="style_graph-placeholder__bh3Kw",f="style_nglcard__Zr+kp",y="style_container__lBCpG";var b=t(82746),A=t(48838),S=t(75291),C=t(70579);const M={triggerOnce:!0,rootMargin:"100px"},j=["grey","yellow","red"],_=e=>Math.round(100*e)/100,k=()=>{const[e,s]=(0,n.Wx)(M),{accessionAndMdNumber:t,metadata:k,topology:R,populations:v}=(0,a.useContext)(p.f),T=(0,i.A)(),w=(0,a.useRef)(null),N=(0,a.useRef)(null),{loading:D,payload:E,error:F}=(0,u.A)("".concat(h.nP,"/").concat(t,"/analyses/rmsd-perres/")),[L,I]=(0,a.useState)([]),{components:P,representations:W,analysisFrameCount:G,xAxisStep:V,xAxisLabel:Y,isEnsemble:q,xTooltip:B,data:H,xWeights:J}=(0,a.useMemo)((()=>{if(!R||!k||!E||v&&v.loading)return{};const e=E.rmsdpr,s=[],a=[];e.forEach((e=>{if(null===e)s.push(null),a.push(null);else{const[t,n]=(e=>{const s=e.length,t=e.reduce(((e,s)=>e+s))/s,a=Math.sqrt(e.map((e=>Math.pow(e-t,2))).reduce(((e,s)=>e+s))/s);return[_(t),_(a)]})(e);s.push(t),a.push(n)}}));const n={rmsdpr:e,means:s,stdvs:a},r=Math.max(...s),l=Math.min(...s),c=(0,o.m4Y)().range(j).domain([l,(l+r)/2,r]),i=b.ColormakerRegistry.addScheme((function(e){this.atomColor=e=>{const t=e.residueIndex,a=s[t];if(null===a)return 16777215;const n=(0,o.yWT)(c(a)).formatHex();return parseInt(n.substring(1),16)}})),d=k.mdFrames,u=E.step,p="".concat(h.nP,"/").concat(t,"/trajectory"),m=[{trajectoryURLs:["".concat(p,"?frames=1:").concat(d,":").concat(u)]}],x=[];T.forEach((e=>{const s={...e};s.color="custom",s.customScheme=i,x.push(s)}));const g=e[0].length,f=k.timeLength,y="ensemble"===k.TYPE;let A,S,C,M;if(y||!f?(A=u,S="Frames",C=e=>"frame "+e):(A=f/(g-1),S="Time (ns)",C=e=>+e.toFixed(2)+" ns"),v&&v.payload){M=[];for(let e=0;e<v.payload.length;e+=A)M.push(v.payload[e])}return{components:m,representations:x,analysisFrameCount:g,xAxisStep:A,xAxisLabel:S,isEnsemble:y,xTooltip:C,data:n,xWeights:M}}),[E,R,k,t,T,v]),{selectedData:K,selectedResidueIndices:O}=(0,a.useMemo)((()=>{const e={},s=[];return L.forEach(((t,a)=>{const n={data:H.rmsdpr[t.index]};n.color=t.color,e[a]=n,s.push(t.index)})),{selectedData:e,selectedResidueIndices:s}}),[H,L]),U=(0,a.useCallback)((e=>{w.current.togglePlaying(!1),w.current.currentFrame=e}),[]),Z=(0,a.useCallback)((e=>{if(!N.current)return;const s=Math.round(e*(G-1));N.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]}),[G]),z=(0,a.useCallback)(((e,s,t)=>{const a={color:t,index:s};I((e=>[...e,a]))}),[I]),Q=(0,a.useCallback)(((e,s)=>{I((e=>e.filter((e=>e.index!==s))))}),[I]),X=(0,a.useCallback)((()=>{I([])}),[I]),$=(0,a.useCallback)(((e,s)=>{const t=H.means[s],a=H.stdvs[s],n=Math.round(100*t)/100,r=Math.round(100*a)/100;return"Mean RMSD: ".concat(n,"\nStandard deviation: ").concat(r)}),[H]);return D||v&&v.loading?(0,C.jsx)(d.A,{}):F?F.toString():v&&v.error?v.error.toString():E?v&&!v.payload?"Something bad happened with populations":R?(0,C.jsxs)(a.Suspense,{fallback:(0,C.jsx)(d.A,{}),children:[(0,C.jsx)(l.A,{children:(0,C.jsx)(A.A,{residueValues:H.means,legendTitle:"Average RMSD (\xc5)",onSelect:z,onDeselect:Q,onClean:X,onTooltip:$})}),(0,C.jsx)(l.A,{className:m,children:L.length>0?(0,C.jsx)(S.default,{yData:K,step:V,xAxisLabel:Y,type:q?"dots":"line",xWeights:J,xTooltip:B,yAxisLabel:"RMSd (\xc5)",onSelect:U,className:x,ref:N}):(0,C.jsx)("div",{className:g,children:(0,C.jsx)(r.A,{variant:"h6",children:"No residue selected"})})}),(0,C.jsx)(l.A,{className:f,ref:e,children:s?(0,C.jsx)(c.default,{className:y,startingComponents:P,startingRepresentations:W,selectedResidueIndices:O,onProgress:Z,ref:w,framesSelect:!1}):(0,C.jsx)("div",{style:{height:"50vh"}})})]}):(0,C.jsx)(d.A,{}):"Something bad happened with the analysis data"}}}]);
//# sourceMappingURL=rmsd-perres.d73bbd82.chunk.js.map