"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[1079,9117],{64711:(e,s,t)=>{t.r(s),t.d(s,{default:()=>_});var a=t(65043),n=t(89257),l=t(85865),o=t(32577),r=t(10939),c=t(92428),i=t(10419),d=t(17545),u=t(58338),p=t(29449),m=t(95747);const h="style_graphcard__Cgh8H",f="style_graph__rikGP",x="style_graph-placeholder__ef29F",g="style_nglcard__lD0br",y="style_container__lvt9H";var b=t(82746),A=t(48838),S=t(75291),C=t(70579);const v={triggerOnce:!0,rootMargin:"100px"},k=["grey","yellow","red"],j={atoms:"spacefill",residues:"spacefill",chains:"spacefill",selections:"spacefill"},_=()=>{const[e,s]=(0,n.Wx)(v),{accession:t,accessionAndMdNumber:_,metadata:R,topology:M,populations:N}=(0,a.useContext)(p.f),T=(0,i.A)(),I=(0,a.useRef)(null),w=(0,a.useRef)(null),{loading:E,payload:L,error:P}=(0,u.A)("".concat(m.nP,"/").concat(_,"/analyses/sasa/")),[D,F]=(0,a.useState)([]),{components:W,representations:H,framesNumber:B,xAxisStep:Y,xAxisLabel:G,isEnsemble:O,xTooltip:U,xWeights:V,data:q}=(0,a.useMemo)((()=>{if(!M||!R||!L||N&&N.loading)return{};const e=M.residueCount;if(e!==L.saspf.length)throw new Error("Number of residues in the analysis does not match number of residues in the topology");const s={saspf:[],means:[],stdvs:[]};for(let o=0;o<e;o++){1===M.getResidueByIndex(o).atomCount?(s.saspf[o]=null,s.means[o]=null,s.stdvs[o]=null):(s.saspf[o]=L.saspf[o],s.means[o]=L.means[o],s.stdvs[o]=L.stdvs[o])}let t;for(let o=0;o<e;o++)if(s.saspf[o]){if(void 0!==t){t=null;break}t=o}null!==t&&F([{color:"black",index:t}]);const a=s.means,n=Math.max(...a),l=Math.min(...a),r=(0,o.m4Y)().range(k).domain([l,(l+n)/2,n]),c=b.ColormakerRegistry.addScheme((function(e){this.atomColor=e=>{const s=e.residueIndex;if(1===M.getResidueByIndex(s).atomCount)return 16777215;const t=a[s];if(null===t)return 16777215;const n=(0,o.yWT)(r(t)).formatHex();return parseInt(n.substring(1),16)}})),i=L.step,d="".concat(m.nP,"/").concat(_,"/files/trajectory"),u=[{trajectoryURLs:["".concat(d,"?frames=1:").concat(R.mdFrames,":").concat(i)]}],p=[];T.forEach((e=>{const s={...e};s.color="custom",s.customScheme=c,s.type="spacefill",p.push(s)}));const h=s.saspf[0].length,f=R.timeLength,x="ensemble"===R.TYPE;let g,y,A,S;if(x||!f?(g=i,y="Frames",A=e=>"frame "+e):(g=f/(h-1),y="Time (ns)",A=e=>+e.toFixed(2)+" ns"),N&&N.payload){S=[];for(let e=0;e<N.payload.length;e+=g)S.push(N.payload[e])}return{components:u,representations:p,framesNumber:h,xAxisStep:g,xAxisLabel:y,isEnsemble:x,xTooltip:A,xWeights:S,data:s}}),[L,M,R,t,T,N,F]),{selectedData:z,selectedResidueIndices:J}=(0,a.useMemo)((()=>{const e={},s=[];return D.forEach(((t,a)=>{const n={data:q.saspf[t.index]};n.color=t.color,e[a]=n,s.push(t.index)})),{selectedData:e,selectedResidueIndices:s}}),[q,D]),K=(0,a.useCallback)((e=>{I.current.togglePlaying(!1),I.current.currentFrame=e}),[]),Q=(0,a.useCallback)((e=>{if(!w.current)return;const s=Math.round(e*(B-1));w.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]}),[B]),X=(0,a.useCallback)(((e,s,t)=>{const a={color:t,index:s};F((e=>[...e,a]))}),[F]),Z=(0,a.useCallback)(((e,s)=>{F((e=>e.filter((e=>e.index!==s))))}),[F]),$=(0,a.useCallback)((()=>{F([])}),[F]),ee=(0,a.useCallback)(((e,s)=>{const t=q.means[s],a=q.stdvs[s],n=Math.round(100*t)/100,l=Math.round(100*a)/100;return"Mean SAS: ".concat(n,"\nStandard deviation: ").concat(l)}),[q]);return E||N&&N.loading?(0,C.jsx)(d.A,{}):P?P.toString():N&&N.error?N.error.toString():L?N&&!N.payload?"Something bad happened with populations":M&&R?(0,C.jsxs)(a.Suspense,{fallback:(0,C.jsx)(d.A,{}),children:[M.residueCount>1&&(0,C.jsx)(r.A,{children:(0,C.jsx)(A.A,{residueValues:q.means,legendTitle:"Average Relative SAS (\xc5\xb2)",onSelect:X,onDeselect:Z,onClean:$,onTooltip:ee})}),(0,C.jsx)(r.A,{className:h,children:D.length>0?(0,C.jsx)(S.default,{yData:z,step:Y,xAxisLabel:G,yAxisLabel:"Relative SAS (\xc5\xb2)",type:O?"dots":"line",xWeights:V,xTooltip:U,onSelect:K,className:f,ref:w}):(0,C.jsx)("div",{className:x,children:(0,C.jsx)(l.A,{variant:"h6",children:"No residue selected"})})}),(0,C.jsx)(r.A,{className:g,ref:e,children:s?(0,C.jsx)(c.default,{className:y,startingComponents:W,startingRepresentations:H,selectedResidueIndices:J,onProgress:Q,ref:I,framesSelect:!1,highlightTypes:j}):(0,C.jsx)("div",{style:{height:"50vh"}})})]}):(0,C.jsx)(d.A,{}):"Something bad happened"}}}]);
//# sourceMappingURL=sasa.ac4541be.chunk.js.map