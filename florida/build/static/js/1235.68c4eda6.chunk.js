(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[1235],{10419:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(65043),s=r(29449),o=r(66496);const a=()=>{const{chains:e,metadata:t,topology:r}=(0,n.useContext)(s.f),{file:a}=(0,n.useContext)(s.I);return(0,n.useMemo)((()=>{if(!r)return[];const n=[],s=t&&t.LIGANDS;if(t&&e){const s=t.CHAINNAMES;if(s)for(const t of e){const e=s[t];n.push({name:e?e+" (Chain "+t+")":"Chain "+t,selection:":"+t})}else{[{name:"Protein",selection:"protein"},{name:"Nucleic acids",selection:"nucleic"}].forEach((e=>{(0,o.w1)(e.selection,a)&&n.push(e)}))}r.chainNames.forEach((t=>{if(-1!==e.indexOf(t))return;if(r.getChainByName(t).residues.every((e=>"ligand"===e.referenceType)))return;const o=s&&s[t]||t;n.push({name:o,selection:":"+t,type:"licorice",color:"purple",opacity:.5})}))}else n.push({name:"Main structure"});if(s)for(const e of s)if("string"===typeof e){const t=r.getReferenceResidueIndices(e);if(!t||0===t.length)continue;const{rangedSelection:s}=r.residueIndices2Ngl(t);n.push({name:e,selection:s,type:"ball+stick",color:"element"})}else{if(!e.ngl)continue;n.push({name:e.name,selection:e.ngl,type:"licorice"})}const i=[];if(r.residueAtomIndices.forEach((e=>{e.length>1||i.push(e[0])})),i.length>0){const e="@"+i.join(",");n.push({name:"Ions",selection:e,type:"spacefill",color:"element"})}const l=[];n.forEach((e=>{const t=void 0===e.type||"cartoon"===e.type,r=(0,o.kn)(e.selection,t,a);l.push(...r)}));const c=r.residueCount,u=[];for(let e=0;e<c;e++)-1===l.indexOf(e)&&u.push(e);if(u.length>0){const{rangedSelection:e}=r.residueIndices2Ngl(u);n.push({name:"Other",selection:e,type:"licorice",color:"grey",opacity:.3})}return n}),[e,t,r,a])}},13232:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});const n=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=e.getBoundingClientRect(),o=t.getBoundingClientRect();let a=r.x;if(Math.abs(s.left-a)>Math.abs(a-s.right)){a-=n+(o.right-o.left)}else a+=n;a-=s.left;let i=r.y;if(Math.abs(s.top-i)>Math.abs(i-s.bottom)){i-=n+(o.bottom-o.top)}else i+=n;return i-=s.top,{x:a,y:i}}},15340:()=>{},42634:()=>{},62598:(e,t,r)=>{"use strict";r.d(t,{JH:()=>s,Rx:()=>l,Wd:()=>o,s5:()=>i,wC:()=>a});var n=r(62629);const s=e=>JSON.parse(JSON.stringify(e)),o=e=>e.reduce(((e,t)=>e+t),0)/e.length,a=e=>Math.round(100*e)/100,i=e=>{const t=[];for(let r=0;r<e;r++){const s=n.Ay.hcl(r/e*360,80,70).css();t.push(s)}return t};class l{constructor(e){void 0===e&&(e="0.0.0");const t=e.split(".");this.major=t[0]&&+t[0],this.minor=t[1]&&+t[1],this.patch=t[2]&&+t[2]}toString(){let e=this.major.toString();return void 0===this.minor?e:(e+="."+this.minor.toString(),void 0===this.patch||(e+="."+this.patch.toString()),e)}equals(e){return"string"===typeof e?this.equals(new l(e)):e.major===this.major&&((void 0===e.minor||e.minor===this.minor)&&(void 0===e.patch||e.patch===this.patch))}}},79838:()=>{},92428:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Ct});var n=r(65043),s=r(64600),o=r.n(s),a=r(54109),i=r.n(a),l=r(12110),c=r(17392),u=r(68903),d=r(44208),m=r(99070),f=r(26494),p=r(10611),h=r(92127),g=r(44642),y=r(12639),b=r(71806),v=r(84882),j=r(28076),x=r(10039),w=r(73460),E=r(67784),A=r(2260),R=r(43845),C=r(61533);const S="style_popover-slider__Rg-SB",_="style_info__itwxP";var L=r(70579);const N=[{label:"Cartoon",value:"cartoon"},{label:"Licorice",value:"licorice"},{label:"Ball and stick",value:"ball+stick"},{label:"Surface",value:"surface"},{label:"Spacefill",value:"spacefill"},{label:"Tube",value:"tube"},{label:"Trace",value:"trace"},{label:"Backbone",value:"backbone"}],k=e=>{for(const t of N)if(t.value===e)return!0;return!1},F=[{label:"By chain id",value:"chainid"},{label:"By residue",value:"resname"},{label:"By element",value:"element"},{label:"B factor",value:"bfactor"},{label:"Electrostatic",value:"electrostatic"},{label:"Secondary structure",value:"sstruc"},{label:"Uniform",value:"uniform"}],M=["red","yellow","blue","green","orange","purple","white","grey","black"],T=(0,n.memo)((e=>{let{components:t,representations:r,setRepresentations:n}=e;return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(b.A,{"aria-label":"simple table",size:"small",padding:"checkbox",stickyHeader:!0,children:[(0,L.jsx)(v.A,{children:(0,L.jsxs)(j.A,{children:[(0,L.jsx)(x.A,{children:"Name"}),(0,L.jsx)(x.A,{align:"right",children:"Show"}),(0,L.jsxs)(x.A,{style:{whiteSpace:"nowrap"},align:"right",children:["Selection ",(0,L.jsx)(C.A,{tooltip:(0,L.jsxs)(L.Fragment,{children:["Using"," ",(0,L.jsx)("a",{href:"https://nglviewer.org/ngl/api/manual/selection-language.html",target:"_blank",rel:"noopener noreferrer",children:"NGL selection language"}),"."]}),className:_})]}),(0,L.jsx)(x.A,{align:"right",children:"Drawing method"}),(0,L.jsx)(x.A,{align:"right",children:"Coloring method"}),(0,L.jsx)(x.A,{align:"right",children:"Opacity"})]})}),(0,L.jsx)(w.A,{children:r&&r.map(((e,t)=>(0,L.jsxs)(j.A,{children:[(0,L.jsx)(x.A,{component:"th",scope:"row",children:e.name}),(0,L.jsx)(x.A,{align:"right",children:(0,L.jsx)(c.A,{title:"Show/Hide representation",onClick:()=>n((e=>(e[t].show=!e[t].show,[...e]))),color:"primary",children:(0,L.jsx)(h.g,{icon:e.show?y.pS3:y.k6j})})}),(0,L.jsx)(x.A,{align:"right",children:(0,L.jsx)(E.A,{defaultValue:e.selection,variant:"outlined",onKeyPress:e=>{"Enter"===e.key&&n((r=>e.target&&e.target.value?(r[t].selection=e.target.value,[...r]):r))},disabled:!e.custom,size:"small",margin:"dense"})}),(0,L.jsx)(x.A,{align:"right",children:(0,L.jsxs)(A.A,{native:!0,value:e.type,onChange:e=>{let{target:{value:r}}=e;n((e=>(e[t].type=r,[...e])))},children:[!k(e.type)&&(0,L.jsx)("option",{value:e.type,children:e.type}),N.map(((e,t)=>(0,L.jsx)("option",{value:e.value,children:e.label},t)))]})}),(0,L.jsx)(x.A,{align:"right",children:(0,L.jsxs)(A.A,{native:!0,value:e.color,onChange:e=>{let{target:{value:r}}=e;n((e=>(e[t].color=r,[...e])))},children:["distorsion"===e.customScheme?(0,L.jsx)("option",{value:e.color,children:"Distorsion"}):e.customScheme?(0,L.jsx)("option",{value:"custom",children:"Custom"}):null,F.map(((e,t)=>(0,L.jsx)("option",{value:e.value,children:e.label},t))),M.map(((e,t)=>{return(0,L.jsx)("option",{value:e,children:(r=e,r[0].toUpperCase()+r.slice(1))},t);var r}))]})}),(0,L.jsx)(x.A,{align:"right",children:(0,L.jsx)(m.Ay,{value:100*e.opacity,onChange:(e,r)=>{n((e=>(e[t].opacity=r/100,[...e])))},className:S})})]},t)))}),(0,L.jsx)(w.A,{children:(0,L.jsx)(j.A,{children:(0,L.jsx)(x.A,{align:"center",colSpan:6,children:(0,L.jsx)(R.A,{icon:(0,L.jsx)(h.g,{icon:y.OQW}),label:"Add representation",variant:"outlined",onClick:()=>n((e=>[...e,{name:"Custom",show:!0,selection:"None",type:"licorice",color:"chainid",opacity:1,component:t[0]&&t[0].name,custom:!0}]))})})},"addCustom")})]})})}));var P=r(39766);const $="mdposit-",U=(e,t)=>{const r=localStorage.getItem($+e);return null===r?t:JSON.parse(r)},z=async(e,t)=>(await(0,P._)(1e3),((e,t)=>{localStorage.setItem($+e,JSON.stringify(t))})(e,t));var O=r(95747),B=r(89257),I=r(50691),q=r(52153),D=r(35682),G=r(39517),H=r(43573),V=r(26939),W=r(65001),J=r(29325),X=r(78219),K=r(23541),Q=r(54776);const Y=W.xE.builderFactory("custom-namespace")({name:"trajectory-from-custom-data",display:"Trajectory",from:J.O.Root,to:J.O.Molecule.Coordinates,params:{data:K.t.Value(new Uint8Array,{isHidden:!0}),natoms:K.t.Value(0,{isHidden:!0})}})({apply(e){let{params:t}=e;return X.YZ.create("Parse atom coordinates",(async e=>await async function(e,t){if(0===t)throw new Error("Number of atoms is 0");const r=12*t;if(e.byteLength%r!==0)throw new Error("Trajectory data ends abruptly");const n=e.byteLength/r,s=new Float32Array(e),o=[];let a=0;for(let l=0;l<n;l++){const e=new Float32Array(t),r=new Float32Array(t),n=new Float32Array(t);for(let o=0;o<t;o++)e[o]=s[a],r[o]=s[a+1],n[o]=s[a+2],a+=3;o.push({x:e,y:r,z:n,elementCount:t,time:(0,Q.gX)(l,"step"),xyzOrdering:{isIdentity:!0}})}const i=Q.E$.create(o,(0,Q.gX)(1,"step"),(0,Q.gX)(0,"step"));return new J.O.Molecule.Coordinates(i,{label:"label"})}(t.data,t.natoms)))}});const Z=(e,t,r)=>{if(r)return{range:(r+1).toString(),frames:1};{if(!e)throw new Error("Missing number of frames in the trajectory");if(!t)throw new Error("Missing number of requested frames");const r=Math.floor(e/t);return{range:`1:${e}:${r}`,frames:Math.ceil(e/r)}}};var ee=r(29449);const te="style_container__d6R8E",re="style_light-theme__l3EaT",ne="style_loading-trajectory__ciokb",se="style_loading-structure__ce+kY",oe="style_tooltip__KXFgY";var ae=r(42594),ie=r.n(ae),le=r(22363),ce=r.n(le),ue=r(74080);const de=(0,q.w)();de.layout={initial:{isExpanded:!1,controlsDisplay:"reactive",showControls:!1}},de.components={controls:{top:"none",bottom:"none",left:"none",remoteState:"none"}};const me=25,fe=/\?frames=(?<start>\d+):(?<end>\d+)(:(?<step>\d+))?/;const pe={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},he=(0,n.memo)((0,n.forwardRef)(((e,t)=>{let{className:r,playing:s,spinning:a,smooth:i,onProgress:l,onLoad:c,bounce:u=!1,requestedFramesNumber:d=me,selectedAtoms:m,selectedResidueIndices:f,selectedChains:p,selectedCustom:h,selectedDistances:g,selectedAngles:y,selectedRepresentation:b,snapRepresentations:v,noTrajectory:j,initialFocus:x,darkBackground:w,perspective:E,speed:A,drawingMethods:R,coloringMethods:C,opacities:S,components:_,showRepresentations:N,nglSelections:k,highlightTypes:F=pe}=e;const M=(0,n.useMemo)((()=>_),[_]),{accession:T,accessionAndMdNumber:$,fileDescriptors:U,curatedOrientation:z,topology:q}=(0,n.useContext)(ee.f),{file:W}=(0,n.useContext)(ee.I),[J,X]=(0,n.useState)(!1),[K,Q]=(0,n.useState)(x);(0,n.useMemo)((()=>{Q(x)}),[x]);const ae=(0,n.useRef)(null),le=(0,n.useRef)(null),he=(0,n.useRef)(null),ge=(0,n.useRef)(null),ye=(0,n.useRef)(null),[be,ve]=((0,n.useRef)(!0),(0,B.Wx)()),[je,xe]=(0,n.useState)(null),we=(0,n.useRef)([]),[Ee,Ae]=(0,n.useState)([]),[Re,Ce]=(0,n.useState)(!1);(0,n.useMemo)((()=>{Ae((e=>{const t=[];return M.forEach((r=>{const n=r.topologyURL||null;[...e,...t].find((e=>e.url===n))||(null===n?t.push({url:`${O.nP}/${$}/files/${O.i3}`,loading:!0,requested:!1,error:null}):(t.push({url:n,loading:!0,requested:!1,error:null}),Ce(!0)))})),[...e,...t]}))}),[M,Ae,T]);const[Se,_e]=(0,n.useState)([]);(0,n.useEffect)((()=>{Ee.forEach(((e,t)=>{if(!e.file&&!e.error&&!e.requested)if(null===e.url)_e((t=>{e.loading=!1;const r=Ee.some((e=>e.loading));Ce(r);return[...t,{url:null,file:W}]}));else{e.requested=!0;const t="https"===e.url.substring(0,5)?ie().get:ce().get;let r="";const n=t(ue.parse(e.url),(t=>{t.on("data",(e=>{r+=e})).on("end",(()=>{_e((t=>{e.loading=!1;const n=Ee.some((e=>e.loading));Ce(n);return[...t,{url:e.url,file:r}]}))})).on("error",(t=>{e.loading=!1;const r=Ee.some((e=>e.loading));Ce(r),e.error=t}))}));we.current.push(n)}}))}),[Ee,W]);(0,n.useMemo)((()=>{const e=M[0],t=Se.find((t=>t.url===e.topologyURL)),{file:r}=t||{loading:!1,file:W};return r}),[M,Se,W]);const[Le,Ne]=(0,n.useState)([]),[ke,Fe]=(0,n.useState)(!1);(0,n.useMemo)((()=>{const{loading:e,payload:t,error:r}=U;if(!e){if(r)throw r;if(!t)throw new Error("Something bad happened with file descriptors");Ne((e=>{const r=[],n=`${O.nP}/${$}/files/trajectory`;return M.forEach(((s,o)=>{if(s.onlyTopology)return;const a=0===o,i=s.frame;let l=s.trajectoryURLs||[n];s.frameCount=0,l.forEach(((n,o)=>{const l=(e=>{const t=fe.exec(e);if(!t)return null;const r=+t.groups.start,n=Math.max(+t.groups.end,r),s=+(t.groups.step||1);return{start:r,end:n,step:s,frames:Math.floor((n-r)/s)+1}})(n);let c=n.split("/").slice(-1)[0];l&&(c=c.split("?frames=")[0]),"trajectory"===c&&(c="trajectory.bin");const u=t.find((e=>e.filename===c));if(!u)throw new Error(`Trajectory "${c}" is missing`);const m=u.metadata,f=m.frames;let p=d;if(d>f&&(p=f),Number.isFinite(i))p=1;else if(l)p=l.frames;else if(!a&&f>1)throw new Error("Only the main component is allowed to load multiple frames");let h,g=n;if(l){const e=Math.min(f,l.end);h=Math.ceil(e/l.step)}else{const{range:e,frames:t}=Z(f,p,i);h=t,e&&(g=n+`?frames=${e}`)}s.framedURLs||(s.framedURLs=[]),s.framedURLs[o]=g,s.frameCount+=p;e.find((e=>e.url===g))||(r.push({url:g,frames:h,atoms:m.atoms,loading:!0,requested:!1}),Fe(!0))}))})),r.length>0?[...e,...r]:e}))}}),[T,M,U,d]);const[Me,Te]=(0,n.useState)([]),Pe=(0,n.useCallback)((()=>{const e=M[0],t=[];let r=[];if(Te((e=>(r=e,e))),e.framedURLs.forEach((e=>{const n=r.find((t=>t.url===e));n&&t.push(n)})),0===t.length)return;const n=t.map((e=>e.frames)).reduce(((e,t)=>e+t),0),s=t.map((e=>e.progress*e.frames)).reduce(((e,t)=>e+t),0)/n;c(s)}),[M,Te,c]);(0,n.useEffect)((()=>{Le.forEach((e=>{if(e&&e.requested)return;e.requested=!0,e.loading=!0,e.progress=0;const t=("https"===e.url.substring(0,5)?ie().get:ce().get)(ue.parse(e.url),(t=>{const r=t.headers["content-length"];Te((t=>[...t,{url:e.url,frames:e.frames,atoms:e.atoms,payload:new ArrayBuffer(0),progress:0}]));let n=0;t.on("data",(t=>{n+=t.byteLength,e.progress=n/r,Te((r=>{const n=r.find((t=>t.url===e.url));return n.payload=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}(n.payload,t),n.progress=e.progress,[...r]})),Pe()})).on("end",(()=>{e.loading=!1;const t=Le.some((e=>e.loading));Fe(t)}))}));we.current.push(t)}))}),[Le,Pe]),(0,n.useEffect)((()=>{const e=we.current;return()=>{e.forEach((e=>{e.abort()}))}}),[]),(0,n.useEffect)((()=>((async()=>{le.current=await(0,I.y)(ae.current,de)})(),()=>{le.current&&(le.current.dispose(),le.current=null)})),[]),(0,n.useEffect)((()=>{if(Re)return;const e=le.current;e&&Se.forEach((async t=>{const r=await e.builders.data.rawData({data:t.file},{state:{isGhost:!0}}),n=await e.builders.structure.parseTrajectory(r,"pdb"),s=await e.builders.structure.createModel(n);e.modelRef=s.ref}))}),[Re,Se]),(0,n.useEffect)((()=>{const e=le.current;if(!e)return;if(j)return;(async()=>{if(!Se||!Me||0===Me.length)return;if(!e||!e.modelRef)return;const t=Me[0];let r,n=0;if(r=t.atoms,r!==t.atoms)throw new Error("Atoms number in the different trajectories do not match");n+=t.frames;const s=t.payload,o=12*r,a=Math.floor(s.byteLength/o)*o,i=s.slice(0,a);if(0===i.byteLength)return;const l=i.byteLength/o;if(!(l===n))return;const c=await e.build().toRoot().apply(Y,{data:i,natoms:t.atoms}).commit(),u=e.managers.structure.hierarchy.current.trajectories,d=await e.build().toRoot().apply(D.TrajectoryFromModelAndCoordinates,{modelRef:e.modelRef,coordinatesRef:c.ref},{dependsOn:[e.modelRef,c.ref]}).commit(),m=await e.builders.structure.createModel(d),f=await e.builders.structure.createStructure(m),p=e.build().to(f),h=(0,H.pQ)(e,void 0,{type:"cartoon",typeParams:{quality:"lower",ignoreHydrogens:"all",ignoreHydrogensVariant:"all",ignoreLight:!0}});p.apply(V.f.Representation.StructureRepresentation3D,h),await p.commit(),u.length})()}),[Se,Me,M,j]),(0,n.useEffect)((()=>{const e=le.current;e&&(j||(s&&ve?e.managers.animation.play(G.d,{duration:{name:"sequential",params:{maxFps:10}},mode:{name:"loop",params:{direction:"forward"}}}):e.managers.animation.stop()))}),[s,ve,j,u]);const $e=(0,n.useCallback)((async()=>{if(!ge.current)return;const e=he.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,P.yy)(0),ge.current.handleResize()}),[]);(0,n.useEffect)((()=>(window.addEventListener("resize",$e),()=>{window.removeEventListener("resize",$e)})),[$e]),(0,n.useImperativeHandle)(t,(()=>({autoResize:$e,displayFocus(){const e=`[${ge.current.viewerControls.getOrientation().elements.toString()}]`;console.log(e)},centerFocus(){Q({comp:0,sele:"all"})},get currentFrame(){if(!J||!Le.length)return-1;try{return ge.current.compList[0].trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(J&&Le.length)try{const t=this.totalFrames;let r=e;r<0&&(r=0),r>=t&&(r=t-1),ge.current.compList[0].trajList[0].trajectory.setFrame(r)}catch(t){}},get totalFrames(){if(!J||!Le.length)return 1;try{return ge.current.compList[0].trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return ge.current.compList[0].trajList[0].expectedFrames}catch(e){return 1}}})),[J,Le,$e]);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{ref:e=>{be(e),ae.current=e},className:o()(r,te,{[se]:Re,[ne]:!j&&ke,[re]:!w}),"data-loading":void 0}),(0,L.jsx)("div",{ref:ye,className:oe,children:je})]})}))),ge=he;var ye=r(45180),be=r(82746);const ve=(e,t,r)=>{const n=new Float32Array(e);try{const e=[];for(let s=0;s<r;s++){const r=new Float32Array(3*t);r.set(n.subarray(s*t*3,(s+1)*t*3)),e.push(r)}return e}catch(s){return null}},je=(e,t,r,n,s)=>{const o=new Float32Array(r),a=o.length/3/s;if(a!==n)throw console.log("Number of coordinates: "+o.length),console.log("Number of frames: "+s),console.log("Expected number of atoms: "+a),console.log("Actual number of atoms: "+n),new Error("Trajectory atom number is wrong");try{const r=[];for(let a=0;a<s;a++){const s=new Float32Array(3*e);let i=0;for(let r=0;r<e;r++)-1!==t.indexOf(r)&&(s[3*r]=o[a*n*3+3*i],s[3*r+1]=o[a*n*3+3*i+1],s[3*r+2]=o[a*n*3+3*i+2],i++);r.push(s)}return r}catch(i){return null}},xe=(e,t,r,n)=>{const s=new Float32Array(t);if(s.length/3/n!==r)throw new Error("Trajectory atom number is wrong");let o="",a=0,i=0;for(let c=0;c<e.atomCount&&!(0>=r);c++)"C"!==e.getAtomProxy(c).atomname&&"CA"!==e.getAtomProxy(c).atomname&&"N"!==e.getAtomProxy(c).atomname||(a+=1),"H"!==e.getAtomProxy(c).element&&(i+=1);r===a?o="backbone":r===i?o="heavy":console.error(`Number of atoms does not match any defined atoms selection\n      Number of atoms: ${r}\n      Expected backbone atoms: ${a}\n      Expected heavy atoms: ${i}`);try{const t=[];for(let a=0;a<n;a++){const n=new Float32Array(3*e.atomCount);let i=0;if("backbone"===o)for(let t=0;t<e.atomCount&&!(i>=r);t++)"C"!==e.getAtomProxy(t).atomname&&"CA"!==e.getAtomProxy(t).atomname&&"N"!==e.getAtomProxy(t).atomname||(n[3*t]=s[a*r*3+3*i],n[3*t+1]=s[a*r*3+3*i+1],n[3*t+2]=s[a*r*3+3*i+2],i++);if("heavy"===o)for(let t=0;t<e.atomCount&&!(i>=r);t++)"H"!==e.getAtomProxy(t).element&&(n[3*t]=s[a*r*3+3*i],n[3*t+1]=s[a*r*3+3*i+1],n[3*t+2]=s[a*r*3+3*i+2],i++);t.push(n)}return t}catch(l){return null}},we=(e,t,r)=>{if(r)return{range:(r+1).toString(),frames:1};{if(!e)throw new Error("Missing number of frames in the trajectory");if(!t)throw new Error("Missing number of requested frames");const r=Math.floor(e/t);return{range:`1:${e}:${r}`,frames:Math.ceil(e/r)}}};var Ee=r(13232);const Ae="style_container__7Ceta",Re="style_light-theme__H4DPh",Ce="style_loading-trajectory__2DP4d",Se="style_loading-structure__E1dyl",_e="style_tooltip__eJTpx";var Le=r(93010);const Ne=25,ke=750,Fe="polymer and not hydrogen ",Me=/\?frames=(?<start>\d+):(?<end>\d+)(:(?<step>\d+))?/;function Te(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}const Pe=e=>1e3+-9.5*(e-0),$e={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},Ue=(0,n.memo)((0,n.forwardRef)(((e,t)=>{let{className:r,playing:s,spinning:a,smooth:i,onProgress:l,onLoad:c,bounce:u=!1,requestedFramesNumber:d=Ne,selectedAtoms:m,selectedResidueIndices:f,selectedChains:p,selectedCustom:h,selectedDistances:g,selectedAngles:y,selectedRepresentation:b,snapRepresentations:v,noTrajectory:j,initialFocus:x,darkBackground:w,perspective:E,speed:A,xSelection:R,rotateX:C,xAxisStep:S,components:_,representations:N,highlightTypes:k=$e}=e;const{accessionAndMdNumber:F,fileDescriptors:M,metadata:T,topology:$}=(0,n.useContext)(ee.f),U=(0,n.useMemo)((()=>{if(!T)return;const e=T.ORIENTATION;if(!e)return;const t=[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]];return(new be.Matrix4).set(...t)}),[T]),{file:z}=(0,n.useContext)(ee.I),[I,q]=(0,n.useState)(null),[D,G]=(0,n.useState)(null),[H,V]=(0,n.useState)(x);(0,n.useEffect)((()=>{V(x)}),[x]);const W=(0,n.useRef)(null),J=(0,n.useRef)(null),X=(0,n.useRef)(null),K=(0,n.useRef)(!0),[Q,Y]=(0,B.Wx)(),[Z,te]=(0,n.useState)(null),[re,ne]=(0,n.useState)([]),[se,oe]=(0,n.useState)(!1);(0,n.useMemo)((()=>{_&&ne((e=>{const t=[];return _.forEach((r=>{const n=r.topologyURL||null,s=r.atomSelection||null;[...e,...t].find((e=>e.url===n))||(null===n?t.push({url:null,loading:!1,error:null}):(t.push({url:n,selection:s,loading:!0,requested:!1,error:null}),oe(!0)))})),[...e,...t]}))}),[_,ne]);const[ae,le]=(0,n.useState)([]),de=(0,n.useRef)([]);(0,n.useEffect)((()=>{re.forEach((e=>{if(e.file)return;if(e.error)return;if(e.requested)return;const t=e.url;if(null===t)le((t=>{e.loading=!1;const r=re.some((e=>e.loading));oe(r);return[...t,{url:null,file:z}]}));else{e.requested=!0;const r=JSON.stringify({selection:e.selection}),n="https"===t.substring(0,5)?ie():ce(),s=(0,ue.parse)(t),o=s.path.endsWith("/structure");s.method=o?"POST":"GET",s.headers={"Content-Type":"application/json","Content-Length":r.length};const a=n.request(s,(r=>{let n=new ArrayBuffer(0);r.on("data",(e=>{n=Te(n,e)})).on("end",(()=>{const r=new Blob([n],{type:"text/plain"});(0,be.autoLoad)(r,{defaultRepresentation:!1,ext:"pdb"}).then((r=>{le((n=>{e.loading=!1;const s=re.some((e=>e.loading));oe(s);return[...n,{url:t,file:r}]}))})).catch((t=>{e.loading=!1;const r=re.some((e=>e.loading));oe(r),e.error=t}))}))}));"POST"===s.method&&a.write(r),a.end(),de.current.push(a)}}))}),[re,z]);const[me,fe]=(0,n.useState)([]),[pe,he]=(0,n.useState)(!1);(0,n.useMemo)((()=>{if(!_)return;const{loading:e,payload:t,error:r}=M;if(!e){if(r)throw r;if(!t)throw new Error("Something bad happened with file descriptors");fe((e=>{const r=[],n=`${O.nP}/${F}/files/trajectory`;return _.forEach(((s,o)=>{if(s.onlyTopology)return;const a=0===o,i=s.frame;let l=s.trajectoryURLs||[n];s.frameCount=0,l.forEach(((n,o)=>{const l=(e=>{const t=Me.exec(e);if(!t)return null;const r=+t.groups.start,n=Math.max(+t.groups.end,r),s=+(t.groups.step||1);return{start:r,end:n,step:s,frames:Math.floor((n-r)/s)+1}})(n);let c=n.split("/").slice(-1)[0];l&&(c=c.split("?frames=")[0]),"trajectory"===c&&(c="trajectory.bin");const u=t.find((e=>e.filename===c));if(!u)throw new Error(`Trajectory "${c}" is missing`);const m=u.metadata,f=m.frames;let p=d;if(d>f&&(p=f),Number.isFinite(i)?p=1:l&&(p=l.frames),!a&&p>1)throw new Error("Only the main component is allowed to load multiple frames");let h,g=n;if(l){const e=Math.min(f,l.end);h=Math.ceil(e/l.step)}else{const{range:e,frames:t}=we(f,p,i);h=t,e&&(g=n+`?frames=${e}`)}s.framedURLs||(s.framedURLs=[]),s.framedURLs[o]=g,s.frameCount+=p;e.find((e=>e.url===g))||(r.push({url:g,frames:h,atoms:m.atoms,loading:!0,requested:!1}),he(!0))}))})),r.length>0?[...e,...r]:e}))}}),[F,_,M,d]);const[ge,Ue]=(0,n.useState)([]),ze=(0,n.useCallback)((e=>{if(!_)return;const t=_[0],r=[];if(t.framedURLs.forEach((t=>{const n=e.find((e=>e.url===t));n&&r.push(n)})),0===r.length)return;const n=r.map((e=>e.frames)).reduce(((e,t)=>e+t),0),s=r.map((e=>e.progress*e.frames)).reduce(((e,t)=>e+t),0)/n;c(s)}),[_,c]);(0,n.useEffect)((()=>{me.forEach((e=>{if(e&&e.requested)return;e.requested=!0,e.loading=!0,e.progress=0;const t=JSON.stringify({}),r="https"===e.url.substring(0,5)?ie():ce(),n=(0,ue.parse)(e.url),s=n.pathname.split("/"),o="trajectory"===s[s.length-1];n.method=o?"POST":"GET",n.headers={"Content-Type":"application/json","Content-Length":t.length};const a=r.request(n,(t=>{const r=t.headers["content-length"];Ue((t=>[...t,{url:e.url,frames:e.frames,atoms:e.atoms,payload:new ArrayBuffer(0),progress:0}]));let n=0;t.on("data",(t=>{n+=t.byteLength,e.progress=n/r,Ue((r=>{const n=r.find((t=>t.url===e.url));return n.payload=Te(n.payload,t),n.progress=e.progress,ze(r),[...r]}))})).on("end",(()=>{e.loading=!1;const t=me.some((e=>e.loading));he(t)}))}));"POST"===n.method&&a.write(t),a.end(),de.current.push(a)}))}),[me,ze]),(0,n.useEffect)((()=>{const e=de.current;return()=>{e.forEach((e=>{e.abort()}))}}),[]);const[Oe,Be]=(0,n.useState)(0),Ie=(0,n.useCallback)((e=>{Be((t=>t+e))}),[Be]);(0,n.useEffect)((()=>{const e=new be.Stage(W.current);return(0,P.Gt)().then((()=>{e&&e.handleResize()})),e.tasks.signals.countChanged.add(Ie),J.current=e,()=>{J.current.dispose(),J.current=null}}),[]);const qe=(0,n.useMemo)((()=>I?z?me.length||j?Oe>0?"Rendering...":void 0:"No trajectory available":"No structure available":"Loading structure"),[I,z,me,j,Oe]);(0,n.useEffect)((()=>{const e=Date.now();let t=1e3;return K.current&&(t=0,K.current=!1),(async()=>{for(;;){if(await(0,P.Gt)(),!J.current)return;let r=Date.now()-e;if(r>t)break;w&&(r=t-r);const n=`#${Math.round(255*r/t).toString("16").padStart(2,"0").repeat(3)}`;J.current.viewer.setBackground(n)}await(0,P.Gt)(),J.current&&J.current.viewer.setBackground(w?"black":"white")})(),()=>t=0}),[w]),(0,n.useEffect)((()=>{J.current&&J.current.viewer&&J.current.viewer.setCamera&&J.current.viewer.setCamera(E?"perspective":"orthographic")}),[E]),(0,n.useEffect)((()=>{if(!l||j||!D)return;const e=D.expectedFrames,t=t=>{const r=(0,ye.A)(t/(e-1),0,1);l(r)};return D.signals.frameChanged.add(t),()=>{D.signals.frameChanged.remove(t)}}),[D,j,l]);const De=(0,n.useCallback)((async()=>{if(!J.current)return;const e=W.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,P.yy)(0),J.current.handleResize()}),[]);(0,n.useEffect)((()=>(window.addEventListener("resize",De),()=>{window.removeEventListener("resize",De)})),[De]),(0,n.useEffect)((()=>{_&&N&&_.forEach(((e,t)=>{let r=J.current.compList.find((t=>t.myName==e.name));if(!r){const t=e.topologyURL||null,n=ae.find((e=>e.url===t));if(!n)return;if(n.error)throw new Error(`Topology from '${t}' returned error ${n.error}`);if(!n.file)throw new Error(`Topology data from '${t}' is missing`);n.file.atomStore.occupancy=new Array(n.file.atomStore.occupancy.length).fill(1);const s=(0,Le.A)(n.file);if(r=J.current.addComponentFromObject(s),r.myName=e.name,!r)return;r.onlyTopology=e.onlyTopology,q(r)}const n=N.filter((t=>t.component===e.name)),s=[];n.forEach(((e,n)=>{const o=n+"-"+e.name;s.push(o);const a=e.show,i=e.selection,l=e.type,c=e.color,u=a?e.opacity:0,d=e.customScheme,m=e.name===b?be.ColormakerRegistry.addSelectionScheme([["yellow","all"]],"custom label"):d&&"custom"===c?d:(e=>{var t=(new Option).style;return t.color=e,t.color===e})(c)?be.ColormakerRegistry.addSelectionScheme([[c,"all"]],"custom label"):c,f={sele:i,name:o,opacity:u,colorScheme:m,colorDomain:"surface"===l?[-200,200]:void 0,surfaceType:"surface"===l?"av":void 0,side:"front",depthWrite:!("surface"===l&&u<1),...e.other},p=r.reprList.find((e=>e.name===o));if(p){const e=p.repr.type,t=p.repr.selection.string;e!==l||t!==i||"trace"===e?(r.removeRepresentation(p),r.addRepresentation(l,f)):p.setParameters(f)}else r.addRepresentation(l,f);if(e.label){const t=e.label+"-"+o,s=r.annotationList.find((e=>e.name===t));if(a)if(s)s.element.label=e.label;else{var h=document.createElement("div");h.innerText=e.label,h.style.color="#76FF03",h.style.backgroundColor="#607D8B",h.style.padding="8px";const s=r.reprList[n].repr.structureView.center;r.addAnnotation(s,h).name=t}else s&&r.removeAnnotation(s)}e.name===b&&V({comp:t,sele:e.selection})}));[...r.reprList].forEach((e=>{const t=e.name;if("*"!==t.charAt(0)){for(const e of s)if(t===e)return;r.removeRepresentation(e)}})),V((e=>e||{comp:0,sele:"all"}))}))}),[_,N,ae,b,q]),(0,n.useEffect)((()=>{if(!$)return;if(!I||!m)return;const e="*highlightedAtoms",t=I.reprList.find((t=>t.name===e));t&&I.removeRepresentation(t);const r="*highlightedAtomResidues",n=I.reprList.find((e=>e.name===r));n&&I.removeRepresentation(n);const s=Array.from(m);if(!s.length)return;const o=`@${s.map((e=>e)).join(",")}`;I.addRepresentation(k.atoms,{sele:o,opacity:.5,scale:1.5,name:e});const a=Array.from(new Set(s.map((e=>"@"+$.getAtomByIndex(e).residue.atomIndices.join(","))))).join(" or ");I.addRepresentation(k.residues,{sele:a,name:r}),V({comp:0,sele:a})}),[I,$,m,w,k]),(0,n.useEffect)((()=>{if(!$||!I||!f)return;const e="*highlightedResidues",t=I.reprList.find((t=>t.name===e));if(t&&I.removeRepresentation(t),0===f.length)return;const r=f.map((e=>$.getResidueByIndex(e).nglSelection)),n=Array.from(new Set(r)).join(" or ");I.addRepresentation(k.residues,{sele:n,name:e}),V({comp:0,sele:n})}),[I,f,$,k]),(0,n.useEffect)((()=>{if(!I||!p)return;const e="*highlightedChains",t=I.reprList.find((t=>t.name===e));t&&I.removeRepresentation(t);const r=p.map((e=>":"+e));if(!r.length)return;const n=Array.from(new Set(r)).join(" or ");I.addRepresentation(k.chains,{sele:n,name:e}),V({comp:0,sele:n})}),[I,p,k]),(0,n.useEffect)((()=>{if(!I||!v)return;const e=I.reprList;return v.forEach((e=>{I.addRepresentation(e.type,{sele:e.selection,name:e.name,color:e.color,opacity:e.opacity})})),()=>{v.forEach((t=>{const r=e.find((e=>e.name===t.name));r&&I.removeRepresentation(r)}))}}),[I,v]),(0,n.useEffect)((()=>{if(!I||!h)return;const e="*highlightedCustom",t=I.reprList.find((t=>t.name===e));if(t&&I.removeRepresentation(t),!h.length)return;const r=Array.from(new Set(h)).join(" or ");I.addRepresentation(k.selections,{sele:r,name:e}),V({comp:0,sele:r})}),[I,h,k]),(0,n.useEffect)((()=>{if(!I||!g)return;const e="*distance",t=I.reprList.find((t=>t.name===e));t&&I.removeRepresentation(t),I.addRepresentation("distance",{atomPair:g,color:"skyblue",labelUnit:"angstrom",name:e,labelColor:w?16777215:1})}),[I,g,w]),(0,n.useEffect)((()=>{if(!I||!R)return;const e="*density",t=J.current.compList.find((t=>t.name===e));t?J.current.removeComponent(t):J.current.viewer.rotationGroup.rotateY(-1.6);var r=new be.Shape("shape",{radialSegments:10});const n=I.object.center,s=I.object.boundingBox;r.addBox([n.x,n.y,R*S-S/2],[0,0,0],s.max.x-s.min.x,[0,s.max.y-s.min.y,0],[0,0,.01]),r.addBox([n.x,n.y,R*S+S/2],[0,0,0],s.max.x-s.min.x,[0,s.max.y-s.min.y,0],[0,0,-.01]);J.current.addComponentFromObject(r,{name:e}).addRepresentation("buffer",{opacity:.1,roughness:1})}),[I,R]),(0,n.useEffect)((()=>{I&&C&&J.current.viewer.rotationGroup.rotateX(-1.57)}),[I,C]),(0,n.useEffect)((()=>{if(!I||!y)return;const e="*angles",t=I.reprList.find((t=>t.name===e));t&&I.removeRepresentation(t),I.addRepresentation("angle",{atomTriple:y,name:e,labelColor:w?16777215:1})}),[I,y,w]),(0,n.useEffect)((()=>{0!==ae.length&&0!==ge.length&&_&&_.forEach(((e,t)=>{const r=e.topologyURL||null,n=ae.find((e=>e.url===r));if(!n)return;const o=J.current.compList.find((t=>t.myName==e.name));if(!o)return;if(e.onlyTopology)return;const a=[];let i,l="",c="",u=0;for(const s of e.framedURLs){const e=ge.find((e=>e.url===s));if(!e)return;if(i||(i=e.atoms),i!==e.atoms)throw new Error("Atoms number in the different trajectories do not match");u+=e.frames;const t=e.payload,r=12*i,n=Math.floor(t.byteLength/r)*r,o=t.slice(0,n);a.push(o),l+=s,c+="/"+e.progress}const d=o.combinedURL===l;if(d||o.trajList.forEach(o.removeTrajectory.bind(o)),d&&o.combinedProgress===c)return;let m;if(o.combinedURL=l,o.combinedProgress=c,0===a.length)return;if(m=1===a.length?a[0]:a.reduce(((e,t)=>Te(e,t))),0===m.byteLength)return;const f=12*i,p=m.byteLength/f,h=p-1,g=p===u,y=e.trajectoryAtomIndices,b=o.trajList;if(b.length>0){if(b.length>1)throw new Error("Multiple trajectories in one component");const e=b[0],r=e.trajectory;if(((e,t,r,n,s,o)=>{if(!(e&&t&&r))return;const a=e.frames.length;if(a>=s)return;const i=a*n*12,l=r.slice(i),c=s-a;let u;if(u=n===t.atomCount?ve(l,n,c):o?je(t.atomCount,o,l,n,c):xe(t,l,n,c),!u)throw new Error("Topology and trajectory data may not match");e.frames=e.frames.concat(u)})(r,n.file,m,i,p,y),r._frameCount=p,0===t){e.expectedFrames=u;const t=r.player,n=Pe(A);if(t.setParameters({end:h,interpolateStep:100/u,mode:g?"loop":"once",timeout:n}),!j&&s&&!t.isRunning){r._currentFrame<h&&t.play()}}}else{const e=((e,t,r,n,s)=>{if(!e||!t)return;let o;if(o=r===e.atomCount?ve(t,r,n):s?je(e.atomCount,s,t,r,n):xe(e,t,r,n),!o)throw new Error("Topology and trajectory data may not match");const a=new be.Frames("Dynamically generated trajectory","");return a.coordinates=o,a})(n.file,m,i,p,y);if(!e)return;const r=o.addTrajectory(e),s=r.trajectory;if(0===t){r.expectedFrames=u;const e=Pe(A);s.player.setParameters({interpolateStep:100/u,mode:g?"loop":"once",timeout:e}),G(r)}s.setFrame(0)}}))}),[ae,ge,_,j,G,d,s,A]),(0,n.useEffect)((()=>{if(!D)return;const e=D.trajectory,t=()=>{const t=e._currentFrame;e.setFrame(t)};return e.player.signals.haltedRunning.add(t),()=>{e.player.signals.haltedRunning.remove(t)}}),[D]),(0,n.useEffect)((()=>{if(!D)return;const{player:e}=D.trajectory;return e.setParameters({interpolateStep:100/D.trajectory.frameCount,direction:u?"bounce":"forward"}),j?e.pause():e[s&&Y?"play":"pause"](),()=>e.pause()}),[D,s,Y,j,u]),(0,n.useEffect)((()=>{if(!I)return;const e=I.trajList[0];if(!e)return;const t=Pe(A);e.trajectory.player.setParameters({timeout:t})}),[I,A]),(0,n.useEffect)((()=>{J.current&&J.current.spinAnimation&&a===J.current.spinAnimation.paused&&J.current.toggleSpin()}),[a]),(0,n.useEffect)((()=>{D&&(D.trajectory.player.parameters.interpolateType=i?"linear":"")}),[D,i]),(0,n.useEffect)((()=>{if(I&&me.length)return De(),De.cancel}),[I,me,De]),(0,n.useEffect)((()=>{if(!I||!$)return;const e=e=>{let{detail:t}=e;if(!t||"click"!==t.eventtype&&"reset"!==t.eventtype)return;let r="";for(const o of document.querySelectorAll("protvista-manager")){const e=o.attributeValues.get("highlight"),t=o.attributes.chain.value;if(!e)continue;const[n,s]=e.split(":"),a=$.getResidueByParameters(t,+n),i=$.getResidueByParameters(t,+s);if(a.chainName!==i.chainName)throw new Error("Range from multiple chains is not supported");r+=` or :${a.chainName} and ${a.number}-${i.number}`}r=r.substr(4);const n=I&&I.reprList.find((e=>"structure"===e.name));if(n&&I.removeRepresentation(n),!r)return I.addRepresentation("cartoon",{sele:Fe,name:"structure",opacity:1}),void(U&&J.current.animationControls.orient(U,ke));const s=be.ColormakerRegistry.addSelectionScheme([["yellow",r],["white","*"]],"custom label");I.addRepresentation("cartoon",{sele:Fe,name:"structure",opacity:1,color:s}),I.autoView(r,ke)};return window.addEventListener("change",e),()=>window.removeEventListener("change",e)}),[I,$,U]),(0,n.useEffect)((()=>{if(!$)return;const e=X.current;W.current.appendChild(e),J.current.mouseControls.remove("hoverPick");const t=e=>{const t=$.getResidueByIndex(e.residueIndex),r=t.chain.metadataChainName,n=t.referenceId;return(0,L.jsxs)(L.Fragment,{children:[`Atom ${e.index} (${e.atomname})\n                Chain ${t.chainName} ${r?"("+r+")":""}\n                Residue ${t.number} (${e.resname})`,(()=>{if(n)return"noref"===n?(0,L.jsx)("div",{style:{color:"orange"},children:"No referable"}):"notfound"===n?(0,L.jsx)("div",{style:{color:"salmon"},children:"Reference not found"}):(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{style:{color:"lightGreen"},children:t.referenceName}),"protein"===t.referenceType&&(0,L.jsx)("div",{children:`- Residue ${t.referenceNumber}`})]})})()]})};let r;const n=()=>{clearTimeout(r),e.style.display="none"};return J.current.signals.hovered.add((function(s){s?(n(),r=setTimeout((()=>{let r;const n=s.bond,o=s.atom;if(n){const e=n.atom1,s=n.atom2;r=(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{children:`Bond ${e.index} - ${s.index}`}),(0,L.jsx)("hr",{style:{color:"lightGrey"}}),t(e),(0,L.jsx)("hr",{style:{color:"lightGrey"}}),t(s)]})}else o&&(r=t(o));te(r),e.style.display="block";const{x:a,y:i}=(0,Ee.L)(W.current,e,s.mouse.position,3);e.style.top=i+"px",e.style.left=a+"px"}),400)):n()})),W.current.addEventListener("mouseleave",n,!1),()=>{e.remove(),W.current.removeEventListener("mouseleave",n)}}),[$,te]);const Ge=(0,n.useRef)(!0);(0,n.useEffect)((()=>{if(!H)return;const e=H.comp?J.current.compList.find((e=>e.myName===H.comp)):I;if(!e)return;let t=ke;Ge.current&&(t=0,U&&J.current.animationControls.orient(U,0),Ge.current=!1),e.autoView(H.sele,t)}),[I,H,U]),(0,n.useImperativeHandle)(t,(()=>({autoResize:De,displayFocus(){const e=`[${J.current.viewerControls.getOrientation().elements.toString()}]`;console.log(e)},centerFocus(){V({comp:0,sele:"all"}),U&&J.current.animationControls.orient(U,ke)},get currentFrame(){if(!I||!me.length)return-1;try{return I.trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(I&&me.length)try{const t=this.totalFrames;let r=e;r<0&&(r=0),r>=t&&(r=t-1),I.trajList[0].trajectory.setFrame(r)}catch(t){}},get totalFrames(){if(!I||!me.length)return 1;try{return I.trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return I.trajList[0].expectedFrames}catch(e){return 1}}})),[I,me,De]);return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)("div",{ref:e=>{e&&(Q(e),W.current=e)},className:o()(r,Ae,{[Se]:!I,[Ce]:!j&&pe,[Re]:!w}),"data-loading":qe,children:(0,L.jsx)("div",{ref:X,className:_e,children:Z})})})})));Ue.displayName="NGLViewer";const ze=Ue;var Oe=r(10419),Be=r(92954);const Ie=Symbol("low"),qe=Symbol("medium"),De=Symbol("high"),Ge=()=>{if(!navigator||!navigator.connection)return qe;const{effectiveType:e,saveData:t}=navigator.connection;if(!0===t)return Ie;if(!e)return qe;switch(e){case"slow-2g":case"2g":return Ie;case"3g":return qe;default:return De}};var He=r(17604);const Ve="style_background-toggle__aAj32",We="style_dark__e5mDQ",Je="style_adapter__+rjEA",Xe="style_ngl-with-settings__k93CW",Ke="style_ngl-without-settings__qTooi",Qe="style_settings-left__Wvi5a",Ye="style_settings-controls__kLLNo",Ze="style_ngl-alone__5TmnB",et="style_stacked-icons__OoF+a",tt="style_extra-top-margin__vaEmm",rt="style_settings-right__NDIcU",nt="style_hidden__D+3lX",st="style_fullscreen-toggle__f4Bk2",ot="style_is-fullscreen__RtQvN",at="style_settings__87jIw",it="style_fullscreen-target__VO3Yh",lt="style_progress__LNzos",ct="style_controls__0ugFi",ut="style_flip-container__dGHQ+",dt="style_flip-card-container__wgyMe",mt="style_flipped__DhDpU",ft="style_flip-card__g+agx",pt="style_front__g9FOf",ht="style_back__UfiiZ",gt="style_progressContainer__kQ85K",yt="style_timeInfo__wEsXY";var bt=r(62598);const vt=!(0,He.A)()&&window.innerWidth>750,jt=(()=>{switch(Ge()){case De:return 50;case qe:return 25;default:return 10}})(),xt=[{value:1,label:"1"},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],wt={name:"Unnamed component",topologyURL:"auto",trajectoryURLs:"auto",atomSelection:null,frame:null,onlyTopology:!1},Et={name:"Unnamed representation",selection:"all",show:!0,type:"cartoon",color:"chainid",opacity:1,component:"auto"},At=(e,t)=>{let r=!1;for(const[n,s]of Object.entries(t))void 0===e[n]&&(e[n]=s,r=!0);return r},Rt=(0,n.forwardRef)(((e,t)=>{let{startingComponents:r,startingRepresentations:s,componentsState:a,representationsState:b,className:v,startsPlaying:j=vt,close:x,nail:w,requestedFrame:E,framesSelect:A=!0,preventTrajectory:R=!1,onProgress:C,...S}=e;if(r&&a)throw new Error("startingComponents and componentsState are not compatilbe inputs. Choose one.");if(s&&b)throw new Error("startingRepresentations and representationsState are not compatilbe inputs. Choose one.");const[_,N]=(0,n.useState)(ze),{metadata:k,accessionAndMdNumber:F,topology:M}=(0,n.useContext)(ee.f),[P,$]=(0,n.useState)({frame:0,time:0}),B=(0,n.useMemo)((()=>{const e=k.mdFrames,t=[...xt];for(let r=t.length-1;r>=0&&t[r].value>e;r--)t.pop();return t.length===xt.length||t[t.length-1].value!==e&&t.push({value:e,label:e.toString()}),t}),[k.mdFrames]),I=(0,n.useMemo)((()=>r?r.map((e=>(0,bt.JH)(e))):null),[r]),[q,D]=a||(0,n.useState)(I),G=(0,n.useCallback)((e=>{if(!F)return!1;const t={...wt};return t.topologyURL=`${O.nP}/${F}/files/structure`,t.trajectoryURLs=[`${O.nP}/${F}/files/trajectory`],At(e,t)}),[F]);(0,n.useEffect)((()=>{if(!G)return;if(!q){const e=[{name:"Main"}];return e.forEach((e=>{G(e)})),D(e)}const e=q.map((e=>e.name)),t=new Set(e);if(e.length!==t.size)throw new Error(`We have multiple components with the same name: ${e.join(", ")}`);q.map((e=>G(e,wt))).some((e=>!0===e))&&D([...q])}),[q,G]),(0,n.useEffect)((()=>{q&&void 0!==E&&q[0].frame!==E&&(q[0].frame=E,D([...q]))}),[q,E]);const H=(0,n.useMemo)((()=>s?s.map((e=>(0,bt.JH)(e))):null),[s]),[V,W]=b||(0,n.useState)(H),J=(0,Oe.A)(),X=(0,n.useCallback)((e=>{if(!q)return!1;const t={...Et};return t.component=q[0].name,At(e,t)}),[q]);(0,n.useEffect)((()=>{if(!J||0===J.length)return;if(!V){if(b)return;const e=[...J];return e.forEach((e=>X(e))),W(e)}V.map((e=>X(e))).some((e=>!0===e))&&W([...V])}),[V,J,X]);const K=(0,n.useRef)(null),Q=(0,n.useRef)(null),[Y,Z]=(0,Be.A)(!1),[te,re]=(0,Be.A)(j),[ne,se]=(0,Be.A)(!1),[oe,ae]=(0,n.useState)(!0),[ie,le]=(0,Be.A)((0,n.useMemo)((()=>U("dark-background",!1)),[])),[ce,ue]=(0,Be.A)((0,n.useMemo)((()=>U("perspective",!1)),[])),[de,me]=(0,n.useState)(0),[fe,pe]=(0,n.useState)(0),[he,ye]=(0,n.useState)(i().isFullscreen),[be,ve]=(0,n.useState)(Math.min(jt,k.mdFrames)),[je,xe]=(0,n.useState)((0,n.useMemo)((()=>U("speed",50)),[])),[we,Ee]=(0,n.useState)(!1),Ae=(0,n.useCallback)((e=>{if(C&&C(e),me(e),Q.current){const t=Q.current.currentFrame,r=k.FRAMESTEP?(k.timeLength*e).toFixed(2):0;$({frame:t,time:r})}}),[me,C,k.FRAMESTEP]),Re=(0,n.useCallback)((e=>{pe(e)}),[pe]),Ce=(0,n.useCallback)((e=>{let{buttons:t,clientX:r,currentTarget:n,type:s}=e;if(!Q.current)return;if("mousemove"===s&&1!==t)return;const{x:o,width:a}=n.getBoundingClientRect();re(!1),Q.current.currentFrame=Math.floor((r-o)/a*Q.current.totalExpectedFrames)}),[re]),Se=(0,n.useCallback)((e=>{Q.current&&(re(!1),Q.current.currentFrame+=e)}),[re]),_e=(0,n.useCallback)((()=>Se(-1)),[Se]),Le=(0,n.useCallback)((()=>Se(1)),[Se]),Ne=(0,n.useCallback)((()=>ye(i().isFullscreen)),[]);(0,n.useEffect)((()=>(i().on("change",Ne),()=>i().off("change",Ne))),[Ne]);const ke=(0,n.useCallback)((()=>{K.current&&i().toggle(K.current)}),[]);(0,n.useEffect)((()=>{const e=e=>{"Escape"===e.key&&(Ee(!1),Q.current.autoResize())," "===e.key&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),re((e=>!e)))};return document.addEventListener("keydown",e,!1),()=>document.removeEventListener("keydown",e,!1)}),[]);const Fe=(0,n.useMemo)((()=>{if(!M||!M.pbcResidues)return;const e=M.pbcResidues.size>0;return e&&ae(!1),e}),[M]);(0,n.useImperativeHandle)(t,(()=>({autoResize:Q.current.autoResize,centerFocus:Q.current.centerFocus,get currentFrame(){return Q.current.currentFrame},set currentFrame(e){Q.current.currentFrame=e},togglePlaying:re,setFinalComponents:D,setFinalRepresentations:W})),[re,D,W]);const Me=q&&q[0],Te=R||Me&&(Me.onlyTopology||Number.isFinite(Me.frame));return(0,L.jsx)(l.A,{className:o()(it,{[ot]:he}),ref:K,children:(0,L.jsxs)("div",{className:o()(Je,v),children:[(0,L.jsxs)(l.A,{className:we?Xe:Ke,style:{border:"none",boxShadow:"none"},id:"preventDragSize",children:[(0,L.jsxs)(l.A,{className:we?o()(Qe,v):o()(Ze,v),style:{border:"none",boxShadow:"none"},children:[(0,L.jsx)(_,{playing:te,spinning:ne,smooth:oe,onProgress:Ae,onLoad:Re,ref:Q,noTrajectory:Te,requestedFramesNumber:be,darkBackground:ie,perspective:ce,speed:je,components:q,representations:V,...S}),we&&(0,L.jsxs)("div",{className:Ye,children:[(0,L.jsxs)("div",{className:et,children:[(0,L.jsx)(c.A,{title:"Toggle spin",onClick:se,size:"large",children:(0,L.jsx)(h.g,{icon:y.OtC})}),(0,L.jsx)(c.A,{title:"Center focus",onClick:e=>{if(!Q.current)return;e.shiftKey||e.ctrlKey||e.metaKey?Q.current.displayFocus():Q.current.centerFocus()},size:"large",children:(0,L.jsx)(h.g,{icon:g.RV})}),Te||(0,L.jsx)("div",{className:et,title:Fe&&"Smooth interpolation is not allowed since there are residues under Periodic Boundary Conditions. The smoothing may result in misleading artifacts for those atoms jumping across boundaries.",children:(0,L.jsx)(c.A,{title:"Toggle smooth interpolation "+(oe?"off":"on"),onClick:()=>ae((e=>!e)),disabled:Fe,size:"large",children:(0,L.jsx)(h.g,{icon:oe?g.yv:y.n2W})})}),(0,L.jsx)(c.A,{title:"Invert background color",onClick:()=>{le(),z("dark-background",!ie)},size:"large",children:(0,L.jsx)("div",{className:o()(Ve,{[We]:ie}),children:(0,L.jsx)(h.g,{icon:y.Rpi})})}),(0,L.jsx)(c.A,{title:`Switch to ${ce?"ortographic":"perspective"} view`,onClick:()=>{ue(),z("perspective",!ce)},size:"large",children:(0,L.jsx)(h.g,{icon:ce?g.Nf:y.br3})}),(0,L.jsx)(c.A,{title:"Switch viwer to "+(_===ze?"MolStar":"NGL"),onClick:()=>{N((e=>{if(e===ze)return ge;if(e===ge)return ze;throw new Error("Unrecognized current viewer")}))},size:"large",children:(0,L.jsx)(h.g,{icon:_===ze?y.RPy:y.QOt})})]}),Te||(0,L.jsxs)("div",{children:["Speed:",(0,L.jsxs)(u.Ay,{container:!0,spacing:2,className:tt,children:[(0,L.jsx)(u.Ay,{item:!0,children:(0,L.jsx)(d.A,{children:(0,L.jsx)(h.g,{icon:y.zsV})})}),(0,L.jsx)(u.Ay,{item:!0,xs:!0,children:(0,L.jsx)(m.Ay,{title:"Change player speed",value:je,"aria-labelledby":"continuous-slider",onChange:(e,t)=>{xe(t),z("speed",t)}})}),(0,L.jsx)(u.Ay,{item:!0,children:(0,L.jsx)(d.A,{children:(0,L.jsx)(h.g,{icon:y.Cz6})})})]})]}),Te||(0,L.jsxs)("div",{children:["Frames:",A?(0,L.jsx)(m.Ay,{title:"Select frame number",value:be,onChange:(e,t)=>ve(t),"aria-labelledby":"discrete-slider-restrict",step:null,valueLabelDisplay:"auto",marks:B,max:B[B.length-1].value}):" "+Q.current.totalExpectedFrames]})]})]}),we&&(0,L.jsx)("div",{className:rt,children:(0,L.jsx)(T,{components:q,representations:V,setRepresentations:W})})]}),(0,L.jsxs)(f.A,{style:{padding:0},children:[Te?(0,L.jsx)("div",{}):(0,L.jsxs)("div",{className:gt,children:[(0,L.jsx)("div",{className:o()(lt,{[We]:ie}),onClick:Ce,onMouseMove:Ce,children:(0,L.jsx)(p.A,{variant:"buffer",color:"primary",value:100*de,valueBuffer:100*fe,style:{height:"1ch"},className:"prevent-drag"})}),k.FRAMESTEP&&(0,L.jsxs)("div",{className:o()(yt,{[We]:ie}),children:["Time: ",P.time," / ",k.timeLength," ns"]})]}),(0,L.jsxs)("div",{className:ct,children:[(0,L.jsxs)("div",{children:[(0,L.jsx)(c.A,{title:"Close viewer",className:o()({[nt]:!x}),disabled:!x,onClick:x,size:"large",children:(0,L.jsx)(h.g,{icon:y.GRI})}),(0,L.jsx)(c.A,{title:Y?"Nailed viewer":"Nail viewer",className:o()({[nt]:!w}),disabled:!w||Y,onClick:()=>{w(),Z()},size:"large",children:(0,L.jsx)("div",{className:ut,children:(0,L.jsxs)("div",{className:o()(dt,{[mt]:Y}),children:[(0,L.jsx)(h.g,{className:o()(ft,pt),icon:y.KKb}),(0,L.jsx)(h.g,{className:o()(ft,ht),icon:y.DW4})]})})})]}),(0,L.jsx)("div",{children:Te||(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(c.A,{title:"Previous frame",onClick:_e,size:"large",children:(0,L.jsx)(h.g,{icon:y.L4I})}),(0,L.jsx)(c.A,{title:te?"Pause":"Play",onClick:re,size:"large",children:(0,L.jsx)("div",{className:ut,children:(0,L.jsxs)("div",{className:o()(dt,{[mt]:te}),children:[(0,L.jsx)(h.g,{className:o()(ft,pt),icon:y.ijD}),(0,L.jsx)(h.g,{className:o()(ft,ht),icon:y.G1Y})]})})}),(0,L.jsx)(c.A,{title:"Next frame",onClick:Le,size:"large",children:(0,L.jsx)(h.g,{icon:y.BxI})})]})}),(0,L.jsxs)("div",{children:[(0,L.jsx)(c.A,{title:(he?"Exit":"Go")+" fullscreen",onClick:ke,className:o()(st,{[nt]:!i().isEnabled,[ot]:he,[at]:we}),disabled:!i().isEnabled,size:"large",children:(0,L.jsx)(h.g,{icon:he?y.gr3:y.oZK})}),(0,L.jsx)(c.A,{title:"Settings",onClick:()=>{Ee((e=>!e)),Q.current.autoResize()},size:"large",children:(0,L.jsx)(h.g,{icon:y.dB})})]})]})]})]})})}));Rt.displayName="ViewerWithControls";const Ct=Rt}}]);
//# sourceMappingURL=1235.68c4eda6.chunk.js.map