"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[5190,6618,9302],{3152:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(54577),a=n(10500),s=n(28593),i=n(28666),l=r.A?r.A.prototype:void 0,o=l?l.toString:void 0;const c=function e(t){if("string"==typeof t)return t;if((0,s.A)(t))return(0,a.A)(t,e)+"";if((0,i.A)(t))return o?o.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const d=function(e){return null==e?"":c(e)}},3777:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(99944);const a=function(e){var t=(0,r.A)(e),n=t%1;return t===t?n?t-n:t:0}},6880:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(31133),a=n(3777),s=n(32222),i=n(3152),l=r.A.isFinite,o=Math.min;const c=function(e){var t=Math[e];return function(e,n){if(e=(0,s.A)(e),(n=null==n?0:o((0,a.A)(n),292))&&l(e)){var r=((0,i.A)(e)+"e").split("e"),c=t(r[0]+"e"+(+r[1]+n));return+((r=((0,i.A)(c)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round")},10500:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){for(var n=-1,r=null==e?0:e.length,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}},10939:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(65043),a=n(12110),s=n(17604);const i="style_container__M9GCG";var l=n(70579);const o={opacity:[0,1]};(0,s.A)()||(o.transform=["translateY(50px)","translateY(0)"]);const c={fill:"both",easing:"cubic-bezier(0, .99, .56, 1.1)",duration:500},d=(0,r.forwardRef)(((e,t)=>{let{overrideComponent:n,...s}=e;const d=(0,r.useRef)(null);(0,r.useLayoutEffect)((()=>{const e=d.current&&d.current.firstElementChild;if(!e||!e.animate)return;const t=Array.from(document.querySelectorAll("main section")).findIndex((t=>e===t)),n=e.animate(o,{...c,delay:150*t});return()=>n.cancel()}),[]);const u=n?"section":a.A;return(0,l.jsx)("div",{ref:d,className:i,children:(0,l.jsx)(u,{component:"section",...s,ref:t})})}))},28593:(e,t,n)=>{n.d(t,{A:()=>r});const r=Array.isArray},34088:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(65043),a=n(43126),s=n(10939);const i="style_rnd__Txifm",l="style_floating-card__HHpby";var o=n(70579);const c=(0,r.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2629),n.e(9070),n.e(2594),n.e(7955),n.e(349),n.e(1235),n.e(9117)]).then(n.bind(n,92428))));let d=0;const u=e=>{const t=e.viewerRef||(0,r.useRef)(null),[n,u]=(0,r.useState)((()=>{const{innerWidth:e,innerHeight:t,scrollY:n}=window,r=document.querySelector("main").offsetTop,a=Math.max(Math.min(e/4,t/4),150),s=1.5*a;return{width:2*a,height:s,x:0,y:t-r-s-20+n}}));return(0,o.jsx)(a.p,{position:{x:n.x,y:n.y},size:{width:n.width,height:n.height},style:{zIndex:(d+=1,d)},className:i,"data-rnd":!0,bounds:"window",cancel:"canvas, [data-popover], #preventDragSize, .prevent-drag",onDragStart:()=>{u({...n})},onResizeStart:()=>{u({...n})},onDragStop:(e,t)=>{0===e.layerX&&0===e.layerY||n.x===t.x&&n.y===t.y||u({...n,x:t.x,y:t.y})},onResize:()=>t.current&&t.current.autoResize(),onResizeStop:(e,t,n,r,a)=>{u({width:n.style.width,height:n.style.height,...a})},children:(0,o.jsx)(s.A,{className:l,elevation:4,children:(0,o.jsx)(r.Suspense,{fallback:null,children:(0,o.jsx)(c,{className:l,ref:t,startsPlaying:!1,...e})})})})},p=e=>{let{newViewer:t,nailing:n=!0,onNail:a,onClose:s}=e;const[i,l]=(0,r.useState)([]),c=[...i],d=(0,r.useRef)([]);if(t){const e=()=>{let e=0;for(;e<999;){if(-1===d.current.indexOf(e))return e;e+=1}console.error("Maximum number of viewers reached")};t.id=e(),t.close=()=>{n&&l((e=>{const n=[...e],r=e.indexOf(t);return-1!==r&&n.splice(r,1),n})),s&&s(t),d.current.push(t.id)},n&&(t.nail=()=>{l((e=>[...e,t])),a&&a(t),d.current.push(t.id)}),c.push(t)}return c.map((e=>(0,o.jsx)(u,{...e},e.id)))}},35190:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r={card:"style_card__6C+Fc","ngl-card":"style_ngl-card__+pU8V",placeholder:"style_placeholder__2w0--",projection:"style_projection__v0o3I","viewer-with-controls":"style_viewer-with-controls__nFIv5"}},40830:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(){}},89302:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var r=n(65043),a=n(64600),s=n.n(a),i=n(26494),l=n(85865),o=n(10939),c=n(34088),d=n(40830),u=n(6880),p=n(32577),h=n(71806),x=n(84882),f=n(28076),m=n(10039),g=n(73460),v=n(11906),j=n(92127),y=n(44642),A=n(17604);const _="style_delete__BYITu",w="style_graph-container__2Y--C",$="style_axis__z8ryu",b="style_visual__S4w3g",P="style_bars__p3cKG",S="style_has-projection__R+xxb",E="style_projected__M7dqT",R="style_target__Kzgs+",F="style_explanation__kphn8",N="style_top-line__WYRxq",C="style_area__BwFoU",k="style_tooltip__ZrzAO";var z=n(70579);const M=20,Y=40,q=20,B=30,H=e=>{let{eigenvalues:t,totalEigenvalue:n,projectionsData:a,projections:s=[],setProjections:i}=e;const l=(0,r.useRef)(null),o=(0,r.useRef)(null),c=(0,r.useRef)(d.A),H=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=(0,p.Ltv)(l.current).append("svg");e.append("defs").append("clipPath").attr("id","clip-reveal").append("rect").attr("x",0).attr("y",0).attr("height","100%").attr("width",0).transition().duration((0,A.A)()?0:2150).attr("width","100%");const r={xAxis:e.append("g").attr("class",$),yExplAxis:e.append("g").attr("class",$),yEigenAxis:e.append("g").attr("class",$),explanationArea:e.append("g").attr("class",F),visualBars:e.append("g").attr("class",`${b} ${P}`),targetBars:e.append("g").attr("class",`${R} ${P}`)};return c.current=function(){let{processed:a=H.current}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clientWidth:s,clientHeight:c}=l.current;e.attr("width",s).attr("height",c);const d=(0,p.WH)().domain(a.map(((e,t)=>t))).range([B,s-Y]).padding(.1);r.xAxis.call((e=>e.attr("transform",`translate(0, ${c-q})`).call((0,p.l78)(d).tickFormat((e=>e+1)))));const u=(0,p.m4Y)().domain([0,1]).range([c-q,M]).nice();r.yExplAxis.call((e=>e.attr("transform",`translate(${s-Y}, 0)`).call((0,p.eH3)(u).ticks(6).tickFormat((e=>100*("number"===typeof e?e:0)+"%")))));const h=(0,p.n8j)().x(((e,t)=>d(t)+d.bandwidth()/2)).y(u),x=r.explanationArea.selectAll(`path.${N}`).data([a]);x.enter().append("path").attr("class",N).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(x).attr("d",(e=>h(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const f=(0,p.Wcw)().x(((e,t)=>d(t)+d.bandwidth()/2)).y0(c-q).y1((e=>u(e))),m=r.explanationArea.selectAll(`path.${C}`).data([a]);m.enter().append("path").attr("class",C).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(m).attr("d",(e=>f(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const g=(0,p.m4Y)().domain([0,t[0]]).range([c-q,M]).nice();r.yEigenAxis.call((e=>e.attr("transform",`translate(${B}, 0)`).call((0,p.V4s)(g).ticks(5))));const v=r.visualBars.selectAll("rect").data(a);if(v.enter().append("rect").attr("y",g(0)).attr("height",0).merge(v).attr("class",(e=>{let{hasProjection:t,projected:n}=e;return`${t?S:""} ${n?E:""}`.trim()||null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth()).transition().ease(p.g9.overshoot(5)).duration((0,A.A)()?0:500).delay((0,A.A)()?0:(e,t)=>50*t).attr("y",(e=>g(e.eigenvalue))).attr("height",(e=>c-q-g(e.eigenvalue))),!o.current)return;const j=r.targetBars.selectAll("rect").data(a);j.enter().append("rect").attr("y",0).attr("height","100%").on("click",((e,t)=>{let{hasProjection:n}=e;n&&i((e=>{const n=new Set(e);return n[n.has(t)?"delete":"add"](t),Array.from(n).sort(((e,t)=>e-t))}))})).on("mousemove",((e,t)=>{o.current.innerHTML=`\n            <div>\n              <p>Principal component ${t+1}</p>\n              <p>Eigenvalue: ${(Math.round(100*e.eigenvalue)/100).toFixed(2)}</p>\n              <p>\n                Explained variance: ${(Math.round(e.eigenvalue/n*1e3)/10).toFixed(1)}%\n              </p>\n              <p>\n                Cumulative explained variance: ${(Math.round(1e3*e.cumulativeExplained)/10).toFixed(1)}%\n              </p>\n              <p>Projection data is ${e.hasProjection?"":"not"} available</p>\n            </div>\n          `,o.current.style.opacity=1})).on("mouseout",(()=>o.current.style.opacity=0)).merge(j).attr("class",(e=>{let{hasProjection:t}=e;return t?S:null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth())},window.addEventListener("resize",c.current),()=>window.removeEventListener("resize",c.current)}),[t,i,n]),(0,r.useEffect)((()=>{let e=0;const r=[];for(const[i,l]of t.entries()){const t=a[i];e+=l;const o=e/n;if(r.push({cumulativeExplained:o,eigenvalue:l,projected:s.includes(i),hasProjection:!!t}),i>=14&&o>=.8)break}H.current=r,c.current({processed:r})}),[t,a,n,s]),(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{className:w,ref:l}),(0,z.jsx)("div",{className:k,ref:o}),!!s.length&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(h.A,{children:[(0,z.jsx)(x.A,{children:(0,z.jsxs)(f.A,{children:[(0,z.jsx)(m.A,{children:"Principal component"}),(0,z.jsx)(m.A,{children:"Eigenvalue"}),(0,z.jsx)(m.A,{children:"Explained variance"})]})}),(0,z.jsx)(g.A,{children:s.map((e=>(0,z.jsxs)(f.A,{children:[(0,z.jsx)(m.A,{children:e+1}),(0,z.jsx)(m.A,{children:(0,u.A)(t[e],2)}),(0,z.jsxs)(m.A,{children:[(0,u.A)(t[e]/n*100,1)," %"]})]},e)))})]}),(0,z.jsxs)(v.A,{variant:"contained",onClick:()=>i([]),className:_,children:[(0,z.jsx)(j.g,{icon:y.UB}),"\xa0",(0,z.jsx)("span",{children:"Clear selection"})]})]})]})};var L=n(17545),D=n(58338),I=n(29449),T=n(95747),U=n(96618),W=n(35190);const O=(0,r.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(2629),n.e(9070),n.e(2594),n.e(7955),n.e(349),n.e(1235),n.e(9117)]).then(n.bind(n,92428)))),V=(0,r.lazy)((()=>Promise.all([n.e(6264),n.e(7515)]).then(n.bind(n,8018)))),G=(0,z.jsx)("div",{className:s()(W.default.placeholder,W.default.projection)}),K=(0,z.jsx)("div",{className:s()(W.default.placeholder,W.default["viewer-with-controls"])}),X=()=>{const{accessionAndMdNumber:e,metadata:t,files:n}=(0,r.useContext)(I.f),{loading:a,payload:s,error:d}=(0,D.A)(`${T.nP}/${e}/analyses/pca/`),u=s&&s.data,[p,h]=(0,r.useState)([]),[x,f]=(0,r.useState)(null),[m,g]=(0,r.useMemo)((()=>{if(f(null),!u)return[];const e=u.eigenvalues;if(!e.length)return[];const t=e.reduce(((e,t)=>e+t),0);return[p.reduce(((t,n)=>t+e[n]),0)/t,t]}),[u,p]),[v,j]=(0,r.useMemo)((()=>{if(!u||!n)return[void 0,void 0];let t;if(void 0!==p[0]){const n=("0"+(p[0]+1)).slice(-2);t=[`${T.nP}/${e}/files/pca_trajectory_${n}.bin`]}return[[{name:"PC projection",type:"spacefill"}],[{topologyURL:`${T.nP}/${e}/files/structure`,atomSelection:"@"+u.atoms.join(","),trajectoryURLs:t}]]}),[u,n,p,e]);return a?(0,z.jsx)(L.A,{}):d?d.toString():(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(o.A,{className:W.default.card,children:(0,z.jsxs)(i.A,{children:[(0,z.jsx)(l.A,{variant:"h6",children:"PCA eigenvalues"}),(0,z.jsx)(H,{eigenvalues:u.eigenvalues,totalEigenvalue:g,projectionsData:u.projections,projections:p,setProjections:h})]})}),(0,z.jsx)(o.A,{className:W.default.card,children:(0,z.jsxs)("div",{children:[(0,z.jsxs)(i.A,{children:[(0,z.jsx)(l.A,{variant:"h6",children:"PCA projections"}),(0,z.jsx)("p",{children:(0,U.default)(p,m)})]}),1===p.length&&(0,z.jsx)(r.Suspense,{fallback:K,children:(0,z.jsx)(i.A,{className:W.default["ngl-card"],children:(0,z.jsx)(O,{className:W.default["viewer-with-controls"],projection:p[0],framesSelect:!1,startingRepresentations:v,startingComponents:j,bounce:!0})})}),2===p.length&&(0,z.jsx)(r.Suspense,{fallback:G,children:(0,z.jsx)(i.A,{children:(0,z.jsx)(V,{framestep:u.framestep,projectionsData:u.projections,projections:p,datumRange:u.eigenvalues.length,totalFrames:t.mdFrames,setRequestedFrame:f})})})]})}),(0,z.jsx)(c.A,{newViewer:Number.isFinite(x)?{requestedFrame:x}:null,onNail:e=>f((t=>e.requestedFrame===t?null:t)),onClose:e=>f((t=>e.requestedFrame===t?null:t))})]})}},96618:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var r=n(6880);const a=(e,t)=>{if(!e.length)return"No projection selected, please select one or multiple projections to\n    visualise its or their related data. Only the darker blue bars correspond to\n    projections for which data has been calculated.";let n;return n=1===e.length?e[0]+1:2===e.length?`${e[0]+1} and ${e[1]+1}`:e.reduce(((e,t,n,r)=>{let{length:a}=r;return`${e}${e?",":""}${n===a-1?" and":""} ${t+1}`}),""),`Selected principal component${e.length>1?"s":""} ${n}, accounting for ${(0,r.A)(100*t,1)}% of explained variance`}}}]);
//# sourceMappingURL=9302.4c31bd1f.chunk.js.map