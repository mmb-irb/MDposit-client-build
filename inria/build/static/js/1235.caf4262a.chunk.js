(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[1235],{10419:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(65043),o=r(29449),s=r(66496);const a=()=>{const{chains:e,metadata:t,topology:r}=(0,n.useContext)(o.f),{file:a}=(0,n.useContext)(o.I);return(0,n.useMemo)((()=>{if(!r)return[];const n=[],o=t&&t.LIGANDS;if(t&&e){const o=t.CHAINNAMES;if(o)for(const t of e){const e=o[t];n.push({name:e?e+" (Chain "+t+")":"Chain "+t,selection:":"+t})}else{[{name:"Protein",selection:"protein"},{name:"Nucleic acids",selection:"nucleic"}].forEach((e=>{(0,s.w1)(e.selection,a)&&n.push(e)}))}r.chainNames.forEach((t=>{if(-1!==e.indexOf(t))return;if(r.getChainByName(t).residues.every((e=>"ligand"===e.referenceType)))return;const s=o&&o[t]||t;n.push({name:s,selection:":"+t,type:"licorice",color:"purple",opacity:.5})}))}else n.push({name:"Main structure"});if(o)for(const e of o)if("string"===typeof e){const t=r.getReferenceResidueIndices(e);if(!t||0===t.length)continue;const{rangedSelection:o}=r.residueIndices2Ngl(t);n.push({name:e,selection:o,type:"ball+stick",color:"element"})}else{if(!e.ngl)continue;n.push({name:e.name,selection:e.ngl,type:"licorice"})}const c=[];if(r.residueAtomIndices.forEach((e=>{e.length>1||c.push(e[0])})),c.length>0){const e="@"+c.join(",");n.push({name:"Ions",selection:e,type:"spacefill",color:"element"})}const i=[];n.forEach((e=>{const t=void 0===e.type||"cartoon"===e.type,r=(0,s.kn)(e.selection,t,a);i.push(...r)}));const l=r.residueCount,u=[];for(let e=0;e<l;e++)-1===i.indexOf(e)&&u.push(e);if(u.length>0){const{rangedSelection:e}=r.residueIndices2Ngl(u);n.push({name:"Other",selection:e,type:"licorice",color:"grey",opacity:.3})}return n}),[e,t,r,a])}},92428:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>At});var n=r(89379),o=r(80045),s=r(65043),a=r(64600),c=r.n(a),i=r(54109),l=r.n(i),u=r(12110),m=r(17392),d=r(68903),f=r(44208),p=r(99070),h=r(26494),g=r(10611),y=r(92127),b=r(44642),j=r(12639),w=r(71806),v=r(84882),x=r(28076),L=r(10039),A=r(73460),E=r(67784),R=r(2260),C=r(43845);const S="style_popover-slider__Rg-SB";var _=r(70579);const k=[{label:"Cartoon",value:"cartoon"},{label:"Licorice",value:"licorice"},{label:"Ball and stick",value:"ball+stick"},{label:"Surface",value:"surface"},{label:"Spacefill",value:"spacefill"},{label:"Tube",value:"tube"},{label:"Trace",value:"trace"},{label:"Backbone",value:"backbone"}],N=e=>{for(const t of k)if(t.value===e)return!0;return!1},F=[{label:"By chain id",value:"chainid"},{label:"By residue",value:"resname"},{label:"By element",value:"element"},{label:"B factor",value:"bfactor"},{label:"Electrostatic",value:"electrostatic"},{label:"Secondary structure",value:"sstruc"},{label:"Uniform",value:"uniform"}],M=["red","yellow","blue","green","orange","purple","white","grey","black"],T=e=>{if("custom"===e)return!0;for(const t of F)if(t.value===e)return!0;for(const t of M)if(t===e)return!0;return!1},P=(0,s.memo)((e=>{let{components:t,representations:r,setRepresentations:n}=e;return(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(w.A,{"aria-label":"simple table",size:"small",padding:"checkbox",stickyHeader:!0,children:[(0,_.jsx)(v.A,{children:(0,_.jsxs)(x.A,{children:[(0,_.jsx)(L.A,{children:"Name"}),(0,_.jsx)(L.A,{align:"right",children:"Show"}),(0,_.jsx)(L.A,{align:"right",children:"Selection"}),(0,_.jsx)(L.A,{align:"right",children:"Drawing method"}),(0,_.jsx)(L.A,{align:"right",children:"Coloring method"}),(0,_.jsx)(L.A,{align:"right",children:"Opacity"})]})}),(0,_.jsx)(A.A,{children:r.map(((e,t)=>(0,_.jsxs)(x.A,{children:[(0,_.jsx)(L.A,{component:"th",scope:"row",children:e.name}),(0,_.jsx)(L.A,{align:"right",children:(0,_.jsx)(m.A,{title:"Show/Hide representation",onClick:()=>n((e=>(e[t].show=!e[t].show,[...e]))),color:"primary",children:(0,_.jsx)(y.g,{icon:e.show?j.pS3:j.k6j})})}),(0,_.jsx)(L.A,{align:"right",children:(0,_.jsx)(E.A,{defaultValue:e.selection,variant:"outlined",onKeyPress:e=>{"Enter"===e.key&&n((r=>e.target&&e.target.value?(r[t].selection=e.target.value,[...r]):r))},disabled:!e.custom,size:"small",margin:"dense"})}),(0,_.jsx)(L.A,{align:"right",children:(0,_.jsxs)(R.A,{native:!0,value:e.type,onChange:e=>{let{target:{value:r}}=e;n((e=>(e[t].type=r,[...e])))},children:[!N(e.type)&&(0,_.jsx)("option",{value:e.type,children:e.type}),k.map(((e,t)=>(0,_.jsx)("option",{value:e.value,children:e.label},t)))]})}),(0,_.jsx)(L.A,{align:"right",children:(0,_.jsxs)(R.A,{native:!0,value:e.color,onChange:e=>{let{target:{value:r}}=e;n((e=>(e[t].color=r,[...e])))},children:[!T(e.color)&&(0,_.jsx)("option",{value:e.color,children:e.color}),e.customScheme&&(0,_.jsx)("option",{value:"custom",children:"Custom"}),F.map(((e,t)=>(0,_.jsx)("option",{value:e.value,children:e.label},t))),M.map(((e,t)=>{return(0,_.jsx)("option",{value:e,children:(r=e,r[0].toUpperCase()+r.slice(1))},t);var r}))]})}),(0,_.jsx)(L.A,{align:"right",children:(0,_.jsx)(p.Ay,{value:100*e.opacity,onChange:(e,r)=>{n((e=>(e[t].opacity=r/100,[...e])))},className:S})})]},t)))}),(0,_.jsx)(A.A,{children:(0,_.jsx)(x.A,{children:(0,_.jsx)(L.A,{align:"center",colSpan:6,children:(0,_.jsx)(C.A,{icon:(0,_.jsx)(y.g,{icon:j.OQW}),label:"Add representation",variant:"outlined",onClick:()=>n((e=>[...e,{name:"Custom",show:!0,selection:"None",type:"licorice",color:"chainid",opacity:1,component:t[0]&&t[0].name,custom:!0}]))})})},"addCustom")})]})})}));var U=r(39766);const z="".concat("mdposit","-"),O=(e,t)=>{const r=localStorage.getItem(z+e);return null===r?t:JSON.parse(r)},B=async(e,t)=>(await(0,U._)(1e3),((e,t)=>{localStorage.setItem(z+e,JSON.stringify(t))})(e,t));var I=r(95747),q=r(74199),D=r(89257),G=r(9180),H=r(52153),V=r(35682),W=r(39517),J=r(43573),K=r(26939),Q=r(65001),X=r(29325),Y=r(78219),Z=r(23541),$=r(54776);const ee=Q.xE.builderFactory("custom-namespace")({name:"trajectory-from-custom-data",display:"Trajectory",from:X.O.Root,to:X.O.Molecule.Coordinates,params:{data:Z.t.Value(new Uint8Array,{isHidden:!0}),natoms:Z.t.Value(0,{isHidden:!0})}})({apply(e){let{params:t}=e;return Y.YZ.create("Parse atom coordinates",(async e=>await async function(e,t){if(0===t)throw new Error("Number of atoms is 0");const r=12*t;if(e.byteLength%r!==0)throw new Error("Trajectory data ends abruptly");const n=e.byteLength/r,o=new Float32Array(e),s=[];let a=0;for(let i=0;i<n;i++){const e=new Float32Array(t),r=new Float32Array(t),n=new Float32Array(t);for(let s=0;s<t;s++)e[s]=o[a],r[s]=o[a+1],n[s]=o[a+2],a+=3;s.push({x:e,y:r,z:n,elementCount:t,time:(0,$.gX)(i,"step"),xyzOrdering:{isIdentity:!0}})}const c=$.E$.create(s,(0,$.gX)(1,"step"),(0,$.gX)(0,"step"));return new X.O.Molecule.Coordinates(c,{label:"label"})}(t.data,t.natoms)))}});const te=(e,t,r)=>{if(r)return{range:(r+1).toString(),frames:1};{if(!e)throw new Error("Missing number of frames in the trajectory");if(!t)throw new Error("Missing number of requested frames");const r=Math.floor(e/t),n=Math.ceil(e/r);return{range:"".concat(1,":",e,":").concat(r),frames:n}}};var re=r(29449);const ne="style_container__d6R8E",oe="style_light-theme__l3EaT",se="style_loading-trajectory__ciokb",ae="style_loading-structure__ce+kY",ce="style_tooltip__KXFgY";var ie=r(42594),le=r.n(ie),ue=r(22363),me=r.n(ue),de=r(74080);const fe=(0,H.w)();fe.layout={initial:{isExpanded:!1,controlsDisplay:"reactive",showControls:!1}},fe.components={controls:{top:"none",bottom:"none",left:"none",remoteState:"none"}};const pe=25,he=(0,q.A)(/\?frames=(\d+):(\d+)(:(\d+))?/,{start:1,end:2,step:4});const ge={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},ye=(0,s.memo)((0,s.forwardRef)(((e,t)=>{let{className:r,playing:n,spinning:o,smooth:a,onProgress:i,onLoad:l,bounce:u=!1,requestedFramesNumber:m=pe,selectedAtoms:d,selectedResidueIndices:f,selectedChains:p,selectedCustom:h,selectedDistances:g,selectedAngles:y,selectedRepresentation:b,snapRepresentations:j,noTrajectory:w,initialFocus:v,darkBackground:x,perspective:L,speed:A,drawingMethods:E,coloringMethods:R,opacities:C,components:S,showRepresentations:k,nglSelections:N,highlightTypes:F=ge}=e;const M=(0,s.useMemo)((()=>S),[S]),{accession:T,accessionAndMdNumber:P,fileDescriptors:z,curatedOrientation:O,topology:B}=(0,s.useContext)(re.f),{file:q}=(0,s.useContext)(re.I),[H,Q]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(v);(0,s.useMemo)((()=>{Y(v)}),[v]);const Z=(0,s.useRef)(null),$=(0,s.useRef)(null),ie=(0,s.useRef)(null),ue=(0,s.useRef)(null),ye=(0,s.useRef)(null),[be,je]=((0,s.useRef)(!0),(0,D.Wx)()),[we,ve]=(0,s.useState)(null),xe=(0,s.useRef)([]),[Le,Ae]=(0,s.useState)([]),[Ee,Re]=(0,s.useState)(!1);(0,s.useMemo)((()=>{Ae((e=>{const t=[];return M.forEach((r=>{const n=r.topologyURL||null;[...e,...t].find((e=>e.url===n))||(null===n?t.push({url:"".concat(I.nP,"/").concat(P,"/files/").concat(I.i3),loading:!0,requested:!1,error:null}):(t.push({url:n,loading:!0,requested:!1,error:null}),Re(!0)))})),[...e,...t]}))}),[M,Ae,T]);const[Ce,Se]=(0,s.useState)([]);(0,s.useEffect)((()=>{Le.forEach(((e,t)=>{if(!e.file&&!e.error&&!e.requested)if(null===e.url)Se((t=>{e.loading=!1;const r=Le.some((e=>e.loading));Re(r);return[...t,{url:null,file:q}]}));else{e.requested=!0;const t="https"===e.url.substring(0,5)?le().get:me().get;let r="";const n=t(de.parse(e.url),(t=>{t.on("data",(e=>{r+=e})).on("end",(()=>{Se((t=>{e.loading=!1;const n=Le.some((e=>e.loading));Re(n);return[...t,{url:e.url,file:r}]}))})).on("error",(t=>{e.loading=!1;const r=Le.some((e=>e.loading));Re(r),e.error=t}))}));xe.current.push(n)}}))}),[Le,q]);(0,s.useMemo)((()=>{const e=M[0],t=Ce.find((t=>t.url===e.topologyURL)),{file:r}=t||{loading:!1,file:q};return r}),[M,Ce,q]);const[_e,ke]=(0,s.useState)([]),[Ne,Fe]=(0,s.useState)(!1);(0,s.useMemo)((()=>{const{loading:e,payload:t,error:r}=z;if(!e){if(r)throw r;if(!t)throw new Error("Something bad happened with file descriptors");ke((e=>{const r=[],n="".concat(I.nP,"/").concat(P,"/files/trajectory");return M.forEach(((o,s)=>{if(o.onlyTopology)return;const a=0===s,c=o.frame;let i=o.trajectoryURLs||[n];o.frameCount=0,i.forEach(((n,s)=>{const i=(e=>{const t=he.exec(e);if(!t)return null;const r=+t.groups.start,n=Math.max(+t.groups.end,r),o=+(t.groups.step||1);return{start:r,end:n,step:o,frames:Math.floor((n-r)/o)+1}})(n);let l=n.split("/").slice(-1)[0];i&&(l=l.split("?frames=")[0]),"trajectory"===l&&(l="trajectory.bin");const u=t.find((e=>e.filename===l));if(!u)throw new Error('Trajectory "'.concat(l,'" is missing'));const d=u.metadata,f=d.frames;let p=m;if(m>f&&(p=f),Number.isFinite(c))p=1;else if(i)p=i.frames;else if(!a&&f>1)throw new Error("Only the main component is allowed to load multiple frames");let h,g=n;if(i){const e=Math.min(f,i.end);h=Math.ceil(e/i.step)}else{const{range:e,frames:t}=te(f,p,c);h=t,e&&(g=n+"?frames=".concat(e))}o.framedURLs||(o.framedURLs=[]),o.framedURLs[s]=g,o.frameCount+=p;e.find((e=>e.url===g))||(r.push({url:g,frames:h,atoms:d.atoms,loading:!0,requested:!1}),Fe(!0))}))})),r.length>0?[...e,...r]:e}))}}),[T,M,z,m]);const[Me,Te]=(0,s.useState)([]),Pe=(0,s.useCallback)((()=>{const e=M[0],t=[];let r=[];if(Te((e=>(r=e,e))),e.framedURLs.forEach((e=>{const n=r.find((t=>t.url===e));n&&t.push(n)})),0===t.length)return;const n=t.map((e=>e.frames)).reduce(((e,t)=>e+t),0),o=t.map((e=>e.progress*e.frames)).reduce(((e,t)=>e+t),0)/n;l(o)}),[M,Te,l]);(0,s.useEffect)((()=>{_e.forEach((e=>{if(e&&e.requested)return;e.requested=!0,e.loading=!0,e.progress=0;const t=("https"===e.url.substring(0,5)?le().get:me().get)(de.parse(e.url),(t=>{const r=t.headers["content-length"];Te((t=>[...t,{url:e.url,frames:e.frames,atoms:e.atoms,payload:new ArrayBuffer(0),progress:0}]));let n=0;t.on("data",(t=>{n+=t.byteLength,e.progress=n/r,Te((r=>{const n=r.find((t=>t.url===e.url));return n.payload=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}(n.payload,t),n.progress=e.progress,[...r]})),Pe()})).on("end",(()=>{e.loading=!1;const t=_e.some((e=>e.loading));Fe(t)}))}));xe.current.push(t)}))}),[_e,Pe]),(0,s.useEffect)((()=>{const e=xe.current;return()=>{e.forEach((e=>{e.abort()}))}}),[]),(0,s.useEffect)((()=>((async()=>{$.current=await(0,G.y)(Z.current,fe)})(),()=>{$.current&&($.current.dispose(),$.current=null)})),[]),(0,s.useEffect)((()=>{if(Ee)return;const e=$.current;e&&Ce.forEach((async t=>{const r=await e.builders.data.rawData({data:t.file},{state:{isGhost:!0}}),n=await e.builders.structure.parseTrajectory(r,"pdb"),o=await e.builders.structure.createModel(n);e.modelRef=o.ref}))}),[Ee,Ce]),(0,s.useEffect)((()=>{const e=$.current;if(!e)return;if(w)return;(async()=>{if(!Ce||!Me||0===Me.length)return;if(!e||!e.modelRef)return;const t=Me[0];let r,n=0;if(r=t.atoms,r!==t.atoms)throw new Error("Atoms number in the different trajectories do not match");n+=t.frames;const o=t.payload,s=12*r,a=Math.floor(o.byteLength/s)*s,c=o.slice(0,a);if(0===c.byteLength)return;const i=c.byteLength/s;if(!(i===n))return;const l=await e.build().toRoot().apply(ee,{data:c,natoms:t.atoms}).commit(),u=e.managers.structure.hierarchy.current.trajectories,m=await e.build().toRoot().apply(V.TrajectoryFromModelAndCoordinates,{modelRef:e.modelRef,coordinatesRef:l.ref},{dependsOn:[e.modelRef,l.ref]}).commit(),d=await e.builders.structure.createModel(m),f=await e.builders.structure.createStructure(d),p=e.build().to(f),h=(0,J.pQ)(e,void 0,{type:"cartoon",typeParams:{quality:"lower",ignoreHydrogens:"all",ignoreHydrogensVariant:"all",ignoreLight:!0}});p.apply(K.f.Representation.StructureRepresentation3D,h),await p.commit(),u.length})()}),[Ce,Me,M,w]),(0,s.useEffect)((()=>{const e=$.current;e&&(w||(n&&je?e.managers.animation.play(W.d,{duration:{name:"sequential",params:{maxFps:10}},mode:{name:"loop",params:{direction:"forward"}}}):e.managers.animation.stop()))}),[n,je,w,u]);const Ue=(0,s.useCallback)((async()=>{if(!ue.current)return;const e=ie.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,U.yy)(0),ue.current.handleResize()}),[]);(0,s.useEffect)((()=>(window.addEventListener("resize",Ue),()=>{window.removeEventListener("resize",Ue)})),[Ue]),(0,s.useImperativeHandle)(t,(()=>({autoResize:Ue,displayFocus(){const e=ue.current.viewerControls.getOrientation(),t="[".concat(e.elements.toString(),"]");console.log(t)},centerFocus(){Y({comp:0,sele:"all"})},get currentFrame(){if(!H||!_e.length)return-1;try{return ue.current.compList[0].trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(H&&_e.length)try{const t=this.totalFrames;let r=e;r<0&&(r=0),r>=t&&(r=t-1),ue.current.compList[0].trajList[0].trajectory.setFrame(r)}catch(t){}},get totalFrames(){if(!H||!_e.length)return 1;try{return ue.current.compList[0].trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return ue.current.compList[0].trajList[0].expectedFrames}catch(e){return 1}}})),[H,_e,Ue]);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{ref:e=>{be(e),Z.current=e},className:c()(r,ne,{[ae]:Ee,[se]:!w&&Ne,[oe]:!x}),"data-loading":void 0}),(0,_.jsx)("div",{ref:ye,className:ce,children:we})]})}))),be=ye;var je=r(45180),we=r(82746);const ve=(e,t,r)=>{const n=new Float32Array(e);try{const e=[];for(let o=0;o<r;o++){const r=new Float32Array(3*t);r.set(n.subarray(o*t*3,(o+1)*t*3)),e.push(r)}return e}catch(o){return null}},xe=(e,t,r,n,o)=>{const s=new Float32Array(r),a=s.length/3/o;if(a!==n)throw console.log("Number of coordinates: "+s.length),console.log("Number of frames: "+o),console.log("Expected number of atoms: "+a),console.log("Actual number of atoms: "+n),new Error("Trajectory atom number is wrong");try{const r=[];for(let a=0;a<o;a++){const o=new Float32Array(3*e);let c=0;for(let r=0;r<e;r++)-1!==t.indexOf(r)&&(o[3*r]=s[a*n*3+3*c],o[3*r+1]=s[a*n*3+3*c+1],o[3*r+2]=s[a*n*3+3*c+2],c++);r.push(o)}return r}catch(c){return null}},Le=(e,t,r,n)=>{const o=new Float32Array(t);if(o.length/3/n!==r)throw new Error("Trajectory atom number is wrong");let s="",a=0,c=0;for(let l=0;l<e.atomCount&&!(0>=r);l++)"C"!==e.getAtomProxy(l).atomname&&"CA"!==e.getAtomProxy(l).atomname&&"N"!==e.getAtomProxy(l).atomname||(a+=1),"H"!==e.getAtomProxy(l).element&&(c+=1);r===a?s="backbone":r===c?s="heavy":console.error("Number of atoms does not match any defined atoms selection\n      Number of atoms: ".concat(r,"\n      Expected backbone atoms: ").concat(a,"\n      Expected heavy atoms: ").concat(c));try{const t=[];for(let a=0;a<n;a++){const n=new Float32Array(3*e.atomCount);let c=0;if("backbone"===s)for(let t=0;t<e.atomCount&&!(c>=r);t++)"C"!==e.getAtomProxy(t).atomname&&"CA"!==e.getAtomProxy(t).atomname&&"N"!==e.getAtomProxy(t).atomname||(n[3*t]=o[a*r*3+3*c],n[3*t+1]=o[a*r*3+3*c+1],n[3*t+2]=o[a*r*3+3*c+2],c++);if("heavy"===s)for(let t=0;t<e.atomCount&&!(c>=r);t++)"H"!==e.getAtomProxy(t).element&&(n[3*t]=o[a*r*3+3*c],n[3*t+1]=o[a*r*3+3*c+1],n[3*t+2]=o[a*r*3+3*c+2],c++);t.push(n)}return t}catch(i){return null}},Ae=(e,t,r)=>{if(r)return{range:(r+1).toString(),frames:1};{if(!e)throw new Error("Missing number of frames in the trajectory");if(!t)throw new Error("Missing number of requested frames");const r=Math.floor(e/t),n=Math.ceil(e/r);return{range:"".concat(1,":",e,":").concat(r),frames:n}}};var Ee=r(13232);const Re="style_container__7Ceta",Ce="style_light-theme__H4DPh",Se="style_loading-trajectory__2DP4d",_e="style_loading-structure__E1dyl",ke="style_tooltip__eJTpx";var Ne=r(93010);const Fe=25,Me=750,Te="polymer and not hydrogen ",Pe=(0,q.A)(/\?frames=(\d+):(\d+)(:(\d+))?/,{start:1,end:2,step:4});function Ue(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}const ze=e=>1e3+-9.5*(e-0),Oe={atoms:"spacefill",residues:"ball+stick",chains:"ball+stick",selections:"ball+stick"},Be=(0,s.memo)((0,s.forwardRef)(((e,t)=>{let{className:r,playing:o,spinning:a,smooth:i,onProgress:l,onLoad:u,bounce:m=!1,requestedFramesNumber:d=Fe,selectedAtoms:f,selectedResidueIndices:p,selectedChains:h,selectedCustom:g,selectedDistances:y,selectedAngles:b,selectedRepresentation:j,snapRepresentations:w,noTrajectory:v,initialFocus:x,darkBackground:L,perspective:A,speed:E,components:R,representations:C,highlightTypes:S=Oe}=e;const{accession:k,accessionAndMdNumber:N,fileDescriptors:F,curatedOrientation:M,topology:T}=(0,s.useContext)(re.f),{file:P}=(0,s.useContext)(re.I),[z,O]=(0,s.useState)(!1),[B,q]=(0,s.useState)(!1),[G,H]=(0,s.useState)(x);(0,s.useEffect)((()=>{H(x)}),[x]);const V=(0,s.useRef)(null),W=(0,s.useRef)(null),J=(0,s.useRef)(null),K=(0,s.useRef)(!0),Q=(0,s.useRef)(M?(new we.Matrix4).set(...M):null),[X,Y]=(0,D.Wx)(),[Z,$]=(0,s.useState)(null),[ee,te]=(0,s.useState)([]),[ne,oe]=(0,s.useState)(!1);(0,s.useMemo)((()=>{R&&te((e=>{const t=[];return R.forEach((r=>{const n=r.topologyURL||null,o=r.atomSelection||null;[...e,...t].find((e=>e.url===n))||(null===n?t.push({url:null,loading:!1,error:null}):(t.push({url:n,selection:o,loading:!0,requested:!1,error:null}),oe(!0)))})),[...e,...t]}))}),[R,te]);const[se,ae]=(0,s.useState)([]),ce=(0,s.useRef)([]);(0,s.useEffect)((()=>{ee.forEach((e=>{if(e.file)return;if(e.error)return;if(e.requested)return;const t=e.url;if(null===t)ae((t=>{e.loading=!1;const r=ee.some((e=>e.loading));oe(r);return[...t,{url:null,file:P}]}));else{e.requested=!0;const r=JSON.stringify({selection:e.selection}),n="https"===t.substring(0,5)?le():me(),o=(0,de.parse)(t),s=o.path.endsWith("/structure");o.method=s?"POST":"GET",o.headers={"Content-Type":"application/json","Content-Length":r.length};const a=n.request(o,(r=>{let n=new ArrayBuffer(0);r.on("data",(e=>{n=Ue(n,e)})).on("end",(()=>{const r=new Blob([n],{type:"text/plain"});(0,we.autoLoad)(r,{defaultRepresentation:!1,ext:"pdb"}).then((r=>{ae((n=>{e.loading=!1;const o=ee.some((e=>e.loading));oe(o);return[...n,{url:t,file:r}]}))})).catch((t=>{e.loading=!1;const r=ee.some((e=>e.loading));oe(r),e.error=t}))}))}));"POST"===o.method&&a.write(r),a.end(),ce.current.push(a)}}))}),[ee,P]);const ie=R&&R[0]||{},ue=se.find((e=>e.url===ie.topologyURL)),{file:fe}=ue||{loading:!1,file:P},[pe,he]=(0,s.useState)([]),[ge,ye]=(0,s.useState)(!1);(0,s.useMemo)((()=>{if(!R)return;const{loading:e,payload:t,error:r}=F;if(!e){if(r)throw r;if(!t)throw new Error("Something bad happened with file descriptors");he((e=>{const r=[],n="".concat(I.nP,"/").concat(N,"/files/trajectory");return R.forEach(((o,s)=>{if(o.onlyTopology)return;const a=0===s,c=o.frame;let i=o.trajectoryURLs||[n];o.frameCount=0,i.forEach(((n,s)=>{const i=(e=>{const t=Pe.exec(e);if(!t)return null;const r=+t.groups.start,n=Math.max(+t.groups.end,r),o=+(t.groups.step||1);return{start:r,end:n,step:o,frames:Math.floor((n-r)/o)+1}})(n);let l=n.split("/").slice(-1)[0];i&&(l=l.split("?frames=")[0]),"trajectory"===l&&(l="trajectory.bin");const u=t.find((e=>e.filename===l));if(!u)throw new Error('Trajectory "'.concat(l,'" is missing'));const m=u.metadata,f=m.frames;let p=d;if(d>f&&(p=f),Number.isFinite(c))p=1;else if(i)p=i.frames;else if(!a&&f>1)throw new Error("Only the main component is allowed to load multiple frames");let h,g=n;if(i){const e=Math.min(f,i.end);h=Math.ceil(e/i.step)}else{const{range:e,frames:t}=Ae(f,p,c);h=t,e&&(g=n+"?frames=".concat(e))}o.framedURLs||(o.framedURLs=[]),o.framedURLs[s]=g,o.frameCount+=p;e.find((e=>e.url===g))||(r.push({url:g,frames:h,atoms:m.atoms,loading:!0,requested:!1}),ye(!0))}))})),r.length>0?[...e,...r]:e}))}}),[k,R,F,d]);const[be,Be]=(0,s.useState)([]),Ie=(0,s.useCallback)((e=>{if(!R)return;const t=R[0],r=[];if(t.framedURLs.forEach((t=>{const n=e.find((e=>e.url===t));n&&r.push(n)})),0===r.length)return;const n=r.map((e=>e.frames)).reduce(((e,t)=>e+t),0),o=r.map((e=>e.progress*e.frames)).reduce(((e,t)=>e+t),0)/n;u(o)}),[R,u]);(0,s.useEffect)((()=>{pe.forEach((e=>{if(e&&e.requested)return;e.requested=!0,e.loading=!0,e.progress=0;const t=JSON.stringify({}),r="https"===e.url.substring(0,5)?le():me(),n=(0,de.parse)(e.url),o=n.pathname.split("/"),s="trajectory"===o[o.length-1];n.method=s?"POST":"GET",n.headers={"Content-Type":"application/json","Content-Length":t.length};const a=r.request(n,(t=>{const r=t.headers["content-length"];Be((t=>[...t,{url:e.url,frames:e.frames,atoms:e.atoms,payload:new ArrayBuffer(0),progress:0}]));let n=0;t.on("data",(t=>{n+=t.byteLength,e.progress=n/r,Be((r=>{const n=r.find((t=>t.url===e.url));return n.payload=Ue(n.payload,t),n.progress=e.progress,Ie(r),[...r]}))})).on("end",(()=>{e.loading=!1;const t=pe.some((e=>e.loading));ye(t)}))}));"POST"===n.method&&a.write(t),a.end(),ce.current.push(a)}))}),[pe,Ie]),(0,s.useEffect)((()=>{const e=ce.current;return()=>{e.forEach((e=>{e.abort()}))}}),[]);const[qe,De]=(0,s.useState)(0),Ge=(0,s.useCallback)((e=>{De((t=>t+e))}),[De]);(0,s.useEffect)((()=>{const e=new we.Stage(V.current);return(0,U.Gt)().then((()=>{e&&e.handleResize()})),e.tasks.signals.countChanged.add(Ge),W.current=e,()=>{W.current.dispose(),W.current=null}}),[]);const He=(0,s.useMemo)((()=>z?fe?pe.length||v?qe>0?"Rendering...":void 0:"No trajectory available":"No structure available":"Loading structure"),[z,fe,pe,v,qe]);(0,s.useEffect)((()=>{const e=Date.now();let t=1e3;return K.current&&(t=0,K.current=!1),(async()=>{for(;;){if(await(0,U.Gt)(),!W.current)return;let r=Date.now()-e;if(r>t)break;L&&(r=t-r);const n="#".concat(Math.round(255*r/t).toString("16").padStart(2,"0").repeat(3));W.current.viewer.setBackground(n)}await(0,U.Gt)(),W.current&&W.current.viewer.setBackground(L?"black":"white")})(),()=>t=0}),[L]),(0,s.useEffect)((()=>{W.current&&W.current.viewer&&W.current.viewer.setCamera&&W.current.viewer.setCamera(A?"perspective":"orthographic")}),[A]),(0,s.useEffect)((()=>{if(!l||v||!z||!B)return;const e=W.current&&W.current.compList&&W.current.compList[0];if(!e)throw new Error("Something went wrong with the viewer first component");const t=e.trajList&&e.trajList[0];if(!t)throw new Error("Something went wrong with the viewer trajectory handler");const r=t.expectedFrames,n=e=>{const t=(0,je.A)(e/(r-1),0,1);l(t)};return t.signals.frameChanged.add(n),()=>{t.signals.frameChanged.remove(n)}}),[z,B,v,l]);const Ve=(0,s.useCallback)((async()=>{if(!W.current)return;const e=V.current.querySelector("canvas");e&&(e.style.height="",e.style.cursor="default"),await(0,U.yy)(0),W.current.handleResize()}),[]);(0,s.useEffect)((()=>(window.addEventListener("resize",Ve),()=>{window.removeEventListener("resize",Ve)})),[Ve]),(0,s.useEffect)((()=>{fe&&R&&C&&(fe.atomStore.occupancy=new Array(fe.atomStore.occupancy.length).fill(1),ne||R.forEach(((e,t)=>{let r=W.current.compList[t];if(!r){const n=e.topologyURL||null,o=se.find((e=>e.url===n));if(!o)return;if(o.error)throw new Error("Topology from '".concat(n,"' returned error ").concat(o.error));if(!o.file)throw new Error("Topology data from '".concat(n,"' is missing"));const s=(0,Ne.A)(o.file);if(W.current.addComponentFromObject(s),r=W.current.compList[t],!r)return;r.onlyTopology=e.onlyTopology,O(!0)}const o=C.filter((t=>t.component===e.name)),s=[];o.forEach(((e,o)=>{const a=o+"-"+e.name;s.push(a);const c=e.show,i=e.selection,l=e.type,u=e.color,m=c?e.opacity:0,d=e.customScheme,f=e.name===j?we.ColormakerRegistry.addSelectionScheme([["yellow","all"]],"custom label"):d&&"custom"===u?d:(e=>{var t=(new Option).style;return t.color=e,t.color===e})(u)?we.ColormakerRegistry.addSelectionScheme([[u,"all"]],"custom label"):u,p="surface"===l?[-200,200]:void 0,h="surface"===l?"av":void 0,g=!("surface"===l&&m<1),y=(0,n.A)({sele:i,name:a,opacity:m,colorScheme:f,colorDomain:p,surfaceType:h,side:"front",depthWrite:g},e.other),b=r.reprList.find((e=>e.name===a));if(b){const e=b.repr.type,t=b.repr.selection.string;e!==l||t!==i||"trace"===e?(r.removeRepresentation(b),r.addRepresentation(l,y)):b.setParameters(y)}else r.addRepresentation(l,y);if(e.label){const t=e.label+"-"+a,n=r.annotationList.find((e=>e.name===t));if(c)if(n)n.element.label=e.label;else{var w=document.createElement("div");w.innerText=e.label,w.style.color="#76FF03",w.style.backgroundColor="#607D8B",w.style.padding="8px";const n=r.reprList[o].repr.structureView.center;r.addAnnotation(n,w).name=t}else n&&r.removeAnnotation(n)}e.name===j&&H({comp:t,sele:e.selection})}));[...r.reprList].forEach((e=>{const t=e.name;if("*"!==t.charAt(0)){for(const e of s)if(t===e)return;r.removeRepresentation(e)}})),H((e=>e||{comp:0,sele:"all"}))})))}),[fe,R,C,ne,se,j]),(0,s.useEffect)((()=>{if(!T)return;if(!z||!f)return;const e="*highlightedAtoms",t=W.current.compList[0].reprList.find((t=>t.name===e));t&&W.current.compList[0].removeRepresentation(t);const r="*highlightedAtomResidues",n=W.current.compList[0].reprList.find((e=>e.name===r));n&&W.current.compList[0].removeRepresentation(n);const o=Array.from(f);if(!o.length)return;const s="@".concat(o.map((e=>e)).join(","));W.current.compList[0].addRepresentation(S.atoms,{sele:s,opacity:.5,scale:1.5,name:e});const a=Array.from(new Set(o.map((e=>"@"+T.getAtomByIndex(e).residue.atomIndices.join(","))))).join(" or ");W.current.compList[0].addRepresentation(S.residues,{sele:a,name:r}),H({comp:0,sele:a})}),[z,T,f,L,S]),(0,s.useEffect)((()=>{if(!T||!z||!p)return;const e="*highlightedResidues",t=W.current.compList[0].reprList.find((t=>t.name===e));if(t&&W.current.compList[0].removeRepresentation(t),0===p.length)return;const r=p.map((e=>T.getResidueByIndex(e).nglSelection)),n=Array.from(new Set(r)).join(" or ");W.current.compList[0].addRepresentation(S.residues,{sele:n,name:e}),H({comp:0,sele:n})}),[z,p,T,S]),(0,s.useEffect)((()=>{if(!z||!h)return;const e="*highlightedChains",t=W.current.compList[0].reprList.find((t=>t.name===e));t&&W.current.compList[0].removeRepresentation(t);const r=h.map((e=>":"+e));if(!r.length)return;const n=Array.from(new Set(r)).join(" or ");W.current.compList[0].addRepresentation(S.chains,{sele:n,name:e}),H({comp:0,sele:n})}),[z,h,S]),(0,s.useEffect)((()=>{if(!z||!w)return;const e=W.current.compList[0],t=e.reprList;return w.forEach((t=>{e.addRepresentation(t.type,{sele:t.selection,name:t.name,color:t.color,opacity:t.opacity})})),()=>{w.forEach((r=>{const n=t.find((e=>e.name===r.name));n&&e.removeRepresentation(n)}))}}),[z,w]),(0,s.useEffect)((()=>{if(!z||!g)return;const e="*highlightedCustom",t=W.current.compList[0].reprList.find((t=>t.name===e));if(t&&W.current.compList[0].removeRepresentation(t),!g.length)return;const r=Array.from(new Set(g)).join(" or ");W.current.compList[0].addRepresentation(S.selections,{sele:r,name:e}),H({comp:0,sele:r})}),[z,g,S]),(0,s.useEffect)((()=>{if(!z||!y)return;const e="*distance",t=W.current.compList[0].reprList.find((t=>t.name===e));t&&W.current.compList[0].removeRepresentation(t),W.current.compList[0].addRepresentation("distance",{atomPair:y,color:"skyblue",labelUnit:"angstrom",name:e,labelColor:L?16777215:1})}),[z,y,L]),(0,s.useEffect)((()=>{if(!z||!b)return;const e="*angles",t=W.current.compList[0].reprList.find((t=>t.name===e));t&&W.current.compList[0].removeRepresentation(t),W.current.compList[0].addRepresentation("angle",{atomTriple:b,name:e,labelColor:L?16777215:1})}),[z,b,L]);const[We,Je]=(0,s.useState)(null);(0,s.useEffect)((()=>{0!==se.length&&0!==be.length&&R&&R.forEach(((e,t)=>{const r=e.topologyURL||null,n=se.find((e=>e.url===r));if(!n)return;const s=W.current.compList[t];if(!s)return;if(s.onlyTopology)return;const a=[];let c,i="",l="",u=0;for(const o of e.framedURLs){const e=be.find((e=>e.url===o));if(!e)return;if(c||(c=e.atoms),c!==e.atoms)throw new Error("Atoms number in the different trajectories do not match");u+=e.frames;const t=e.payload,r=12*c,n=Math.floor(t.byteLength/r)*r,s=t.slice(0,n);a.push(s),i+=o,l+="/"+e.progress}const m=s.combinedURL===i;if(m||s.trajList.forEach(s.removeTrajectory.bind(s)),m&&s.combinedProgress===l)return;let d;if(s.combinedURL=i,s.combinedProgress=l,d=1===a.length?a[0]:a.reduce(((e,t)=>Ue(e,t))),0===d.byteLength)return;const f=12*c,p=d.byteLength/f,h=p-1,g=p===u,y=e.trajectoryAtomIndices,b=s.trajList;if(b.length>0){if(b.length>1)throw new Error("Multiple trajectories in one component");const e=b[0],r=e.trajectory;if(((e,t,r,n,o,s)=>{if(!(e&&t&&r))return;const a=e.frames.length;if(a>=o)return;const c=a*n*12,i=r.slice(c),l=o-a;let u;if(u=n===t.atomCount?ve(i,n,l):s?xe(t.atomCount,s,i,n,l):Le(t,i,n,l),!u)throw new Error("Topology and trajectory data may not match");e.frames=e.frames.concat(u)})(r,n.file,d,c,p,y),r._frameCount=p,0===t){e.expectedFrames=u;const t=r.player,n=ze(E);if(t.setParameters({end:h,interpolateStep:100/u,mode:g?"loop":"once",timeout:n}),!v&&o&&!t.isRunning){r._currentFrame<h&&t.play()}}}else{const e=((e,t,r,n,o)=>{if(!e||!t)return;let s;if(s=r===e.atomCount?ve(t,r,n):o?xe(e.atomCount,o,t,r,n):Le(e,t,r,n),!s)throw new Error("Topology and trajectory data may not match");const a=new we.Frames("Dynamically generated trajectory","");return a.coordinates=s,a})(n.file,d,c,p,y);if(!e)return;const r=s.addTrajectory(e),o=r.trajectory;if(0===t){r.expectedFrames=u;const e=ze(E);o.player.setParameters({interpolateStep:100/u,mode:g?"loop":"once",timeout:e}),Je(r),q(!0)}o.setFrame(0)}}))}),[se,be,R,v,Je,d,o,E]),(0,s.useEffect)((()=>{if(!We)return;const e=We.trajectory,t=()=>{const t=e._currentFrame;e.setFrame(t)};return e.player.signals.haltedRunning.add(t),()=>{e.player.signals.haltedRunning.remove(t)}}),[We]),(0,s.useEffect)((()=>{if(!z||!B)return;const e=W.current&&W.current.compList[0]&&W.current.compList[0].trajList[0];if(!e)throw new Error("Something is wrong with NGL");const{player:t}=W.current.compList[0].trajList[0].trajectory;return t.setParameters({interpolateStep:100/e.trajectory.frameCount,direction:m?"bounce":"forward"}),v?t.pause():t[o&&Y?"play":"pause"](),()=>t.pause()}),[z,B,o,Y,v,m]),(0,s.useEffect)((()=>{if(!z)return;const e=W.current.compList[0].trajList[0];if(!e)return;const t=ze(E);e.trajectory.player.setParameters({timeout:t})}),[z,E]),(0,s.useEffect)((()=>{W.current&&W.current.spinAnimation&&a===W.current.spinAnimation.paused&&W.current.toggleSpin()}),[a]),(0,s.useEffect)((()=>{z&&B&&(W.current.compList[0].trajList[0].trajectory.player.parameters.interpolateType=i?"linear":"")}),[z,B,i]),(0,s.useEffect)((()=>{if(z&&pe.length)return Ve(),Ve.cancel}),[z,pe,Ve]),(0,s.useEffect)((()=>{if(!T)return;const e=e=>{let{detail:t}=e;if(!t||"click"!==t.eventtype&&"reset"!==t.eventtype)return;let r="";for(const a of document.querySelectorAll("protvista-manager")){const e=a.attributeValues.get("highlight"),t=a.attributes.chain.value;if(!e)continue;const[n,o]=e.split(":"),s=T.getResidueByParameters(t,+n),c=T.getResidueByParameters(t,+o);if(s.chainName!==c.chainName)throw new Error("Range from multiple chains is not supported");r+=" or :".concat(s.chainName," and ").concat(s.number,"-").concat(c.number)}r=r.substr(4);const n=W.current.compList[0],o=n&&n.reprList.find((e=>"structure"===e.name));if(o&&n.removeRepresentation(o),!r)return n.addRepresentation("cartoon",{sele:Te,name:"structure",opacity:1}),void(Q.current&&W.current.animationControls.orient(Q.current,Me));const s=we.ColormakerRegistry.addSelectionScheme([["yellow",r],["white","*"]],"custom label");n.addRepresentation("cartoon",{sele:Te,name:"structure",opacity:1,color:s}),n.autoView(r,Me)};return window.addEventListener("change",e),()=>window.removeEventListener("change",e)}),[T]),(0,s.useEffect)((()=>{if(!T)return;const e=J.current;V.current.appendChild(e),W.current.mouseControls.remove("hoverPick");const t=e=>{const t=T.getResidueByIndex(e.residueIndex),r=t.chain.metadataChainName,n=t.referenceId;return(0,_.jsxs)(_.Fragment,{children:["Atom ".concat(e.index," (").concat(e.atomname,")\n                Chain ").concat(t.chainName," ").concat(r?"("+r+")":"","\n                Residue ").concat(t.number," (").concat(e.resname,")"),(()=>{if(n)return"noref"===n?(0,_.jsx)("div",{style:{color:"orange"},children:"No referable"}):"notfound"===n?(0,_.jsx)("div",{style:{color:"salmon"},children:"Reference not found"}):(0,_.jsxs)("div",{children:[(0,_.jsx)("div",{style:{color:"lightGreen"},children:t.referenceName}),"protein"===t.referenceType&&(0,_.jsx)("div",{children:"- Residue ".concat(t.referenceNumber)})]})})()]})};let r;const n=()=>{clearTimeout(r),e.style.display="none"};return W.current.signals.hovered.add((function(o){o?(n(),r=setTimeout((()=>{let r;const n=o.bond,s=o.atom;if(n){const e=n.atom1,o=n.atom2;r=(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{children:"Bond ".concat(e.index," - ").concat(o.index)}),(0,_.jsx)("hr",{style:{color:"lightGrey"}}),t(e),(0,_.jsx)("hr",{style:{color:"lightGrey"}}),t(o)]})}else s&&(r=t(s));$(r),e.style.display="block";const{x:a,y:c}=(0,Ee.L)(V.current,e,o.mouse.position,3);e.style.top=c+"px",e.style.left=a+"px"}),400)):n()})),V.current.addEventListener("mouseleave",n,!1),()=>{e.remove(),V.current.removeEventListener("mouseleave",n)}}),[T,$]);const Ke=(0,s.useRef)(!0);(0,s.useEffect)((()=>{if(!G)return;const e=W.current.compList[G.comp];if(!e)return;let t=Me;Ke.current&&(t=0,Q.current&&W.current.animationControls.orient(Q.current,0),Ke.current=!1),e.autoView(G.sele,t)}),[z,G]),(0,s.useImperativeHandle)(t,(()=>({autoResize:Ve,displayFocus(){const e=W.current.viewerControls.getOrientation(),t="[".concat(e.elements.toString(),"]");console.log(t)},centerFocus(){H({comp:0,sele:"all"}),Q.current&&W.current.animationControls.orient(Q.current,Me)},get currentFrame(){if(!z||!pe.length)return-1;try{return W.current.compList[0].trajList[0].trajectory.currentFrame}catch(e){return-1}},set currentFrame(e){if(z&&pe.length)try{const t=this.totalFrames;let r=e;r<0&&(r=0),r>=t&&(r=t-1),W.current.compList[0].trajList[0].trajectory.setFrame(r)}catch(t){}},get totalFrames(){if(!z||!pe.length)return 1;try{return W.current.compList[0].trajList[0].trajectory.frames.length}catch(e){return 1}},get totalExpectedFrames(){try{return W.current.compList[0].trajList[0].expectedFrames}catch(e){return 1}}})),[z,pe,Ve]);return(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("div",{ref:e=>{e&&(X(e),V.current=e)},className:c()(r,Re,{[_e]:!z,[Se]:!v&&ge,[Ce]:!L}),"data-loading":He,children:(0,_.jsx)("div",{ref:J,className:ke,children:Z})})})})));var Ie=r(10419),qe=r(92954);const De=Symbol("low"),Ge=Symbol("medium"),He=Symbol("high"),Ve=()=>{if(!navigator||!navigator.connection)return Ge;const{effectiveType:e,saveData:t}=navigator.connection;if(!0===t)return De;if(!e)return Ge;switch(e){case"slow-2g":case"2g":return De;case"3g":return Ge;default:return He}};var We=r(17604);const Je="style_background-toggle__aAj32",Ke="style_dark__e5mDQ",Qe="style_adapter__+rjEA",Xe="style_ngl-with-settings__k93CW",Ye="style_ngl-without-settings__qTooi",Ze="style_settings-left__Wvi5a",$e="style_settings-controls__kLLNo",et="style_ngl-alone__5TmnB",tt="style_stacked-icons__OoF+a",rt="style_extra-top-margin__vaEmm",nt="style_settings-right__NDIcU",ot="style_hidden__D+3lX",st="style_fullscreen-toggle__f4Bk2",at="style_is-fullscreen__RtQvN",ct="style_settings__87jIw",it="style_fullscreen-target__VO3Yh",lt="style_progress__LNzos",ut="style_controls__0ugFi",mt="style_flip-container__dGHQ+",dt="style_flip-card-container__wgyMe",ft="style_flipped__DhDpU",pt="style_flip-card__g+agx",ht="style_front__g9FOf",gt="style_back__UfiiZ",yt=["startingComponents","startingRepresentations","componentsState","representationsState","className","startsPlaying","close","nail","requestedFrame","framesSelect","preventTrajectory","onProgress"],bt=!(0,We.A)()&&window.innerWidth>750,jt=(()=>{switch(Ve()){case He:return 50;case Ge:return 25;default:return 10}})(),wt=[{value:1,label:"1"},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],vt={name:"Unnamed component",topologyURL:"auto",trajectoryURLs:"auto",atomSelection:null,frame:null,onlyTopology:!1},xt={name:"Unnamed representation",selection:"all",show:!0,type:"cartoon",color:"chainid",opacity:1,component:"auto"},Lt=(e,t)=>{let r=!1;for(const[n,o]of Object.entries(t))void 0===e[n]&&(e[n]=o,r=!0);return r},At=(0,s.forwardRef)(((e,t)=>{let{startingComponents:r,startingRepresentations:a,componentsState:i,representationsState:w,className:v,startsPlaying:x=bt,close:L,nail:A,requestedFrame:E,framesSelect:R=!0,preventTrajectory:C=!1,onProgress:S}=e,k=(0,o.A)(e,yt);if(r&&i)throw new Error("startingComponents and componentsState are not compatilbe inputs. Choose one.");if(a&&w)throw new Error("startingRepresentations and representationsState are not compatilbe inputs. Choose one.");const[N,F]=(0,s.useState)(Be),{metadata:M,accessionAndMdNumber:T,topology:U}=(0,s.useContext)(re.f),z=(0,s.useMemo)((()=>{const e=M.mdFrames,t=[...wt];for(let r=t.length-1;r>=0&&t[r].value>e;r--)t.pop();return t.length===wt.length||t[t.length-1].value!==e&&t.push({value:e,label:e.toString()}),t}),[M.mdFrames]),q=(0,s.useMemo)((()=>r?r.map((e=>JSON.parse(JSON.stringify(e)))):null),[r]),[D,G]=i||(0,s.useState)(q),H=(0,s.useCallback)((e=>{if(!T)return!1;const t=(0,n.A)({},vt);return t.topologyURL="".concat(I.nP,"/").concat(T,"/files/structure"),t.trajectoryURLs=["".concat(I.nP,"/").concat(T,"/files/trajectory")],Lt(e,t)}),[T]);(0,s.useEffect)((()=>{if(!H)return;if(!D){const e=[{name:"Main"}];return e.forEach((e=>{H(e)})),G(e)}const e=D.map((e=>e.name)),t=new Set(e);if(e.length!==t.size)throw new Error("We have multiple components with the same name: ".concat(e.join(", ")));D.map((e=>H(e,vt))).some((e=>!0===e))&&G([...D])}),[D,H]),(0,s.useEffect)((()=>{D&&void 0!==E&&D[0].frame!==E&&(D[0].frame=E,G([...D]))}),[D,E]);const V=(0,s.useMemo)((()=>a?a.map((e=>JSON.parse(JSON.stringify(e)))):null),[a]),[W,J]=w||(0,s.useState)(V),K=(0,Ie.A)(),Q=(0,s.useCallback)((e=>{if(!D)return!1;const t=(0,n.A)({},xt);return t.component=D[0].name,Lt(e,t)}),[D]);(0,s.useEffect)((()=>{if(!K||0===K.length)return;if(!W){const e=[...K];return e.forEach((e=>Q(e,xt))),J(e)}W.map((e=>Q(e,xt))).some((e=>!0===e))&&J([...W])}),[W,K,Q]);const X=(0,s.useRef)(null),Y=(0,s.useRef)(null),[Z,$]=(0,qe.A)(!1),[ee,te]=(0,qe.A)(x),[ne,oe]=(0,qe.A)(!1),[se,ae]=(0,s.useState)(!0),[ce,ie]=(0,qe.A)((0,s.useMemo)((()=>O("dark-background",!1)),[])),[le,ue]=(0,qe.A)((0,s.useMemo)((()=>O("perspective",!1)),[])),[me,de]=(0,s.useState)(0),[fe,pe]=(0,s.useState)(0),[he,ge]=(0,s.useState)(l().isFullscreen),[ye,je]=(0,s.useState)(Math.min(jt,M.mdFrames)),[we,ve]=(0,s.useState)((0,s.useMemo)((()=>O("speed",50)),[])),[xe,Le]=(0,s.useState)(!1),Ae=(0,s.useCallback)((e=>{S&&S(e),de(e)}),[de,S]),Ee=(0,s.useCallback)((e=>{pe(e)}),[pe]),Re=(0,s.useCallback)((e=>{let{buttons:t,clientX:r,currentTarget:n,type:o}=e;if(!Y.current)return;if("mousemove"===o&&1!==t)return;const{x:s,width:a}=n.getBoundingClientRect();te(!1),Y.current.currentFrame=Math.floor((r-s)/a*Y.current.totalExpectedFrames)}),[te]),Ce=(0,s.useCallback)((e=>{Y.current&&(te(!1),Y.current.currentFrame+=e)}),[te]),Se=(0,s.useCallback)((()=>Ce(-1)),[Ce]),_e=(0,s.useCallback)((()=>Ce(1)),[Ce]),ke=(0,s.useCallback)((()=>ge(l().isFullscreen)),[]);(0,s.useEffect)((()=>(l().on("change",ke),()=>l().off("change",ke))),[ke]);const Ne=(0,s.useCallback)((()=>{X.current&&l().toggle(X.current)}),[]);(0,s.useEffect)((()=>{const e=e=>{"Escape"===e.key&&Le(!1),Y.current.autoResize()};return document.addEventListener("keydown",e,!1),()=>document.removeEventListener("keydown",e,!1)}),[]);const Fe=(0,s.useMemo)((()=>{if(!U||!U.pbcResidues)return;const e=U.pbcResidues.size>0;return e&&ae(!1),e}),[U]);(0,s.useImperativeHandle)(t,(()=>({autoResize:Y.current.autoResize,centerFocus:Y.current.centerFocus,get currentFrame(){return Y.current.currentFrame},set currentFrame(e){Y.current.currentFrame=e},togglePlaying:te,setFinalComponents:G,setFinalRepresentations:J})),[te,G,J]);const Me=D&&D[0],Te=C||Me&&(Me.onlyTopology||Number.isFinite(Me.frame));return(0,_.jsx)(u.A,{className:c()(it,{[at]:he}),ref:X,children:(0,_.jsxs)("div",{className:c()(Qe,v),children:[(0,_.jsxs)(u.A,{className:xe?Xe:Ye,style:{border:"none",boxShadow:"none"},id:"preventDragSize",children:[(0,_.jsxs)(u.A,{className:xe?c()(Ze,v):c()(et,v),style:{border:"none",boxShadow:"none"},children:[(0,_.jsx)(N,(0,n.A)({playing:ee,spinning:ne,smooth:se,onProgress:Ae,onLoad:Ee,ref:Y,noTrajectory:Te,requestedFramesNumber:ye,darkBackground:ce,perspective:le,speed:we,components:D,representations:W},k)),xe&&(0,_.jsxs)("div",{className:$e,children:[(0,_.jsxs)("div",{className:tt,children:[(0,_.jsx)(m.A,{title:"Toggle spin",onClick:oe,size:"large",children:(0,_.jsx)(y.g,{icon:j.OtC})}),(0,_.jsx)(m.A,{title:"Center focus",onClick:e=>{if(!Y.current)return;e.shiftKey||e.ctrlKey||e.metaKey?Y.current.displayFocus():Y.current.centerFocus()},size:"large",children:(0,_.jsx)(y.g,{icon:b.RV})}),Te||(0,_.jsx)("div",{className:tt,title:Fe&&"Smooth interpolation is not allowed since there are residues under Periodic Boundary Conditions. The smoothing may result in misleading artifacts for those atoms jumping across boundaries.",children:(0,_.jsx)(m.A,{title:"Toggle smooth interpolation ".concat(se?"off":"on"),onClick:()=>ae((e=>!e)),disabled:Fe,size:"large",children:(0,_.jsx)(y.g,{icon:se?b.yv:j.n2W})})}),(0,_.jsx)(m.A,{title:"Invert background color",onClick:()=>{ie(),B("dark-background",!ce)},size:"large",children:(0,_.jsx)("div",{className:c()(Je,{[Ke]:ce}),children:(0,_.jsx)(y.g,{icon:j.Rpi})})}),(0,_.jsx)(m.A,{title:"Switch to ".concat(le?"ortographic":"perspective"," view"),onClick:()=>{ue(),B("perspective",!le)},size:"large",children:(0,_.jsx)(y.g,{icon:le?b.Nf:j.br3})}),(0,_.jsx)(m.A,{title:"Switch viwer to ".concat(N===Be?"MolStar":"NGL"),onClick:()=>{F((e=>{if(e===Be)return be;if(e===be)return Be;throw new Error("Unrecognized current viewer")}))},size:"large",children:(0,_.jsx)(y.g,{icon:N===Be?j.RPy:j.QOt})})]}),Te||(0,_.jsxs)("div",{children:["Speed:",(0,_.jsxs)(d.Ay,{container:!0,spacing:2,className:rt,children:[(0,_.jsx)(d.Ay,{item:!0,children:(0,_.jsx)(f.A,{children:(0,_.jsx)(y.g,{icon:j.zsV})})}),(0,_.jsx)(d.Ay,{item:!0,xs:!0,children:(0,_.jsx)(p.Ay,{title:"Change player speed",value:we,"aria-labelledby":"continuous-slider",onChange:(e,t)=>{ve(t),B("speed",t)}})}),(0,_.jsx)(d.Ay,{item:!0,children:(0,_.jsx)(f.A,{children:(0,_.jsx)(y.g,{icon:j.Cz6})})})]})]}),Te||(0,_.jsxs)("div",{children:["Frames:",R?(0,_.jsx)(p.Ay,{title:"Select frame number",value:ye,onChange:(e,t)=>je(t),"aria-labelledby":"discrete-slider-restrict",step:null,valueLabelDisplay:"auto",marks:z,max:z[z.length-1].value}):" "+Y.current.totalExpectedFrames]})]})]}),xe&&(0,_.jsx)("div",{className:nt,children:(0,_.jsx)(P,{components:D,representations:W,setRepresentations:J})})]}),(0,_.jsxs)(h.A,{style:{padding:0},children:[Te?(0,_.jsx)("div",{}):(0,_.jsx)("div",{className:c()(lt,{[Ke]:ce}),onClick:Re,onMouseMove:Re,children:(0,_.jsx)(g.A,{variant:"buffer",color:"primary",value:100*me,valueBuffer:100*fe,style:{height:"1ch"}})}),(0,_.jsxs)("div",{className:ut,children:[(0,_.jsxs)("div",{children:[(0,_.jsx)(m.A,{title:"Close viewer",className:c()({[ot]:!L}),disabled:!L,onClick:L,size:"large",children:(0,_.jsx)(y.g,{icon:j.GRI})}),(0,_.jsx)(m.A,{title:Z?"Nailed viewer":"Nail viewer",className:c()({[ot]:!A}),disabled:!A||Z,onClick:()=>{A(),$()},size:"large",children:(0,_.jsx)("div",{className:mt,children:(0,_.jsxs)("div",{className:c()(dt,{[ft]:Z}),children:[(0,_.jsx)(y.g,{className:c()(pt,ht),icon:j.KKb}),(0,_.jsx)(y.g,{className:c()(pt,gt),icon:j.DW4})]})})})]}),(0,_.jsx)("div",{children:Te||(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(m.A,{title:"Previous frame",onClick:Se,size:"large",children:(0,_.jsx)(y.g,{icon:j.L4I})}),(0,_.jsx)(m.A,{title:ee?"Pause":"Play",onClick:te,size:"large",children:(0,_.jsx)("div",{className:mt,children:(0,_.jsxs)("div",{className:c()(dt,{[ft]:ee}),children:[(0,_.jsx)(y.g,{className:c()(pt,ht),icon:j.ijD}),(0,_.jsx)(y.g,{className:c()(pt,gt),icon:j.G1Y})]})})}),(0,_.jsx)(m.A,{title:"Next frame",onClick:_e,size:"large",children:(0,_.jsx)(y.g,{icon:j.BxI})})]})}),(0,_.jsxs)("div",{children:[(0,_.jsx)(m.A,{title:"".concat(he?"Exit":"Go"," fullscreen"),onClick:Ne,className:c()(st,{[ot]:!l().isEnabled,[at]:he,[ct]:xe}),disabled:!l().isEnabled,size:"large",children:(0,_.jsx)(y.g,{icon:he?j.gr3:j.oZK})}),(0,_.jsx)(m.A,{title:"Settings",onClick:()=>{Le((e=>!e)),Y.current.autoResize()},size:"large",children:(0,_.jsx)(y.g,{icon:j.dB})})]})]})]})]})})}))},13232:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});const n=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=e.getBoundingClientRect(),s=t.getBoundingClientRect();let a=r.x;if(Math.abs(o.left-a)>Math.abs(a-o.right)){a-=n+(s.right-s.left)}else a+=n;a-=o.left;let c=r.y;if(Math.abs(o.top-c)>Math.abs(c-o.bottom)){c-=n+(s.bottom-s.top)}else c+=n;return c-=o.top,{x:a,y:c}}},42634:()=>{},15340:()=>{},79838:()=>{}}]);
//# sourceMappingURL=1235.caf4262a.chunk.js.map