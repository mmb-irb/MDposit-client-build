"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[7515],{8018:(t,e,n)=>{n.r(e),n.d(e,{default:()=>E});var a=n(89379),r=n(65043),c=n(40830),l=n(88058),i=n(45180),s=n(75040),o=n(80705),d=n(32577),u=n(60093),h=n(39766),x=n(64600),p=n.n(x),m=n(92954);const g=window.devicePixelRatio||1,f=d._9v.amplitude(1).period(.5);let y;var v=n(17604),w=n(17392),S=n(92127),M=n(12639);const _={"graph-container":"style_graph-container__oCOoS",axis:"style_axis__H0KE8","legend-text":"style_legend-text__Zvd0H",legend:"style_legend__kYAHJ",switch:"style_switch__vPk4i",switched:"style_switched__DLS7l","color-scale":"style_color-scale__mIyZh",cursor:"style_cursor__uJXdm",tooltip:"style_tooltip__S2WeP"};var A=n(70579);const R=window.devicePixelRatio||1,b=10,j=10,C=25,k=25,L=500,[P,Y]=[375,625],X=(0,d.exT)(d.GAA),E=t=>{let{framestep:e,projectionsData:n,projections:x,datumRange:E,totalFrames:I,setRequestedFrame:T}=t;const F=(0,r.useRef)(null),N=(0,r.useRef)(null),W=(0,r.useRef)(c.A),B=(0,r.useRef)(null),D=(0,r.useRef)(null),G=(0,r.useRef)(null),H=(0,r.useRef)({find(){}}),[J,z]=(0,m.A)(!1);(0,r.useEffect)((()=>{const t=(0,d.Ltv)(F.current).append("canvas"),e=(0,d.Ltv)(F.current).append("svg"),n=t.node().getContext("2d",{alpha:!1,desynchronized:!0}),a=(0,d.V$7)(),r={xScale:(0,d.m4Y)(),yScale:(0,d.m4Y)(),xAxis:e.append("g").attr("class",_.axis),yAxis:e.append("g").attr("class",_.axis),xAxisLegend:e.append("text").attr("class",p()(_.axis,_["legend-text"])),yAxisLegend:e.append("text").attr("class",p()(_.axis,_["legend-text"])),dataPoints:e.append("g").attr("class",_["data-points"]),hover:e.append("circle").attr("fill","transparent"),legendCanvas:(0,d.Ltv)(N.current).select("canvas"),legendCursor:(0,d.Ltv)(N.current).select(".".concat(_.cursor)),brush:a,brushElement:e.append("g").attr("class","brush")};r.drawLegend=(0,l.A)((t=>(e,n,a,r,c)=>{const l=t.createImageData(e.length,1),i=new Uint32Array(l.data.buffer);e.forEach(((t,e)=>{let{x:l,y:s,fill:{r:o,g:d,b:u}}=t,h=255;if(n){const t=n(l);if(t<0||t>r)h=100;else{const t=a(s);(t<0||t>c)&&(h=100)}}i[e]=16777216*h+65536*u+256*d+o})),t.putImageData(l,0,0)})(r.legendCanvas.node().getContext("2d",{alpha:!0})),L+Y);const c=function(){let{onlyTooltip:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G.current.style.display="none",r.hover.attr("fill","transparent"),t||(r.legendCursor.style("left",""),r.legendCursor.style("opacity",0))},o=function(){let{datumIndex:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T((e=>{if(!I)return console.error("No number of frames in metadata. Are we missing the main trajectory?"),null;const n=Math.floor(t*(I/E));return n===e?null:n}))};return W.current=async function(){let{processed:a=D.current,brushing:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!a)return;if(await(0,h.Gt)(),!F.current.firstChild)return;const{clientWidth:u,clientHeight:x}=F.current;e.attr("width",u).attr("height",x),t.attr("width")!=="".concat(u*R)&&t.attr("width",u*R),t.attr("height")!=="".concat(x*R)&&t.attr("height",x*R),t.style("width","".concat(u,"px")).style("height","".concat(x,"px")),r.brushElement.call(r.brush);const p=!B.current;r.xScale.range([k,u-j]),l||r.xScale.domain(a.xMinMax),r.yScale.range([x-C,b]),l||r.yScale.domain(a.yMinMax);r.xAxis.transition().duration(!p&&!(0,v.A)()&&L+Y).call((t=>t.attr("transform","translate(0, ".concat((0,i.A)(r.yScale(0),0,x-32),")")).call((0,d.l78)(r.xScale).ticks(Math.round(u/75)).tickFormat((t=>0===t?null:t))))),r.xAxisLegend.text("\u2190 principal component ".concat(a.projections[0]+1," \u2192")).transition().duration(!p&&!(0,v.A)()&&L+Y).attr("transform","translate(".concat(u/2,", ").concat(x-5,")"));r.yAxis.transition().duration(!p&&!(0,v.A)()&&L+Y).call((t=>t.attr("transform","translate(".concat((0,i.A)(r.xScale(0),30,u-1),", 0)")).call((0,d.V4s)(r.yScale).ticks(Math.round(x/75)).tickFormat((t=>0===t?null:t))))),r.yAxisLegend.text("\u2190 principal component ".concat(a.projections[1]+1," \u2192")).transition().duration(!p&&!(0,v.A)()&&L+Y).attr("transform","translate(5, ".concat(x/2,") rotate(90)")),r.brush.on("end",(()=>{const{selection:t}=d.f0J;t&&(r.xScale.domain([t[0][0],t[1][0]].map(r.xScale.invert,r.xScale)),r.yScale.domain([t[1][1],t[0][1]].map(r.yScale.invert,r.yScale)),r.brushElement.call(r.brush.move,null),W.current({brushing:!0}))}));const m=Math.log(Math.max((a.xMinMax[1]-a.xMinMax[0])/(r.xScale.domain()[1]-r.xScale.domain()[0]),(a.yMinMax[1]-a.yMinMax[0])/(r.yScale.domain()[1]-r.yScale.domain()[0])))+1,w=R*Math.min(u,x)*m/250;r.hover.attr("r",w+5);let S=0;const M=p?0:B.current.currentRadius;B.current=a.data.map(((t,e,n)=>{let{x:a,y:c,fill:l}=t,{length:i}=n;const o=r.xScale(a)*R,u=r.yScale(c)*R,h=e*L*(p?2:1)/i,x=(0,v.A)()?0:(0,s.A)(P,Y)*(p?2:1),m=h+x;return S<m&&(S=m),{currentX:null,currentY:null,currentRadius:null,interpolateX:(0,d.GWP)(p?r.xScale(0)*R:B.current[e].currentX||B.current[e].x,o),interpolateY:(0,d.GWP)(p?r.yScale(0)*R:B.current[e].currentY||B.current[e].y,u),delay:h,duration:x,x:o,y:u,fill:l}})),B.current.interpolateRadius=(0,d.GWP)(M,w),(t=>{let{context:e,dataPoints:n,width:a,height:r,maxTime:c,isFirstTime:l}=t;new Promise((t=>{y&&y.stop(),y=(0,d.O1W)((i=>{const s=i>=c;s?(y.stop(),e.fillStyle="white",e.fillRect(0,0,a*g,r*g)):(e.fillStyle="rgba(255, 255, 255, 0.25)",e.fillRect(0,0,a*g,r*g));for(const t of n){const c=Math.max(0,(l?f:d.oRn)(Math.min((i-t.delay)/t.duration,1)));t.currentX=t.interpolateX(c),t.currentX<0||t.currentX>a||(t.currentY=t.interpolateY(c),n.currentRadius=n.interpolateRadius(c),t.currentY<0||t.currentY>r||(e.fillStyle=t.fill.hex,e.beginPath(),e.arc(t.currentX,t.currentY,n.currentRadius,0,2*Math.PI),e.fill()))}s&&t()}))}))})({context:n,dataPoints:B.current,width:u*R,height:x*R,maxTime:S,isFirstTime:p});const _=function(){let{datumIndex:t,datum:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Number.isInteger(t)||!e)return;r.legendCursor.style("left","calc(".concat(100*t/a.data.length,"% - 4px)")),r.legendCursor.style("opacity",1);const n=r.xScale(e.x);if(n<0||n>u)return c({onlyTooltip:!0});const l=r.yScale(e.y);if(l<0||l>x)return c({onlyTooltip:!0});const{scrollX:i,scrollY:s}=window,{left:o,top:d}=F.current.getBoundingClientRect();G.current.innerHTML="\n          <div>\n            <p>Frame ".concat(t*a.framestep+1," (click to open viewer)</p>\n            <p>Principal component ").concat(a.projections[0]+1,": ").concat(e.x,"</p>\n            <p>Principal component ").concat(a.projections[1]+1,": ").concat(e.y,"</p>\n          </div>\n        "),G.current.style.display="inline-block";const h=G.current.getBoundingClientRect();G.current.style.transform="translate(".concat(n+o+i-h.width/2,"px, ").concat(l+d+s-h.height-15,"px)"),r.hover.attr("cx",n).attr("cy",l).attr("fill",e.fill.hex)},A=t=>()=>{const{scrollX:e,scrollY:n}=window,{left:l,top:i}=F.current.getBoundingClientRect(),{pageX:s,pageY:o}=d.f0J,u=s-l-e,h=o-i-n,x=H.current.find(r.xScale.invert(u),r.yScale.invert(h)),p=a.data[x];if(p){const e=r.xScale(p.x),n=r.yScale(p.y);if(Math.sqrt(Math.abs(e-u)**2+Math.abs(n-h)**2)<=20)return t({datumIndex:x,datum:p})}c(),t()};e.on("mousemove",A(_)).on("mouseout",c).on("click",A(o));const X=t=>()=>{const e=r.legendCanvas.node();if(!e||!("getBoundingClientRect"in e))return;const{left:n,width:c}=e.getBoundingClientRect(),{pageX:l}=d.f0J,i=(l-n)/c,s=Math.floor(i*a.data.length);t({datumIndex:s,datum:a.data[s]})};r.drawLegend(a.data,r.xScale,r.yScale,u,x),r.legendCanvas.on("mousemove",X(_)).on("mouseout",c).on("click",X(o))},window.addEventListener("resize",W.current),()=>{r.drawLegend&&r.drawLegend.cancel(),window.removeEventListener("resize",W.current)}}),[x,T,E,I]),(0,r.useEffect)((()=>{const[t,r]=J?[0,1]:[1,0],c=n&&n[0].length||0,l=X.domain([0,c]),i=n[x[t]],s=n[x[r]],p=(0,o.A)(i,s),m={data:p.map(((t,e)=>{let[n,r]=t;const c=l(e);return{x:n,y:r,fill:(0,a.A)({hex:c},(0,d.Qhc)(c))}})),xMinMax:[Math.min(...i),Math.max(...i)],yMinMax:[Math.min(...s),Math.max(...s)],framestep:e,projections:[x[t],x[r]]};D.current=m,W.current({processed:m}),(async()=>{await(0,h.yy)(L+Y),await(0,h._)(100),H.current=u.A.from(p)})()}),[n,x,e,J]);const q=n&&n[0].length||0;return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("div",{className:_["graph-container"],onDoubleClick:W.current,ref:F}),(0,A.jsxs)("div",{className:_.legend,children:[(0,A.jsx)(w.A,{title:"Switch axes",className:p()(_.switch,{[_.switched]:J}),onClick:z,size:"large",children:(0,A.jsx)(S.g,{icon:M.fKj})}),(0,A.jsx)("p",{children:"position in simulation:"}),(0,A.jsxs)("div",{className:_["color-scale"],children:[(0,A.jsx)("div",{children:"start"}),(0,A.jsxs)("div",{ref:N,children:[(0,A.jsx)("canvas",{height:"1",width:q}),(0,A.jsx)("div",{className:_.cursor})]}),(0,A.jsx)("div",{children:"end"})]})]}),(0,A.jsx)("div",{className:_.tooltip,ref:G})]})}}}]);
//# sourceMappingURL=projections.cdc40f08.chunk.js.map