"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[5190,6618,9302],{10939:(e,t,n)=>{n.d(t,{A:()=>h});var a=n(89379),r=n(80045),s=n(65043),c=n(12110),i=n(17604);const l="style_container__M9GCG";var o=n(70579);const d=["overrideComponent"],u={opacity:[0,1]};(0,i.A)()||(u.transform=["translateY(50px)","translateY(0)"]);const p={fill:"both",easing:"cubic-bezier(0, .99, .56, 1.1)",duration:500},h=(0,s.forwardRef)(((e,t)=>{let{overrideComponent:n}=e,i=(0,r.A)(e,d);const h=(0,s.useRef)(null);(0,s.useLayoutEffect)((()=>{const e=h.current&&h.current.firstElementChild;if(!e||!e.animate)return;const t=Array.from(document.querySelectorAll("main section")).findIndex((t=>e===t)),n=e.animate(u,(0,a.A)((0,a.A)({},p),{},{delay:150*t}));return()=>n.cancel()}),[]);const m=n?"section":c.A;return(0,o.jsx)("div",{ref:h,className:l,children:(0,o.jsx)(m,(0,a.A)((0,a.A)({component:"section"},i),{},{ref:t}))})}))},34088:(e,t,n)=>{n.d(t,{A:()=>h});var a=n(89379),r=n(65043),s=n(43126),c=n(10939);const i="style_rnd__Txifm",l="style_floating-card__HHpby";var o=n(70579);const d=(0,r.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(9070),n.e(2594),n.e(8280),n.e(7955),n.e(6064),n.e(1235),n.e(9117)]).then(n.bind(n,92428))));let u=0;const p=e=>{const t=e.viewerRef||(0,r.useRef)(null),[n,p]=(0,r.useState)((()=>{const{innerWidth:e,innerHeight:t,scrollY:n}=window,a=document.querySelector("main").offsetTop,r=Math.max(Math.min(e/4,t/4),150),s=1.5*r;return{width:2*r,height:s,x:0,y:t-a-s-20+n}}));return(0,o.jsx)(s.p,{position:{x:n.x,y:n.y},size:{width:n.width,height:n.height},style:{zIndex:(u+=1,u)},className:i,"data-rnd":!0,bounds:"window",cancel:"canvas, [data-popover], #preventDragSize",onDragStart:()=>{p((0,a.A)({},n))},onResizeStart:()=>{p((0,a.A)({},n))},onDragStop:(e,t)=>{0===e.layerX&&0===e.layerY||n.x===t.x&&n.y===t.y||p((0,a.A)((0,a.A)({},n),{},{x:t.x,y:t.y}))},onResize:()=>t.current&&t.current.autoResize(),onResizeStop:(e,t,n,r,s)=>{p((0,a.A)({width:n.style.width,height:n.style.height},s))},children:(0,o.jsx)(c.A,{className:l,elevation:4,children:(0,o.jsx)(r.Suspense,{fallback:null,children:(0,o.jsx)(d,(0,a.A)({className:l,ref:t,startsPlaying:!1},e))})})})},h=e=>{let{newViewer:t,nailing:n=!0,onNail:s,onClose:c}=e;const[i,l]=(0,r.useState)([]),d=[...i],u=(0,r.useRef)([]);if(t){const e=()=>{let e=0;for(;e<999;){if(-1===u.current.indexOf(e))return e;e+=1}console.error("Maximum number of viewers reached")};t.id=e(),t.close=()=>{n&&l((e=>{const n=[...e],a=e.indexOf(t);return-1!==a&&n.splice(a,1),n})),c&&c(t),u.current.push(t.id)},n&&(t.nail=()=>{l((e=>[...e,t])),s&&s(t),u.current.push(t.id)}),d.push(t)}return d.map((e=>(0,o.jsx)(p,(0,a.A)({},e),e.id)))}},89302:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Z});var a=n(65043),r=n(64600),s=n.n(r),c=n(26494),i=n(85865),l=n(10939),o=n(34088),d=n(40830),u=n(6880),p=n(32577),h=n(71806),m=n(84882),x=n(28076),f=n(10039),A=n(73460),g=n(11906),v=n(92127),j=n(44642),y=n(17604);const _="style_delete__BYITu",w="style_graph-container__2Y--C",b="style_axis__z8ryu",P="style_visual__S4w3g",S="style_bars__p3cKG",E="style_has-projection__R+xxb",R="style_projected__M7dqT",F="style_target__Kzgs+",C="style_explanation__kphn8",N="style_top-line__WYRxq",k="style_area__BwFoU",z="style_tooltip__ZrzAO";var M=n(70579);const Y=20,q=40,B=20,H=30,L=e=>{let{eigenvalues:t,totalEigenvalue:n,projectionsData:r,projections:s=[],setProjections:c}=e;const i=(0,a.useRef)(null),l=(0,a.useRef)(null),o=(0,a.useRef)(d.A),L=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const e=(0,p.Ltv)(i.current).append("svg");e.append("defs").append("clipPath").attr("id","clip-reveal").append("rect").attr("x",0).attr("y",0).attr("height","100%").attr("width",0).transition().duration((0,y.A)()?0:2150).attr("width","100%");const a={xAxis:e.append("g").attr("class",b),yExplAxis:e.append("g").attr("class",b),yEigenAxis:e.append("g").attr("class",b),explanationArea:e.append("g").attr("class",C),visualBars:e.append("g").attr("class","".concat(P," ").concat(S)),targetBars:e.append("g").attr("class","".concat(F," ").concat(S))};return o.current=function(){let{processed:r=L.current}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{clientWidth:s,clientHeight:o}=i.current;e.attr("width",s).attr("height",o);const d=(0,p.WH)().domain(r.map(((e,t)=>t))).range([H,s-q]).padding(.1);a.xAxis.call((e=>e.attr("transform","translate(0, ".concat(o-B,")")).call((0,p.l78)(d).tickFormat((e=>e+1)))));const u=(0,p.m4Y)().domain([0,1]).range([o-B,Y]).nice();a.yExplAxis.call((e=>e.attr("transform","translate(".concat(s-q,", 0)")).call((0,p.eH3)(u).ticks(6).tickFormat((e=>"".concat(100*("number"===typeof e?e:0),"%"))))));const h=(0,p.n8j)().x(((e,t)=>d(t)+d.bandwidth()/2)).y(u),m=a.explanationArea.selectAll("path.".concat(N)).data([r]);m.enter().append("path").attr("class",N).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(m).attr("d",(e=>h(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const x=(0,p.Wcw)().x(((e,t)=>d(t)+d.bandwidth()/2)).y0(o-B).y1((e=>u(e))),f=a.explanationArea.selectAll("path.".concat(k)).data([r]);f.enter().append("path").attr("class",k).attr("clip-path","url(#clip-reveal)").attr("opacity",0).merge(f).attr("d",(e=>x(e.map((e=>e.cumulativeExplained))))).transition().duration(2500).attr("opacity",1);const A=(0,p.m4Y)().domain([0,t[0]]).range([o-B,Y]).nice();a.yEigenAxis.call((e=>e.attr("transform","translate(".concat(H,", 0)")).call((0,p.V4s)(A).ticks(5))));const g=a.visualBars.selectAll("rect").data(r);if(g.enter().append("rect").attr("y",A(0)).attr("height",0).merge(g).attr("class",(e=>{let{hasProjection:t,projected:n}=e;return"".concat(t?E:""," ").concat(n?R:"").trim()||null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth()).transition().ease(p.g9.overshoot(5)).duration((0,y.A)()?0:500).delay((0,y.A)()?0:(e,t)=>50*t).attr("y",(e=>A(e.eigenvalue))).attr("height",(e=>o-B-A(e.eigenvalue))),!l.current)return;const v=a.targetBars.selectAll("rect").data(r);v.enter().append("rect").attr("y",0).attr("height","100%").on("click",((e,t)=>{let{hasProjection:n}=e;n&&c((e=>{const n=new Set(e);return n[n.has(t)?"delete":"add"](t),Array.from(n).sort(((e,t)=>e-t))}))})).on("mousemove",((e,t)=>{l.current.innerHTML="\n            <div>\n              <p>Principal component ".concat(t+1,"</p>\n              <p>Eigenvalue: ").concat((Math.round(100*e.eigenvalue)/100).toFixed(2),"</p>\n              <p>\n                Explained variance: ").concat((Math.round(e.eigenvalue/n*1e3)/10).toFixed(1),"%\n              </p>\n              <p>\n                Cumulative explained variance: ").concat((Math.round(1e3*e.cumulativeExplained)/10).toFixed(1),"%\n              </p>\n              <p>Projection data is ").concat(e.hasProjection?"":"not"," available</p>\n            </div>\n          "),l.current.style.opacity=1})).on("mouseout",(()=>l.current.style.opacity=0)).merge(v).attr("class",(e=>{let{hasProjection:t}=e;return t?E:null})).attr("x",((e,t)=>d(t))).attr("width",d.bandwidth())},window.addEventListener("resize",o.current),()=>window.removeEventListener("resize",o.current)}),[t,c,n]),(0,a.useEffect)((()=>{let e=0;const a=[];for(const[c,i]of t.entries()){const t=r[c];e+=i;const l=e/n;if(a.push({cumulativeExplained:l,eigenvalue:i,projected:s.includes(c),hasProjection:!!t}),c>=14&&l>=.8)break}L.current=a,o.current({processed:a})}),[t,r,n,s]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{className:w,ref:i}),(0,M.jsx)("div",{className:z,ref:l}),!!s.length&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(h.A,{children:[(0,M.jsx)(m.A,{children:(0,M.jsxs)(x.A,{children:[(0,M.jsx)(f.A,{children:"Principal component"}),(0,M.jsx)(f.A,{children:"Eigenvalue"}),(0,M.jsx)(f.A,{children:"Explained variance"})]})}),(0,M.jsx)(A.A,{children:s.map((e=>(0,M.jsxs)(x.A,{children:[(0,M.jsx)(f.A,{children:e+1}),(0,M.jsx)(f.A,{children:(0,u.A)(t[e],2)}),(0,M.jsxs)(f.A,{children:[(0,u.A)(t[e]/n*100,1)," %"]})]},e)))})]}),(0,M.jsxs)(g.A,{variant:"contained",onClick:()=>c([]),className:_,children:[(0,M.jsx)(v.g,{icon:j.UB}),"\xa0",(0,M.jsx)("span",{children:"Clear selection"})]})]})]})};var D=n(17545),I=n(58338),T=n(29449),U=n(95747),W=n(96618),O=n(35190);const V=(0,a.lazy)((()=>Promise.all([n.e(7784),n.e(8095),n.e(3845),n.e(9070),n.e(2594),n.e(8280),n.e(7955),n.e(6064),n.e(1235),n.e(9117)]).then(n.bind(n,92428)))),G=(0,a.lazy)((()=>Promise.all([n.e(6264),n.e(7515)]).then(n.bind(n,8018)))),K=(0,M.jsx)("div",{className:s()(O.default.placeholder,O.default.projection)}),X=(0,M.jsx)("div",{className:s()(O.default.placeholder,O.default["viewer-with-controls"])}),Z=()=>{const{accession:e,accessionAndMdNumber:t,metadata:n,files:r}=(0,a.useContext)(T.f),{loading:s,payload:d,error:u}=(0,I.A)("".concat(U.nP,"/").concat(t,"/analyses/pca/")),p=d&&d.data,[h,m]=(0,a.useState)([]),[x,f]=(0,a.useState)(null),[A,g]=(0,a.useMemo)((()=>{if(f(null),!p)return[];const e=p.eigenvalues;if(!e.length)return[];const t=e.reduce(((e,t)=>e+t),0);return[h.reduce(((t,n)=>t+e[n]),0)/t,t]}),[p,h]),[v,j]=(0,a.useMemo)((()=>{if(!p||!r)return[void 0,void 0];let e;if(void 0!==h[0]){const n=("0"+(h[0]+1)).slice(-2);e=["".concat(U.nP,"/").concat(t,"/files/pca_trajectory_").concat(n,".bin")]}return[[{name:"PC projection",type:"spacefill"}],[{topologyURL:"".concat(U.nP,"/").concat(t,"/files/structure"),atomSelection:"@"+p.atoms.join(","),trajectoryURLs:e}]]}),[p,r,h,e]);return s?(0,M.jsx)(D.A,{}):u?u.toString():(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(l.A,{className:O.default.card,children:(0,M.jsxs)(c.A,{children:[(0,M.jsx)(i.A,{variant:"h6",children:"PCA eigenvalues"}),(0,M.jsx)(L,{eigenvalues:p.eigenvalues,totalEigenvalue:g,projectionsData:p.projections,projections:h,setProjections:m})]})}),(0,M.jsx)(l.A,{className:O.default.card,children:(0,M.jsxs)("div",{children:[(0,M.jsxs)(c.A,{children:[(0,M.jsx)(i.A,{variant:"h6",children:"PCA projections"}),(0,M.jsx)("p",{children:(0,W.default)(h,A)})]}),1===h.length&&(0,M.jsx)(a.Suspense,{fallback:X,children:(0,M.jsx)(c.A,{className:O.default["ngl-card"],children:(0,M.jsx)(V,{className:O.default["viewer-with-controls"],projection:h[0],framesSelect:!1,startingRepresentations:v,startingComponents:j,bounce:!0})})}),2===h.length&&(0,M.jsx)(a.Suspense,{fallback:K,children:(0,M.jsx)(c.A,{children:(0,M.jsx)(G,{framestep:p.framestep,projectionsData:p.projections,projections:h,datumRange:p.eigenvalues.length,totalFrames:n.mdFrames,setRequestedFrame:f})})})]})}),(0,M.jsx)(o.A,{newViewer:Number.isFinite(x)?{requestedFrame:x}:null,onNail:e=>f((t=>e.requestedFrame===t?null:t)),onClose:e=>f((t=>e.requestedFrame===t?null:t))})]})}},96618:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var a=n(6880);const r=(e,t)=>{if(!e.length)return"No projection selected, please select one or multiple projections to\n    visualise its or their related data. Only the darker blue bars correspond to\n    projections for which data has been calculated.";let n;return n=1===e.length?e[0]+1:2===e.length?"".concat(e[0]+1," and ").concat(e[1]+1):e.reduce(((e,t,n,a)=>{let{length:r}=a;return"".concat(e).concat(e?",":"").concat(n===r-1?" and":""," ").concat(t+1)}),""),"Selected principal component".concat(e.length>1?"s":""," ").concat(n,", accounting for ").concat((0,a.A)(100*t,1),"% of explained variance")}},10500:(e,t,n)=>{n.d(t,{A:()=>a});const a=function(e,t){for(var n=-1,a=null==e?0:e.length,r=Array(a);++n<a;)r[n]=t(e[n],n,e);return r}},28593:(e,t,n)=>{n.d(t,{A:()=>a});const a=Array.isArray},40830:(e,t,n)=>{n.d(t,{A:()=>a});const a=function(){}},6880:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(31133),r=n(3777),s=n(32222),c=n(3152),i=a.A.isFinite,l=Math.min;const o=function(e){var t=Math[e];return function(e,n){if(e=(0,s.A)(e),(n=null==n?0:l((0,r.A)(n),292))&&i(e)){var a=((0,c.A)(e)+"e").split("e"),o=t(a[0]+"e"+(+a[1]+n));return+((a=((0,c.A)(o)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round")},3777:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(99944);const r=function(e){var t=(0,a.A)(e),n=t%1;return t===t?n?t-n:t:0}},3152:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(54577),r=n(10500),s=n(28593),c=n(28666),i=a.A?a.A.prototype:void 0,l=i?i.toString:void 0;const o=function e(t){if("string"==typeof t)return t;if((0,s.A)(t))return(0,r.A)(t,e)+"";if((0,c.A)(t))return l?l.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const d=function(e){return null==e?"":o(e)}},35190:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a={card:"style_card__6C+Fc","ngl-card":"style_ngl-card__+pU8V",placeholder:"style_placeholder__2w0--",projection:"style_projection__v0o3I","viewer-with-controls":"style_viewer-with-controls__nFIv5"}}}]);
//# sourceMappingURL=9302.df99fe14.chunk.js.map