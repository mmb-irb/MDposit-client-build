"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[3960,5919,9117],{50953:(e,s,t)=>{t.r(s),t.d(s,{default:()=>C});var a=t(65043),r=t(89257),n=t(85865),l=t(32577),o=t(10939),d=t(92428),c=t(10419),i=t(17545),u=t(58338),p=t(29449),h=t(95747),m=t(63960),g=t(82746),x=t(48838),f=t(75291),y=t(70579);const b={triggerOnce:!0,rootMargin:"100px"},A=["grey","yellow","red"],S=e=>Math.round(100*e)/100,C=()=>{const[e,s]=(0,r.Wx)(b),{accessionAndMdNumber:t,metadata:C,topology:M,populations:j}=(0,a.useContext)(p.f),_=(0,c.A)(),k=(0,a.useRef)(null),R=(0,a.useRef)(null),{loading:v,payload:$,error:T}=(0,u.A)(`${h.nP}/${t}/analyses/rmsd-perres/`),[w,N]=(0,a.useState)([]),{components:D,representations:E,analysisFrameCount:F,xAxisStep:L,xAxisLabel:I,isEnsemble:P,xTooltip:W,data:G,xWeights:V}=(0,a.useMemo)((()=>{if(!M||!C||!$||j&&j.loading)return{};const e=$.rmsdpr,s=[],a=[];e.forEach((e=>{if(null===e)s.push(null),a.push(null);else{const[t,r]=(e=>{const s=e.length,t=e.reduce(((e,s)=>e+s))/s,a=Math.sqrt(e.map((e=>Math.pow(e-t,2))).reduce(((e,s)=>e+s))/s);return[S(t),S(a)]})(e);s.push(t),a.push(r)}}));const r={rmsdpr:e,means:s,stdvs:a},n=Math.max(...s),o=Math.min(...s),d=(0,l.m4Y)().range(A).domain([o,(o+n)/2,n]),c=g.ColormakerRegistry.addScheme((function(e){this.atomColor=e=>{const t=e.residueIndex,a=s[t];if(null===a)return 16777215;const r=(0,l.yWT)(d(a)).formatHex();return parseInt(r.substring(1),16)}})),i=C.mdFrames,u=$.step,p=[{trajectoryURLs:[`${`${h.nP}/${t}/trajectory`}?frames=1:${i}:${u}`]}],m=[];_.forEach((e=>{const s={...e};s.color="custom",s.customScheme=c,m.push(s)}));const x=e[0].length,f=C.timeLength,y="ensemble"===C.TYPE;let b,k,R,v;if(y||!f?(b=u,k="Frames",R=e=>"frame "+e):(b=f/(x-1),k="Time (ns)",R=e=>+e.toFixed(2)+" ns"),j&&j.payload){v=[];for(let e=0;e<j.payload.length;e+=b)v.push(j.payload[e])}return{components:p,representations:m,analysisFrameCount:x,xAxisStep:b,xAxisLabel:k,isEnsemble:y,xTooltip:R,data:r,xWeights:v}}),[$,M,C,t,_,j]),{selectedData:Y,selectedResidueIndices:q}=(0,a.useMemo)((()=>{const e={},s=[];return w.forEach(((t,a)=>{const r={data:G.rmsdpr[t.index]};r.color=t.color,e[a]=r,s.push(t.index)})),{selectedData:e,selectedResidueIndices:s}}),[G,w]),B=(0,a.useCallback)((e=>{k.current.togglePlaying(!1),k.current.currentFrame=e}),[]),H=(0,a.useCallback)((e=>{if(!R.current)return;const s=Math.round(e*(F-1));R.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]}),[F]),J=(0,a.useCallback)(((e,s,t)=>{const a={color:t,index:s};N((e=>[...e,a]))}),[N]),K=(0,a.useCallback)(((e,s)=>{N((e=>e.filter((e=>e.index!==s))))}),[N]),O=(0,a.useCallback)((()=>{N([])}),[N]),U=(0,a.useCallback)(((e,s)=>{const t=G.means[s],a=G.stdvs[s];return`Mean RMSD: ${Math.round(100*t)/100}\nStandard deviation: ${Math.round(100*a)/100}`}),[G]);return v||j&&j.loading?(0,y.jsx)(i.A,{}):T?T.toString():j&&j.error?j.error.toString():$?j&&!j.payload?"Something bad happened with populations":M?(0,y.jsxs)(a.Suspense,{fallback:(0,y.jsx)(i.A,{}),children:[(0,y.jsx)(o.A,{children:(0,y.jsx)(x.A,{residueValues:G.means,legendTitle:"Average RMSD (\xc5)",onSelect:J,onDeselect:K,onClean:O,onTooltip:U})}),(0,y.jsx)(o.A,{className:m.default.graphcard,children:w.length>0?(0,y.jsx)(f.default,{yData:Y,step:L,xAxisLabel:I,type:P?"dots":"line",xWeights:V,xTooltip:W,yAxisLabel:"RMSd (\xc5)",onSelect:B,className:m.default.graph,ref:R}):(0,y.jsx)("div",{className:m.default["graph-placeholder"],children:(0,y.jsx)(n.A,{variant:"h6",children:"No residue selected"})})}),(0,y.jsx)(o.A,{className:m.default.nglcard,ref:e,children:s?(0,y.jsx)(d.default,{className:m.default.container,startingComponents:D,startingRepresentations:E,selectedResidueIndices:q,onProgress:H,ref:k,framesSelect:!1}):(0,y.jsx)("div",{style:{height:"50vh"}})})]}):(0,y.jsx)(i.A,{}):"Something bad happened with the analysis data"}},63960:(e,s,t)=>{t.r(s),t.d(s,{default:()=>a});const a={graphcard:"style_graphcard__VoJ6R",graph:"style_graph__GoAAc","graph-placeholder":"style_graph-placeholder__bh3Kw",nglcard:"style_nglcard__Zr+kp",container:"style_container__lBCpG"}}}]);
//# sourceMappingURL=5919.b64fa10c.chunk.js.map