"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[1499,9117],{24539:(e,s,t)=>{t.r(s),t.d(s,{default:()=>k});var a=t(65043),n=t(89257),r=t(85865),l=t(32577),o=t(10939),i=t(92428),c=t(10419),d=t(17545),u=t(58338),p=t(29449),h=t(95747);const m="style_graphcard__VoJ6R",x="style_graph__GoAAc",g="style_graph-placeholder__bh3Kw",f="style_nglcard__Zr+kp",y="style_container__lBCpG";var b=t(82746),A=t(48838),S=t(75291),C=t(70579);const M={triggerOnce:!0,rootMargin:"100px"},j=["grey","yellow","red"],_=e=>Math.round(100*e)/100,k=()=>{const[e,s]=(0,n.Wx)(M),{accessionAndMdNumber:t,metadata:k,topology:R,populations:v}=(0,a.useContext)(p.f),$=(0,c.A)(),T=(0,a.useRef)(null),w=(0,a.useRef)(null),{loading:N,payload:D,error:E}=(0,u.A)(`${h.nP}/${t}/analyses/rmsd-perres/`),[F,L]=(0,a.useState)([]),{components:I,representations:P,analysisFrameCount:W,xAxisStep:G,xAxisLabel:V,isEnsemble:Y,xTooltip:q,data:B,xWeights:H}=(0,a.useMemo)((()=>{if(!R||!k||!D||v&&v.loading)return{};const e=D.rmsdpr,s=[],a=[];e.forEach((e=>{if(null===e)s.push(null),a.push(null);else{const[t,n]=(e=>{const s=e.length,t=e.reduce(((e,s)=>e+s))/s,a=Math.sqrt(e.map((e=>Math.pow(e-t,2))).reduce(((e,s)=>e+s))/s);return[_(t),_(a)]})(e);s.push(t),a.push(n)}}));const n={rmsdpr:e,means:s,stdvs:a},r=Math.max(...s),o=Math.min(...s),i=(0,l.m4Y)().range(j).domain([o,(o+r)/2,r]),c=b.ColormakerRegistry.addScheme((function(e){this.atomColor=e=>{const t=e.residueIndex,a=s[t];if(null===a)return 16777215;const n=(0,l.yWT)(i(a)).formatHex();return parseInt(n.substring(1),16)}})),d=k.mdFrames,u=D.step,p=[{trajectoryURLs:[`${`${h.nP}/${t}/trajectory`}?frames=1:${d}:${u}`]}],m=[];$.forEach((e=>{const s={...e};s.color="custom",s.customScheme=c,m.push(s)}));const x=e[0].length,g=k.timeLength,f="ensemble"===k.TYPE;let y,A,S,C;if(f||!g?(y=u,A="Frames",S=e=>"frame "+e):(y=g/(x-1),A="Time (ns)",S=e=>+e.toFixed(2)+" ns"),v&&v.payload){C=[];for(let e=0;e<v.payload.length;e+=y)C.push(v.payload[e])}return{components:p,representations:m,analysisFrameCount:x,xAxisStep:y,xAxisLabel:A,isEnsemble:f,xTooltip:S,data:n,xWeights:C}}),[D,R,k,t,$,v]),{selectedData:J,selectedResidueIndices:K}=(0,a.useMemo)((()=>{const e={},s=[];return F.forEach(((t,a)=>{const n={data:B.rmsdpr[t.index]};n.color=t.color,e[a]=n,s.push(t.index)})),{selectedData:e,selectedResidueIndices:s}}),[B,F]),O=(0,a.useCallback)((e=>{T.current.togglePlaying(!1),T.current.currentFrame=e}),[]),U=(0,a.useCallback)((e=>{if(!w.current)return;const s=Math.round(e*(W-1));w.current.marks=[{x:s,attr:{fill:"#c8c8c8"}}]}),[W]),Z=(0,a.useCallback)(((e,s,t)=>{const a={color:t,index:s};L((e=>[...e,a]))}),[L]),z=(0,a.useCallback)(((e,s)=>{L((e=>e.filter((e=>e.index!==s))))}),[L]),Q=(0,a.useCallback)((()=>{L([])}),[L]),X=(0,a.useCallback)(((e,s)=>{const t=B.means[s],a=B.stdvs[s];return`Mean RMSD: ${Math.round(100*t)/100}\nStandard deviation: ${Math.round(100*a)/100}`}),[B]);return N||v&&v.loading?(0,C.jsx)(d.A,{}):E?E.toString():v&&v.error?v.error.toString():D?v&&!v.payload?"Something bad happened with populations":R?(0,C.jsxs)(a.Suspense,{fallback:(0,C.jsx)(d.A,{}),children:[(0,C.jsx)(o.A,{children:(0,C.jsx)(A.A,{residueValues:B.means,legendTitle:"Average RMSD (\xc5)",onSelect:Z,onDeselect:z,onClean:Q,onTooltip:X})}),(0,C.jsx)(o.A,{className:m,children:F.length>0?(0,C.jsx)(S.default,{yData:J,step:G,xAxisLabel:V,type:Y?"dots":"line",xWeights:H,xTooltip:q,yAxisLabel:"RMSd (\xc5)",onSelect:O,className:x,ref:w}):(0,C.jsx)("div",{className:g,children:(0,C.jsx)(r.A,{variant:"h6",children:"No residue selected"})})}),(0,C.jsx)(o.A,{className:f,ref:e,children:s?(0,C.jsx)(i.default,{className:y,startingComponents:I,startingRepresentations:P,selectedResidueIndices:K,onProgress:U,ref:T,framesSelect:!1}):(0,C.jsx)("div",{style:{height:"50vh"}})})]}):(0,C.jsx)(d.A,{}):"Something bad happened with the analysis data"}}}]);
//# sourceMappingURL=rmsd-perres.2ed54189.chunk.js.map