"use strict";(self.webpackChunkmdposit=self.webpackChunkmdposit||[]).push([[7515],{8018:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r=n(65043),a=n(40830),l=n(88058),i=n(45180),s=n(75040),c=n(80705),o=n(32577),d=n(60093),u=n(39766),h=n(64600),x=n.n(h),p=n(92954);const m=window.devicePixelRatio||1,g=o._9v.amplitude(1).period(.5);let f;var y=n(17604),v=n(17392),w=n(92127),S=n(12639);const M={"graph-container":"style_graph-container__oCOoS",axis:"style_axis__H0KE8","legend-text":"style_legend-text__Zvd0H",legend:"style_legend__kYAHJ",switch:"style_switch__vPk4i",switched:"style_switched__DLS7l","color-scale":"style_color-scale__mIyZh",cursor:"style_cursor__uJXdm",tooltip:"style_tooltip__S2WeP"};var _=n(70579);const A=window.devicePixelRatio||1,R=10,b=10,j=25,C=25,$=500,[k,L]=[375,625],P=(0,o.exT)(o.GAA),Y=e=>{let{framestep:t,projectionsData:n,projections:h,datumRange:Y,totalFrames:X,setRequestedFrame:E}=e;const I=(0,r.useRef)(null),T=(0,r.useRef)(null),F=(0,r.useRef)(a.A),N=(0,r.useRef)(null),W=(0,r.useRef)(null),B=(0,r.useRef)(null),D=(0,r.useRef)({find(){}}),[G,H]=(0,p.A)(!1);(0,r.useEffect)((()=>{const e=(0,o.Ltv)(I.current).append("canvas"),t=(0,o.Ltv)(I.current).append("svg"),n=e.node().getContext("2d",{alpha:!1,desynchronized:!0}),r=(0,o.V$7)(),a={xScale:(0,o.m4Y)(),yScale:(0,o.m4Y)(),xAxis:t.append("g").attr("class",M.axis),yAxis:t.append("g").attr("class",M.axis),xAxisLegend:t.append("text").attr("class",x()(M.axis,M["legend-text"])),yAxisLegend:t.append("text").attr("class",x()(M.axis,M["legend-text"])),dataPoints:t.append("g").attr("class",M["data-points"]),hover:t.append("circle").attr("fill","transparent"),legendCanvas:(0,o.Ltv)(T.current).select("canvas"),legendCursor:(0,o.Ltv)(T.current).select(`.${M.cursor}`),brush:r,brushElement:t.append("g").attr("class","brush")};a.drawLegend=(0,l.A)((e=>(t,n,r,a,l)=>{const i=e.createImageData(t.length,1),s=new Uint32Array(i.data.buffer);t.forEach(((e,t)=>{let{x:i,y:c,fill:{r:o,g:d,b:u}}=e,h=255;if(n){const e=n(i);if(e<0||e>a)h=100;else{const e=r(c);(e<0||e>l)&&(h=100)}}s[t]=16777216*h+65536*u+256*d+o})),e.putImageData(i,0,0)})(a.legendCanvas.node().getContext("2d",{alpha:!0})),$+L);const c=function(){let{onlyTooltip:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B.current.style.display="none",a.hover.attr("fill","transparent"),e||(a.legendCursor.style("left",""),a.legendCursor.style("opacity",0))},d=function(){let{datumIndex:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E((t=>{if(!X)return console.error("No number of frames in metadata. Are we missing the main trajectory?"),null;const n=Math.floor(e*(X/Y));return n===t?null:n}))};return F.current=async function(){let{processed:r=W.current,brushing:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!r)return;if(await(0,u.Gt)(),!I.current.firstChild)return;const{clientWidth:h,clientHeight:x}=I.current;t.attr("width",h).attr("height",x),e.attr("width")!==""+h*A&&e.attr("width",h*A),e.attr("height")!==""+x*A&&e.attr("height",x*A),e.style("width",`${h}px`).style("height",`${x}px`),a.brushElement.call(a.brush);const p=!N.current;a.xScale.range([C,h-b]),l||a.xScale.domain(r.xMinMax),a.yScale.range([x-j,R]),l||a.yScale.domain(r.yMinMax);a.xAxis.transition().duration(!p&&!(0,y.A)()&&$+L).call((e=>e.attr("transform",`translate(0, ${(0,i.A)(a.yScale(0),0,x-32)})`).call((0,o.l78)(a.xScale).ticks(Math.round(h/75)).tickFormat((e=>0===e?null:e))))),a.xAxisLegend.text(`\u2190 principal component ${r.projections[0]+1} \u2192`).transition().duration(!p&&!(0,y.A)()&&$+L).attr("transform",`translate(${h/2}, ${x-5})`);a.yAxis.transition().duration(!p&&!(0,y.A)()&&$+L).call((e=>e.attr("transform",`translate(${(0,i.A)(a.xScale(0),30,h-1)}, 0)`).call((0,o.V4s)(a.yScale).ticks(Math.round(x/75)).tickFormat((e=>0===e?null:e))))),a.yAxisLegend.text(`\u2190 principal component ${r.projections[1]+1} \u2192`).transition().duration(!p&&!(0,y.A)()&&$+L).attr("transform",`translate(5, ${x/2}) rotate(90)`),a.brush.on("end",(()=>{const{selection:e}=o.f0J;e&&(a.xScale.domain([e[0][0],e[1][0]].map(a.xScale.invert,a.xScale)),a.yScale.domain([e[1][1],e[0][1]].map(a.yScale.invert,a.yScale)),a.brushElement.call(a.brush.move,null),F.current({brushing:!0}))}));const v=Math.log(Math.max((r.xMinMax[1]-r.xMinMax[0])/(a.xScale.domain()[1]-a.xScale.domain()[0]),(r.yMinMax[1]-r.yMinMax[0])/(a.yScale.domain()[1]-a.yScale.domain()[0])))+1,w=A*Math.min(h,x)*v/250;a.hover.attr("r",w+5);let S=0;const M=p?0:N.current.currentRadius;N.current=r.data.map(((e,t,n)=>{let{x:r,y:l,fill:i}=e,{length:c}=n;const d=a.xScale(r)*A,u=a.yScale(l)*A,h=t*$*(p?2:1)/c,x=(0,y.A)()?0:(0,s.A)(k,L)*(p?2:1),m=h+x;return S<m&&(S=m),{currentX:null,currentY:null,currentRadius:null,interpolateX:(0,o.GWP)(p?a.xScale(0)*A:N.current[t].currentX||N.current[t].x,d),interpolateY:(0,o.GWP)(p?a.yScale(0)*A:N.current[t].currentY||N.current[t].y,u),delay:h,duration:x,x:d,y:u,fill:i}})),N.current.interpolateRadius=(0,o.GWP)(M,w),(e=>{let{context:t,dataPoints:n,width:r,height:a,maxTime:l,isFirstTime:i}=e;new Promise((e=>{f&&f.stop(),f=(0,o.O1W)((s=>{const c=s>=l;c?(f.stop(),t.fillStyle="white",t.fillRect(0,0,r*m,a*m)):(t.fillStyle="rgba(255, 255, 255, 0.25)",t.fillRect(0,0,r*m,a*m));for(const e of n){const l=Math.max(0,(i?g:o.oRn)(Math.min((s-e.delay)/e.duration,1)));e.currentX=e.interpolateX(l),e.currentX<0||e.currentX>r||(e.currentY=e.interpolateY(l),n.currentRadius=n.interpolateRadius(l),e.currentY<0||e.currentY>a||(t.fillStyle=e.fill.hex,t.beginPath(),t.arc(e.currentX,e.currentY,n.currentRadius,0,2*Math.PI),t.fill()))}c&&e()}))}))})({context:n,dataPoints:N.current,width:h*A,height:x*A,maxTime:S,isFirstTime:p});const _=function(){let{datumIndex:e,datum:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Number.isInteger(e)||!t)return;a.legendCursor.style("left",`calc(${100*e/r.data.length}% - 4px)`),a.legendCursor.style("opacity",1);const n=a.xScale(t.x);if(n<0||n>h)return c({onlyTooltip:!0});const l=a.yScale(t.y);if(l<0||l>x)return c({onlyTooltip:!0});const{scrollX:i,scrollY:s}=window,{left:o,top:d}=I.current.getBoundingClientRect();B.current.innerHTML=`\n          <div>\n            <p>Frame ${e*r.framestep+1} (click to open viewer)</p>\n            <p>Principal component ${r.projections[0]+1}: ${t.x}</p>\n            <p>Principal component ${r.projections[1]+1}: ${t.y}</p>\n          </div>\n        `,B.current.style.display="inline-block";const u=B.current.getBoundingClientRect();B.current.style.transform=`translate(${n+o+i-u.width/2}px, ${l+d+s-u.height-15}px)`,a.hover.attr("cx",n).attr("cy",l).attr("fill",t.fill.hex)},P=e=>()=>{const{scrollX:t,scrollY:n}=window,{left:l,top:i}=I.current.getBoundingClientRect(),{pageX:s,pageY:d}=o.f0J,u=s-l-t,h=d-i-n,x=D.current.find(a.xScale.invert(u),a.yScale.invert(h)),p=r.data[x];if(p){const t=a.xScale(p.x),n=a.yScale(p.y);if(Math.sqrt(Math.abs(t-u)**2+Math.abs(n-h)**2)<=20)return e({datumIndex:x,datum:p})}c(),e()};t.on("mousemove",P(_)).on("mouseout",c).on("click",P(d));const Y=e=>()=>{const t=a.legendCanvas.node();if(!t||!("getBoundingClientRect"in t))return;const{left:n,width:l}=t.getBoundingClientRect(),{pageX:i}=o.f0J,s=(i-n)/l,c=Math.floor(s*r.data.length);e({datumIndex:c,datum:r.data[c]})};a.drawLegend(r.data,a.xScale,a.yScale,h,x),a.legendCanvas.on("mousemove",Y(_)).on("mouseout",c).on("click",Y(d))},window.addEventListener("resize",F.current),()=>{a.drawLegend&&a.drawLegend.cancel(),window.removeEventListener("resize",F.current)}}),[h,E,Y,X]),(0,r.useEffect)((()=>{const[e,r]=G?[0,1]:[1,0],a=n&&n[0].length||0,l=P.domain([0,a]),i=n[h[e]],s=n[h[r]],x=(0,c.A)(i,s),p={data:x.map(((e,t)=>{let[n,r]=e;const a=l(t);return{x:n,y:r,fill:{hex:a,...(0,o.Qhc)(a)}}})),xMinMax:[Math.min(...i),Math.max(...i)],yMinMax:[Math.min(...s),Math.max(...s)],framestep:t,projections:[h[e],h[r]]};W.current=p,F.current({processed:p}),(async()=>{await(0,u.yy)($+L),await(0,u._)(100),D.current=d.A.from(x)})()}),[n,h,t,G]);const J=n&&n[0].length||0;return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:M["graph-container"],onDoubleClick:F.current,ref:I}),(0,_.jsxs)("div",{className:M.legend,children:[(0,_.jsx)(v.A,{title:"Switch axes",className:x()(M.switch,{[M.switched]:G}),onClick:H,size:"large",children:(0,_.jsx)(w.g,{icon:S.fKj})}),(0,_.jsx)("p",{children:"position in simulation:"}),(0,_.jsxs)("div",{className:M["color-scale"],children:[(0,_.jsx)("div",{children:"start"}),(0,_.jsxs)("div",{ref:T,children:[(0,_.jsx)("canvas",{height:"1",width:J}),(0,_.jsx)("div",{className:M.cursor})]}),(0,_.jsx)("div",{children:"end"})]})]}),(0,_.jsx)("div",{className:M.tooltip,ref:B})]})}}}]);
//# sourceMappingURL=projections.805512e6.chunk.js.map